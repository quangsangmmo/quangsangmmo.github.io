api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMCIKbmFtZV90b29sID0gIndvcm1mYXJlIgpCQU5ORVIobmFtZV90b29sLCB2ZXJzaW9uKQpwcmludChmIiIiCnvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7bGFtfUPDgUMgQ0jhu6hDIE7Egk5HIEPhu6ZBIFRPT0wKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gxJFp4buDbSBkYW5oIGjDoG5nIG5nw6B5CnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIGNsaWNrCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIHPhu60gZOG7pW5nIGJvb3N0ZXIKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbsOibmcgY+G6pXAgYm9vc3Rlcgp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBob8OgbiB0aMOgbmggY8OhYyBuaGnhu4dtIHbhu6UgKFNvb24pCiIiIikKZGVmIFBST0ZJTEUoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVycy5wb3AoImNvbnRlbnQtdHlwZSIsIE5vbmUpCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuY2xpY2tlci53b3JtZmFyZS5jb20vdXNlci9wcm9maWxlIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL3VzZXIvcHJvZmlsZSIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgdXNlcm5hbWUgPSBnZXRkYXRhWyJ1c2VybmFtZSJdCiAgICAgIGRhbWUgPSBnZXRkYXRhWyJlbmVyZ3lQZXJUYXAiXQogICAgICBlbmVyZ3lMZWZ0ID0gZ2V0ZGF0YVsiZW5lcmd5TGVmdCJdCiAgICAgIGVuZXJneU1heCA9IGdldGRhdGFbImVuZXJneU1heCJdCiAgICAgIGVuZXJneVBlclNlY29uZCA9IGdldGRhdGFbImVuZXJneVBlclNlY29uZCJdCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJzY29yZSJdCiAgICAgIGlzVHVyYm9BdmFpbGFibGUgPSBnZXRkYXRhWyJpc1R1cmJvQXZhaWxhYmxlIl0KICAgICAgbmFtZVNxdWFkID0gZ2V0ZGF0YVsic3F1YWQiXVsibmFtZSJdCiAgICAgIG1lbWJlcnMgPSBnZXRkYXRhWyJzcXVhZCJdWyJ0b3RhbE1lbWJlcnMiXQogICAgICBzY29yZVNxdWFkID0gZ2V0ZGF0YVsic3F1YWQiXVsidG90YWxFYXJuZWRTY29yZSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBXT1JNRkFSRSIpCiAgICAgIFJVTl9XT1JNRkFSRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHVzZXJuYW1lLCBkYW1lLCBlbmVyZ3lMZWZ0LCBlbmVyZ3lNYXgsIGVuZXJneVBlclNlY29uZCwgYmFsYW5jZSwgbmFtZVNxdWFkLCBtZW1iZXJzLCBzY29yZVNxdWFkLCBpc1R1cmJvQXZhaWxhYmxlCmRlZiBRVUVTVChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzLnBvcCgiY29udGVudC10eXBlIixOb25lKQogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL3F1ZXN0IiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL3F1ZXN0IixoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICB0YXNrcyA9IHJlc3BvbnNlLmpzb24oKQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgV09STUZBUkUiKQogICAgICBSVU5fV09STUZBUkUoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiB0YXNrcwpkZWYgQ0xJQ0soaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVyc1siY29udGVudC10eXBlIl0gPSAiYXBwbGljYXRpb24vanNvbiIKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuY2xpY2tlci53b3JtZmFyZS5jb20vZ2FtZS9zYXZlLWNsaWNrcyIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCwganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5jbGlja2VyLndvcm1mYXJlLmNvbS9nYW1lL3NhdmUtY2xpY2tzIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwLCBqc29uPWRhdGEpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIGVuZXJneUxlZnQgPSBnZXRkYXRhWyJlbmVyZ3lMZWZ0Il0KICAgICAgYmFsYW5jZSA9IGdldGRhdGFbInNjb3JlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFdPUk1GQVJFIikKICAgICAgUlVOX1dPUk1GQVJFKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gZW5lcmd5TGVmdCwgYmFsYW5jZQpkZWYgQ0hFQ0tfUVVFU1QoaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVyc1siY29udGVudC10eXBlIl0gPSAiYXBwbGljYXRpb24vanNvbiIKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuY2xpY2tlci53b3JtZmFyZS5jb20vcXVlc3QvY2hlY2stY29tcGxldGlvbiIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCwganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMpCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5jbGlja2VyLndvcm1mYXJlLmNvbS9xdWVzdC9jaGVjay1jb21wbGV0aW9uIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwLCBqc29uPWRhdGEpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIHN1Y2Nlc3MgPSBnZXRkYXRhWyJzdWNjZXNzIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFdPUk1GQVJFIikKICAgICAgUlVOX1dPUk1GQVJFKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gc3VjY2VzcwpkZWYgQ0xBSU1fUVVFU1QoaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVyc1siY29udGVudC10eXBlIl0gPSAiYXBwbGljYXRpb24vanNvbiIKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuY2xpY2tlci53b3JtZmFyZS5jb20vcXVlc3QvY2xhaW0tcmV3YXJkIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcykKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL3F1ZXN0L2NsYWltLXJld2FyZCIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCwganNvbj1kYXRhKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICBzdWNjZXNzID0gZ2V0ZGF0YVsic3VjY2VzcyJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBXT1JNRkFSRSIpCiAgICAgIFJVTl9XT1JNRkFSRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHN1Y2Nlc3MKZGVmIFNIT1AoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVycy5wb3AoImNvbnRlbnQtdHlwZSIsTm9uZSkKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5jbGlja2VyLndvcm1mYXJlLmNvbS9nYW1lL3Nob3AiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuY2xpY2tlci53b3JtZmFyZS5jb20vZ2FtZS9zaG9wIixoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIGNvdW50RnVsbEVuZXJneSA9IGdldGRhdGFbImRhaWx5Qm9vc3RzIl1bMF1bImF2YWlsYWJsZUNvdW50Il0KICAgICAgY291bnRUdXJibyA9IGdldGRhdGFbImRhaWx5Qm9vc3RzIl1bMV1bImF2YWlsYWJsZUNvdW50Il0KICAgICAgUmVjb3ZlcnlDb25maWcgPSBnZXRkYXRhWyJhdmFpbGFibGVCb29zdCJdWzFdCiAgICAgIFRhcENvbmZpZyA9IGdldGRhdGFbImF2YWlsYWJsZUJvb3N0Il1bMl0KICAgICAgTWF4RW5lcmd5Q29uZmlnID0gZ2V0ZGF0YVsiYXZhaWxhYmxlQm9vc3QiXVswXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgV09STUZBUkUiKQogICAgICBSVU5fV09STUZBUkUoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBjb3VudEZ1bGxFbmVyZ3ksIGNvdW50VHVyYm8sIFJlY292ZXJ5Q29uZmlnLCBUYXBDb25maWcsIE1heEVuZXJneUNvbmZpZwpkZWYgQlVZX0JPT1NUKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIGhlYWRlcnNbImNvbnRlbnQtdHlwZSJdID0gImFwcGxpY2F0aW9uL2pzb24iCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL2dhbWUvYnV5LWJvb3N0IiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcykKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL2dhbWUvYnV5LWJvb3N0IiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwLCBqc29uPWRhdGEpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJzY29yZSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBXT1JNRkFSRSIpCiAgICAgIFJVTl9XT1JNRkFSRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UKZGVmIEFDVElWRV9CT09TVChoZWFkZXJzLCBkYXRhLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzWyJjb250ZW50LXR5cGUiXSA9ICJhcHBsaWNhdGlvbi9qc29uIgogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5jbGlja2VyLndvcm1mYXJlLmNvbS9nYW1lL2FjdGl2YXRlLWRhaWx5LWJvb3N0IiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcykKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmNsaWNrZXIud29ybWZhcmUuY29tL2dhbWUvYWN0aXZhdGUtZGFpbHktYm9vc3QiLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzAsIGpzb249ZGF0YSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgY291bnRUdXJibyA9IGdldGRhdGFbMV1bImF2YWlsYWJsZUNvdW50Il0KICAgICAgY291bnRGdWxsRW5lcmd5ID0gZ2V0ZGF0YVswXVsiYXZhaWxhYmxlQ291bnQiXQogICAgICBzdGF0dXNfY29kZSA9IHJlc3BvbnNlLnN0YXR1c19jb2RlCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBXT1JNRkFSRSIpCiAgICAgIFJVTl9XT1JNRkFSRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGNvdW50VHVyYm8sIGNvdW50RnVsbEVuZXJneSwgc3RhdHVzX2NvZGUKZGVmIFJVTl9XT1JNRkFSRSgpOgogIHdpdGggb3BlbignY29uZmlnL3dvcm1mYXJlLmpzb24nLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGU6CiAgICBjb25maWdfZGF0YSA9IGpzb24ubG9hZHMocmVtb3ZlX2NvbW1lbnRzKGZpbGUucmVhZCgpKSkKICB1c2VycyA9IGNvbmZpZ19kYXRhCiAgaWYgbGVuKHVzZXJzKSA+IDEwOgogICAgcHJpbnQoIkLhuqFuIGNo4buJIMSRxrDhu6NjIHBow6lwIHRow6ptIHThu5FpIMSRYSAxMCB0w6BpIGtob+G6o24gxJHhu4MgY2jhuqF5IHRvb2wiKQogICAgZXhpdCgpCiAgZm9yIHVzZXIgaW4gdXNlcnM6CiAgICBhY2NvdW50ID0gdXNlclsiU1RUX0FDQ09VTlQiXQogICAgYXV0aG9yaXphdGlvbiA9IHVzZXJbIkFVVEhPUklaQVRJT04iXQogICAgaWYgYXV0aG9yaXphdGlvbiA9PSAiIiBvciBhdXRob3JpemF0aW9uID09ICJ0aGF5X3Ro4bq/X2LhurFuZ19hdXRob3JpemF0aW9uIjoKICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfVTDoGkga2hv4bqjbiB7dsOgbmd9e2FjY291bnQuc3BsaXQoJ18nKVsxXX0ge8SR4buPfURBVEEgxJFhbmcgYuG7iyB0cuG7kW5nIikKICAgICAgY29udGludWUKICAgIHdpdGggb3BlbignY29uZmlnL3NldHRpbmcuanNvbicsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToKICAgICAgY29uZmlnX2FjYyA9IGpzb24ubG9hZHMocmVtb3ZlX2NvbW1lbnRzKGZpbGUucmVhZCgpKSlbYWNjb3VudF0KICAgIHByb3h5X2xpc3QgPSBjb25maWdfYWNjWyJwcm94eSJdCiAgICB0eXBlX3Byb3h5ID0gY29uZmlnX2FjY1sidHlwZV9wcm94eSJdCiAgICB1c2VyX2FnZW50ID0gY29uZmlnX2FjY1sidXNlci1hZ2VudCJdCiAgICBpZiBwcm94eV9saXN0ICE9ICIiOgogICAgICBwcm94eV9saXN0ID0gcHJveHlfbGlzdC5zcGxpdCgiOiIpCiAgICAgIHByb3h5ID0gZiJ7dHlwZV9wcm94eX06Ly97cHJveHlfbGlzdFsyXX06e3Byb3h5X2xpc3RbM119QHtwcm94eV9saXN0WzBdfTp7cHJveHlfbGlzdFsxXX0iCiAgICAgIHByb3hpZXMgPSB7CiAgICAgICdodHRwJzogcHJveHksCiAgICAgICdodHRwcyc6IHByb3h5LH0KICAgIGVsc2U6CiAgICAgIGlmIGFjY291bnQuc3BsaXQoJ18nKVsxXSAhPSAiMSI6CiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q2h1eeG7g24gdMOgaSBraG/huqNuIGRvIGtow7RuZyBjw7MgcHJveHkiKQogICAgICAgIGNvbnRpbnVlCiAgICAgIHByb3hpZXMgPSAiIgogICAgaXAsIGZha2VpcCA9IGdldElQKHByb3hpZXMpCiAgICBpZiBpcCA9PSBmYWtlaXAgPT0gTm9uZToKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499XG7EkOG7lEkgVMOASSBLSE/huqJOIERPIEtIw5RORyBM4bqkWSDEkMav4buiQyBJUCwgSMODWSBLSeG7gk0gVFJBIEzhuqBJIFBST1hZXG4iKQogICAgICBjb250aW51ZQogICAgaGVhZGVycyA9IHsKICAgICAgIkhvc3QiOiJhcGkuY2xpY2tlci53b3JtZmFyZS5jb20iLAogICAgICAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKiIsCiAgICAgICJBY2NlcHQtRW5jb2RpbmciOiAiZ3ppcCwgZGVmbGF0ZSwgYnIsIHpzdGQiLAogICAgICAiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAgICAgIkF1dGhvcml6YXRpb24iOiBhdXRob3JpemF0aW9uLAogICAgICAiUmVmZXJlciI6ICJodHRwczovL2NsaWNrZXIud29ybWZhcmUuY29tLyIsCiAgICAgICJTZWMtQ2gtVWEiOiAnIkNocm9taXVtIjt2PSIxMjQiLCAiR29vZ2xlIENocm9tZSI7dj0iMTI0IiwgIk5vdC1BLkJyYW5kIjt2PSI5OSInLAogICAgICAiU2VjLUNoLVVhLU1vYmlsZSI6ICI/MSIsCiAgICAgICJTZWMtQ2gtVWEtUGxhdGZvcm0iOiAnIkFuZHJvaWQiJywKICAgICAgIm9yaWdpbiI6Imh0dHBzOi8vY2xpY2tlci53b3JtZmFyZS5jb20iLAogICAgICAiU2VjLUZldGNoLURlc3QiOiAiZW1wdHkiLAogICAgICAiU2VjLUZldGNoLU1vZGUiOiAiY29ycyIsCiAgICAgICJTZWMtRmV0Y2gtU2l0ZSI6ICJjcm9zcy1zaXRlIiwKICAgICAgIlVzZXItQWdlbnQiOiB1c2VyX2FnZW50LAogICAgICAicHJpb3JpdHkiOiJ1PTEsIGkiLAogICAgICAiWC1BcGktS2V5IjogIjltNjBBaE8xSTlKbXJZSXNXeE1uVGhYYkYzbkRXNEdIRkExcmRlNVBLekptUkE5RHY2TFoyWVhTTTZ2dndpZ0MifQogICAgdXNlcm5hbWUsIGRhbWUsIGVuZXJneUxlZnQsIGVuZXJneU1heCwgZW5lcmd5UGVyU2Vjb25kLCBiYWxhbmNlLCBuYW1lU3F1YWQsIG1lbWJlcnMsIHNjb3JlU3F1YWQsIGlzVHVyYm9BdmFpbGFibGUgPSBQUk9GSUxFKGhlYWRlcnMsIHByb3hpZXMpCiAgICBmcmVlX3R1cmJvID0gIiIKICAgIGlmIGlzVHVyYm9BdmFpbGFibGUgPT0gVHJ1ZToKICAgICAgZnJlZV90dXJibyA9ICLwn5CfIgogICAgY291bnRGdWxsRW5lcmd5LCBjb3VudFR1cmJvLCBSZWNvdmVyeUNvbmZpZywgVGFwQ29uZmlnLCBNYXhFbmVyZ3lDb25maWcgPSBTSE9QKGhlYWRlcnMsIHByb3hpZXMpCiAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkgKiAxMDAwKQogICAgZW5lcmd5TGVmdCwgbmV3YmFsYW5jZSA9IENMSUNLKGhlYWRlcnMsIHsic3RhcnRUaW1lc3RhbXAiOnRpbWVzdGFtcCwiYW1vdW50IjpkYW1lLCJpc1R1cmJvIjpGYWxzZX0sIHByb3hpZXMpCiAgICBwcmludChmIiIie8SR4bqtbX17xJFlbn3Cq8KrwqvCq8KrwqvCq8KrwqvCq8KrwqvCq8KrwqvCq8Kre2xhbX1be3bDoG5nQkd9e8SR4buPfVRIw5RORyBUSU4gVMOASSBLSE/huqJOIFdPUk1GQVJFe8SRZW5CR317bGFtfV17xJFlbn3Cu8K7wrvCu8K7wrvCu8K7wrvCu8K7wrvCu8K7wrvCu1xue8SRZW5944CY8J+RpOOAmXt0cuG6r25nfVVzZXJOYW1lIHvEkeG7j306IHts4bulY317dXNlcm5hbWV9IHt0cuG6r25nfSh7aOG7k25nfXthY2NvdW50LnNwbGl0KCdfJylbMV19e3Ry4bqvbmd9KVxue8SRZW5944CY8J+qmeOAmXt0cuG6r25nfVPhu5EgRMawIHvEkeG7j306IHt2w6BuZ317YmFsYW5jZTosfVxue8SRZW5944CY8J+TiuOAmXt0cuG6r25nfVRow7RuZyBz4buRIEdhbWV7xJHhu499OiB7dsOgbmd9K3tkYW1lfXvEkWVufS97dsOgbmd9Y2xpY2sge8SR4buPfVt7bGFtfXtlbmVyZ3lMZWZ0Oix9e8SRZW59L3tsYW19e2VuZXJneU1heDosfXvEkeG7j31dIHt2w6BuZ317Y291bnRUdXJib33imqEge2NvdW50RnVsbEVuZXJneX3wn5SLIHtmcmVlX3R1cmJvfVxue8SRZW5944CY8J+Tp+OAmXt0cuG6r25nfVRow7RuZyB0aW4gU3F1YWR7xJHhu499OiB7eGFuaH17bmFtZVNxdWFkfSB7xJFlbn18IHt2w6BuZ317c2NvcmVTcXVhZDosfSB7xJFlbn18IHto4buTbmd9e21lbWJlcnN98J+RpVxue8SRZW5944CY8J+Mj+OAmXt0cuG6r25nfUlQIHvEkeG7j306IHtuw6J1fXtpcH0ge2zhu6VjfcK7wrvCuyB7dHLhuq9uZ31GYWtlIElQIHvEkeG7j306IHtsYW19e2Zha2VpcH1cbiIiIikKICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgcHJpbnQoZiJ7xJHhu499XDAzM1sxOzMzOzQwbULhuq5UIMSQ4bqmVSBDSOG6oFkgVE9PTCB7dGjGsOG7nW5nfXvEkeG6rW19e8SR4buPfcK7IHvEkWVufVt7dsOgbmd9e3N0YXJ0X3RpbWUuc3RyZnRpbWUoJyVIOiVNOiVTJyl9e8SRZW59XVxuIikKICAgIHRhc2tzID0gUVVFU1QoaGVhZGVycywgcHJveGllcykKICAgIGxpc3RfdGFzayA9IFsiX0pvaW5EaXNjb3JkUXVlc3QiLCJfSm9pbkluc3RhZ3JhbVF1ZXN0IiwiX0pvaW5Ud2l0dGVyUXVlc3QiLCJfSm9pblRpa1Rva1F1ZXN0IiwiX0pvaW5Zb3V0dWJlUXVlc3QiLCJfV2F0Y2hXb3JtZmFyZVZpZGVvUXVlc3QiXQogICAgZm9yIHRhc2sgaW4gdGFza3M6CiAgICAgIHRhc2tJRCA9IHRhc2tbImlkIl0KICAgICAgaWYgdGFza0lEIGluIGxpc3RfdGFzayBhbmQgdGFza1siaXNSZXdhcmRDbGFpbWVkIl0gPT0gRmFsc2U6CiAgICAgICAgaWYgbGVuKHRhc2tbInRhc2tzIl0pID4gMToKICAgICAgICAgIGZvciBpIGluIHRhc2tbInRhc2tzIl06CiAgICAgICAgICAgIGRhdGEgPSB7InF1ZXN0SWQiOnRhc2tJRCwidGFza0lkIjppWydpZCddfQogICAgICAgICAgICBzdWNjZXNzID0gQ0hFQ0tfUVVFU1QoaGVhZGVycywgZGF0YSwgcHJveGllcykKICAgICAgICAgICAgI3ByaW50KHN1Y2Nlc3MpCiAgICAgICAgZWxzZToKICAgICAgICAgIGRhdGEgPSB7InF1ZXN0SWQiOnRhc2tJRH0KICAgICAgICAgIHN1Y2Nlc3MgPSBDSEVDS19RVUVTVChoZWFkZXJzLCBkYXRhLCBwcm94aWVzKQogICAgICAgIGlmIHN1Y2Nlc3MgPT0gVHJ1ZToKICAgICAgICAgIHN1Y2Nlc3MgPSBDTEFJTV9RVUVTVChoZWFkZXJzLCBkYXRhLCBwcm94aWVzKQogICAgICAgICAgaWYgc3VjY2VzcyA9PSBUcnVlOgogICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ31Ib8OgbiB0aMOgbmgge2xhbX17dGFza0lEfSB7dsOgbmd9K3t0YXNrWydyZXdhcmRBbW91bnQnXX0iKQogICAgICAgICAgZWxzZToKICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfUNsYWltIHBo4bqnbiB0aMaw4bufbmcge2xhbX17dGFza0lEfSB7xJHhu499VEjhuqRUIELhuqBJIikKICAgICAgICBlbHNlOgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31DaGVjayBuaGnhu4dtIHbhu6Uge2xhbX17dGFza0lEfSB7xJHhu499VEjhuqRUIELhuqBJIikKICAgICNwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31Ow4JORyBD4bqkUCBCT09TVCIpCiAgICBkZWYgVVBHUkFERShiYWxhbmNlLCBUYXBDb25maWcsIFJlY292ZXJ5Q29uZmlnLCBNYXhFbmVyZ3lDb25maWcpOgogICAgICB3aGlsZSBiYWxhbmNlID4gUmVjb3ZlcnlDb25maWdbInByaWNlSW5TY29yZSJdIG9yIGJhbGFuY2UgPiBNYXhFbmVyZ3lDb25maWdbInByaWNlSW5TY29yZSJdIG9yIGJhbGFuY2UgPiBUYXBDb25maWdbInByaWNlSW5TY29yZSJdOgogICAgICAgIHR5cGVVcGdyYWRlID0gTm9uZQogICAgICAgIGlmIGJhbGFuY2UgPiBUYXBDb25maWdbInByaWNlSW5TY29yZSJdIGFuZCB0eXBlVXBncmFkZSA9PSBOb25lIGFuZCBUYXBDb25maWdbImxldmVsIl0gPCAyMToKICAgICAgICAgIHR5cGVVcGdyYWRlID0gVGFwQ29uZmlnWyJ0eXBlIl0KICAgICAgICAgIGxldmVsID0gVGFwQ29uZmlnWyJsZXZlbCJdICsgMQogICAgICAgICAgcHJpY2UgPSBUYXBDb25maWdbInByaWNlSW5TY29yZSJdCiAgICAgICAgIAogICAgICAgIGlmIGJhbGFuY2UgPiBNYXhFbmVyZ3lDb25maWdbInByaWNlSW5TY29yZSJdIGFuZCB0eXBlVXBncmFkZSA9PSBOb25lIGFuZCBNYXhFbmVyZ3lDb25maWdbImxldmVsIl0gPCAyMToKICAgICAgICAgIHR5cGVVcGdyYWRlID0gTWF4RW5lcmd5Q29uZmlnWyJ0eXBlIl0KICAgICAgICAgIGxldmVsID0gTWF4RW5lcmd5Q29uZmlnWyJsZXZlbCJdICsgMQogICAgICAgICAgcHJpY2UgPSBNYXhFbmVyZ3lDb25maWdbInByaWNlSW5TY29yZSJdCiAgICAgICAgaWYgYmFsYW5jZSA+IFJlY292ZXJ5Q29uZmlnWyJwcmljZUluU2NvcmUiXSBhbmQgdHlwZVVwZ3JhZGUgPT0gTm9uZSBhbmQgUmVjb3ZlcnlDb25maWdbImxldmVsIl0gPCAyMToKICAgICAgICAgIHR5cGVVcGdyYWRlID0gUmVjb3ZlcnlDb25maWdbInR5cGUiXQogICAgICAgICAgbGV2ZWwgPSBSZWNvdmVyeUNvbmZpZ1sibGV2ZWwiXSArIDEKICAgICAgICAgIHByaWNlID0gUmVjb3ZlcnlDb25maWdbInByaWNlSW5TY29yZSJdCiAgICAgICAgaWYgdHlwZVVwZ3JhZGUgPT0gTm9uZToKICAgICAgICAgIGJyZWFrCiAgICAgICAgYmFsYW5jZSA9IEJVWV9CT09TVChoZWFkZXJzLCB7InR5cGUiOnR5cGVVcGdyYWRlfSwgcHJveGllcykKICAgICAgICBuYW1lVXBncmFkZSA9IHR5cGVVcGdyYWRlLnJlcGxhY2UoJ18nLCcgJykudXBwZXIoKQogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAge2jhu5NuZ317bmFtZVVwZ3JhZGV9IHt0cuG6r25nfSh7bGFtfXtsZXZlbH17dHLhuq9uZ30pIHts4bulY33igKIge8SR4buPfS17cHJpY2U6LH0ge8SRZW59wrsge3bDoG5nfXtiYWxhbmNlOix9IikKICAgICAgICBjb3VudEZ1bGxFbmVyZ3ksIGNvdW50VHVyYm8sIFJlY292ZXJ5Q29uZmlnLCBUYXBDb25maWcsIE1heEVuZXJneUNvbmZpZyA9IFNIT1AoaGVhZGVycywgcHJveGllcykKICAgICAgcmV0dXJuIGJhbGFuY2UsIFRhcENvbmZpZywgUmVjb3ZlcnlDb25maWcsIE1heEVuZXJneUNvbmZpZwogICAgYmFsYW5jZSwgVGFwQ29uZmlnLCBSZWNvdmVyeUNvbmZpZywgTWF4RW5lcmd5Q29uZmlnID0gVVBHUkFERShiYWxhbmNlLCBUYXBDb25maWcsIFJlY292ZXJ5Q29uZmlnLCBNYXhFbmVyZ3lDb25maWcpCiAgICAjcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfUjhur5UIFRJ4buATiBOw4JORyBD4bqkUCBCT09TVCIpCiAgICAKICAgIGlmIGlzVHVyYm9BdmFpbGFibGUgPT0gVHJ1ZToKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY33EkMOjIGvDrWNoIGhv4bqhdCBUdXJibyIsIGVuZD0iICIpCiAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpICogMTAwMCkKICAgICAgICBhbW91bnQgPSAxMDAwKjUqZGFtZQogICAgICAgIHRpbWUuc2xlZXAoNykKICAgICAgICBlbmVyZ3lMZWZ0LCBuZXdiYWxhbmNlID0gQ0xJQ0soaGVhZGVycywgeyJzdGFydFRpbWVzdGFtcCI6dGltZXN0YW1wLCJhbW91bnQiOmFtb3VudCwiaXNUdXJibyI6VHJ1ZX0sIHByb3hpZXMpCiAgICAgICAgc2NvcmUgPSBuZXdiYWxhbmNlIC0gYmFsYW5jZQogICAgICAgIGJhbGFuY2UgPSBuZXdiYWxhbmNlCiAgICAgICAgcHJpbnQoZiJ7dsOgbmd9K3tzY29yZX0ge8SR4buPfcK7IHt2w6BuZ317bmV3YmFsYW5jZTosfSIpCiAgICAgICAgI2V4aXQoKQogICAgICAgIGlmIHNjb3JlID09IDUwMDAqNSpkYW1lOgogICAgICAgICAgZXhpdCgpCiAgICAKICAgIHVzZXJuYW1lLCBkYW1lLCBlbmVyZ3lMZWZ0LCBlbmVyZ3lNYXgsIGVuZXJneVBlclNlY29uZCwgYmFsYW5jZSwgbmFtZVNxdWFkLCBtZW1iZXJzLCBzY29yZVNxdWFkLCBpc1R1cmJvQXZhaWxhYmxlID0gUFJPRklMRShoZWFkZXJzLCBwcm94aWVzKQogICAgd2hpbGUgVHJ1ZToKICAgICAgaWYgZW5lcmd5TGVmdC9kYW1lID4gMTA6CiAgICAgICAgaWYgZW5lcmd5TGVmdC9kYW1lID4gNTA6CiAgICAgICAgICBjb3VudFRhcCA9IHJhbmRvbS5yYW5kaW50KDUwLGludChlbmVyZ3lMZWZ0L2RhbWUpKQogICAgICAgIGVsc2U6CiAgICAgICAgICBjb3VudFRhcCA9IGludChlbmVyZ3lMZWZ0L2RhbWUpCiAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpICogMTAwMCkKICAgICAgICB0aW1lLnNsZWVwKDMpCiAgICAgICAgYW1vdW50ID0gZGFtZSpjb3VudFRhcAogICAgICAgIGVuZXJneUxlZnQsIG5ld2JhbGFuY2UgPSBDTElDSyhoZWFkZXJzLCB7InN0YXJ0VGltZXN0YW1wIjp0aW1lc3RhbXAsImFtb3VudCI6YW1vdW50LCJpc1R1cmJvIjpGYWxzZX0sIHByb3hpZXMpCiAgICAgICAgY29sbGVjdEFtb3VudCA9IG5ld2JhbGFuY2UgLSBiYWxhbmNlCiAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJFlbn3ilZTilZB7xJHhu499W3t2w6BuZ317bm93X3RpbWV9e8SR4buPfV0ge3Ry4bqvbmd9xJDDoyBDTElDSyB7bOG7pWN9e2NvdW50VGFwfSB7dHLhuq9uZ31s4bqnbiB7dsOgbmd9K3tjb2xsZWN0QW1vdW50Oix9IHvEkeG7j33CuyIsIGVuZD0iICIpCiAgICAgICAgcHJpbnQoZiJ7dsOgbmd9e25ld2JhbGFuY2U6LH1cbnvEkWVufeKVmuKruHto4buTbmd9TGluayB0b29sICYgaMaw4bubbmcgZOG6q24gdOG6oWkgVGVsZWdyYW17xJHhu499OiB7bOG7pWN9QEFpcmRyb3BUb29sQ2hhbm5lbFxuIikKICAgICAgZWxzZToKICAgICAgICBjb3VudEZ1bGxFbmVyZ3ksIGNvdW50VHVyYm8sIFJlY292ZXJ5Q29uZmlnLCBUYXBDb25maWcsIE1heEVuZXJneUNvbmZpZyA9IFNIT1AoaGVhZGVycywgcHJveGllcykKICAgICAgICBpZiBjb3VudEZ1bGxFbmVyZ3kgPiAwOgogICAgICAgICAgY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCBzdGF0dXNfY29kZSA9IEFDVElWRV9CT09TVChoZWFkZXJzLCB7InR5cGUiOiJmdWxsX2VuZXJneSJ9LCBwcm94aWVzKQogICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPCAzMDA6CiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY33EkMOjIGvDrWNoIGhv4bqhdCBGdWxsIEVuZXJneSIsIGVuZD0iICIpCiAgICAgICAgICAgIHVzZXJuYW1lLCBkYW1lLCBlbmVyZ3lMZWZ0LCBlbmVyZ3lNYXgsIGVuZXJneVBlclNlY29uZCwgYmFsYW5jZSwgbmFtZVNxdWFkLCBtZW1iZXJzLCBzY29yZVNxdWFkLCBpc1R1cmJvQXZhaWxhYmxlID0gUFJPRklMRShoZWFkZXJzLCBwcm94aWVzKQogICAgICAgICAgICBwcmludChmInvEkeG7j31be2xhbX17ZW5lcmd5TGVmdDosfXvEkWVufS97bGFtfXtlbmVyZ3lNYXg6LH17xJHhu499XVxuIikKICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j33EkMOjIGvDrWNoIGhv4bqhdCBGdWxsIEVuZXJneSBUSOG6pFQgQuG6oEkiKQogICAgICAgIGVsc2U6CiAgICAgICAgICBpZiBjb3VudFR1cmJvID4gMDoKICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCxjb3VudFR1cmJvKToKICAgICAgICAgICAgICBjb3VudFR1cmJvLCBjb3VudEZ1bGxFbmVyZ3ksIHN0YXR1c19jb2RlID0gQUNUSVZFX0JPT1NUKGhlYWRlcnMsIHsidHlwZSI6InR1cmJvIn0sIHByb3hpZXMpCiAgICAgICAgICAgICAgaWYgc3RhdHVzX2NvZGUgPCAzMDA6CiAgICAgICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfcSQw6Mga8OtY2ggaG/huqF0IFR1cmJvIiwgZW5kPSIgIikKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA9IGludCh0aW1lLnRpbWUoKSAqIDEwMDApCiAgICAgICAgICAgICAgICBhbW91bnQgPSA1MDAwKjUqZGFtZQogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg3KQogICAgICAgICAgICAgICAgZW5lcmd5TGVmdCwgbmV3YmFsYW5jZSA9IENMSUNLKGhlYWRlcnMsIHsic3RhcnRUaW1lc3RhbXAiOnRpbWVzdGFtcCwiYW1vdW50IjphbW91bnQsImlzVHVyYm8iOlRydWV9LCBwcm94aWVzKQogICAgICAgICAgICAgICAgc2NvcmUgPSBuZXdiYWxhbmNlIC0gYmFsYW5jZQogICAgICAgICAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICAgICAgICAgIHByaW50KGYie3bDoG5nfSt7c2NvcmU6LH0ge8SR4buPfcK7IHt2w6BuZ317bmV3YmFsYW5jZTosfSIpCiAgICAgICAgICAgICAgICBpZiBzY29yZSA+PSA1MDAwKjUqZGFtZToKICAgICAgICAgICAgICAgICAgZXhpdCgpCiAgICAgICAgICAgICAgICBiYWxhbmNlLCBUYXBDb25maWcsIFJlY292ZXJ5Q29uZmlnLCBNYXhFbmVyZ3lDb25maWcgPSBVUEdSQURFKGJhbGFuY2UsIFRhcENvbmZpZywgUmVjb3ZlcnlDb25maWcsIE1heEVuZXJneUNvbmZpZykKICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j33EkMOjIGvDrWNoIGhv4bqhdCBUdXJibyBUSOG6pFQgQuG6oEkiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9SOG6vlQgTMav4buiVCBDTElDSywgSOG6vlQgQk9PU1RFUlMge8SR4buPfcK7IHt2w6BuZ33EkOG7lEkgVMOASSBLSE/huqJOIikKICAgICAgICAgIGJyZWFrClJVTl9XT1JNRkFSRSgp"