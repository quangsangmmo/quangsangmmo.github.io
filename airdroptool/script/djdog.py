api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICIyLjAuMCIKbmFtZV90b29sID0gImRqZG9nIgpCQU5ORVIobmFtZV90b29sLCB2ZXJzaW9uKQpwcmludChmIiIiCnvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7bGFtfUPDgUMgQ0jhu6hDIE7Egk5HIEPhu6ZBIFRPT0wKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gY2xpY2sKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbsOibmcgY+G6pXAKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbMOgbSBuaGnhu4dtIHbhu6UgCiIiIikKZGVmIExPR0lOKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3RlbGVncmFtL2xvZ2luPyIrZGF0YSwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3RlbGVncmFtL2xvZ2luPyIrZGF0YSwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsiZGF0YSJdCiAgICAgIHVzZXJuYW1lID0gZ2V0ZGF0YVsidGVsZWdyYW1Vc2VybmFtZSJdCiAgICAgIHRva2VuID0gZ2V0ZGF0YVsiYWNjZXNzVG9rZW4iXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgREpET0ciKQogICAgICBSVU5fREpET0coKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiB1c2VybmFtZSwgdG9rZW4KZGVmIEJBUl9BTU9VTlQoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuZGpkb2cuaW8vcGV0L2JhckFtb3VudCIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5kamRvZy5pby9wZXQvYmFyQW1vdW50IixoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgZW5lcmd5ID0gZ2V0ZGF0YVsiYXZhaWxhYmxlQW1vdW50Il0KICAgICAgYmFsYW5jZSA9IGdldGRhdGFbImdvbGRBbW91bnQiXQogICAgICBsZXZlbCA9IGdldGRhdGFbImxldmVsIl0KICAgICAgZ29sZFBlclNlY29uZCA9IGdldGRhdGFbImdvbGRQZXJTZWNvbmQiXQogICAgICBtYXhFbmVyZ3kgPSBnZXRkYXRhWyJiYXJHb2xkTGltaXQiXQogICAgICBjbGlja0NvZWZmaWNpZW50ID0gZ2V0ZGF0YVsiY2xpY2tDb2VmZmljaWVudCJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBESkRPRyIpCiAgICAgIFJVTl9ESkRPRygpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGVuZXJneSwgYmFsYW5jZSwgbGV2ZWwsIGdvbGRQZXJTZWNvbmQsIG1heEVuZXJneSwgY2xpY2tDb2VmZmljaWVudApkZWYgSU5GT1JNQVRJT04oaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuZGpkb2cuaW8vcGV0L2luZm9ybWF0aW9uIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3BldC9pbmZvcm1hdGlvbiIsaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgYWRvcHRlZCA9IHJlc3BvbnNlLmpzb24oKVsiZGF0YSJdWyJhZG9wdGVkIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIERKRE9HIikKICAgICAgUlVOX0RKRE9HKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gYWRvcHRlZApkZWYgQURPUFRFRChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzWyJjb250ZW50LWxlbmd0aCJdID0gIjAiCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3BldC9hZG9wdCIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuZGpkb2cuaW8vcGV0L2Fkb3B0IixoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgaGVhZGVycy5wb3AoImNvbnRlbnQtbGVuZ3RoIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIERKRE9HIikKICAgICAgUlVOX0RKRE9HKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gZGF0YQpkZWYgQ0xJQ0soaGVhZGVycywgY291bnRDbGljaywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVyc1siY29udGVudC1sZW5ndGgiXSA9ICIwIgogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5kamRvZy5pby9wZXQvY29sbGVjdD9jbGlja3M9IitzdHIoY291bnRDbGljayksIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuZGpkb2cuaW8vcGV0L2NvbGxlY3Q/Y2xpY2tzPSIrc3RyKGNvdW50Q2xpY2spLGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICBpZiBnZXRkYXRhICE9IE5vbmU6CiAgICAgICAgYW1vdW50ID0gZ2V0ZGF0YVsiYW1vdW50Il0KICAgICAgZWxzZToKICAgICAgICBhbW91bnQgPSAnZXJyb3InCiAgICAgIGhlYWRlcnMucG9wKCJjb250ZW50LWxlbmd0aCIpCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBESkRPRyIpCiAgICAgIFJVTl9ESkRPRygpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGFtb3VudApkZWYgVEFTS19MSVNLKGhlYWRlcnMsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3Rhc2svbGlzdCIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5kamRvZy5pby90YXNrL2xpc3QiLGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGxpc3RUYXNrID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl1bInRhc2tEZXRhaWxzIl0KICAgICAgbmV4dFRhc2tMdkZsb29yID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl1bIm5leHRUYXNrTHZGbG9vciJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBESkRPRyIpCiAgICAgIFJVTl9ESkRPRygpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGxpc3RUYXNrLCBuZXh0VGFza0x2Rmxvb3IKZGVmIFRBU0tfRklOSVNIKGhlYWRlcnMsIGlkX3Rhc2ssIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIGhlYWRlcnNbImNvbnRlbnQtbGVuZ3RoIl0gPSAiMCIKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuZGpkb2cuaW8vdGFzay9maW5pc2g/dGFza0lkcz0iK3N0cihpZF90YXNrKSwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5kamRvZy5pby90YXNrL2ZpbmlzaD90YXNrSWRzPSIrc3RyKGlkX3Rhc2spLGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICBoZWFkZXJzLnBvcCgiY29udGVudC1sZW5ndGgiKQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgREpET0ciKQogICAgICBSVU5fREpET0coKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBkYXRhCmRlZiBCT1hfTUFMTChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5kamRvZy5pby9wZXQvYm94TWFsbCIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5kamRvZy5pby9wZXQvYm94TWFsbCIsaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgYmFsYW5jZSA9IHJlc3BvbnNlLmpzb24oKVsiZGF0YSJdWyJnb2xkQW1vdW50Il0KICAgICAgcHJpY2VVcHJhZGUgPSByZXNwb25zZS5qc29uKClbImRhdGEiXVsibGV2ZWxVcEFtb3VudCJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBESkRPRyIpCiAgICAgIFJVTl9ESkRPRygpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UsIHByaWNlVXByYWRlCmRlZiBMRVZFTF9VUChoZWFkZXJzLCBpZF90YXNrLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzWyJjb250ZW50LWxlbmd0aCJdID0gIjAiCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3BldC9sZXZlbFVwLzAiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmRqZG9nLmlvL3BldC9sZXZlbFVwLzAiLGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICBoZWFkZXJzLnBvcCgiY29udGVudC1sZW5ndGgiKQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgREpET0ciKQogICAgICBSVU5fREpET0coKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBkYXRhCgpkZWYgUlVOX0RKRE9HKCk6CiAgd2l0aCBvcGVuKCdjb25maWcvZGpkb2cuanNvbicsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToKICAgIGNvbmZpZ19kYXRhID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKQogIHVzZXJzID0gY29uZmlnX2RhdGEKICBpZiBsZW4odXNlcnMpID4gMTA6CiAgICBwcmludCgiQuG6oW4gY2jhu4kgxJHGsOG7o2MgcGjDqXAgdGjDqm0gdOG7kWkgxJFhIDEwIHTDoGkga2hv4bqjbiDEkeG7gyBjaOG6oXkgdG9vbCIpCiAgICBleGl0KCkKICBmb3IgdXNlciBpbiB1c2VyczoKICAgIGFjY291bnQgPSB1c2VyWyJTVFRfQUNDT1VOVCJdCiAgICBhdXRob3JpemF0aW9uID0gdXNlclsiQVVUSE9SSVpBVElPTiJdCiAgICBpZiBhdXRob3JpemF0aW9uID09ICIiIG9yIGF1dGhvcml6YXRpb24gPT0gInRoYXlfdGjhur9fYuG6sW5nX2F1dGhvcml6YXRpb24iOgogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499VMOgaSBraG/huqNuIHt2w6BuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfSB7xJHhu499REFUQSDEkWFuZyBi4buLIHRy4buRbmciKQogICAgICBjb250aW51ZQogICAgd2l0aCBvcGVuKCdjb25maWcvc2V0dGluZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgICBjb25maWdfYWNjID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKVthY2NvdW50XQogICAgcHJveHlfbGlzdCA9IGNvbmZpZ19hY2NbInByb3h5Il0KICAgIHR5cGVfcHJveHkgPSBjb25maWdfYWNjWyJ0eXBlX3Byb3h5Il0KICAgIHVzZXJfYWdlbnQgPSBjb25maWdfYWNjWyJ1c2VyLWFnZW50Il0KICAgIGlmIHByb3h5X2xpc3QgIT0gIiI6CiAgICAgIHByb3h5X2xpc3QgPSBwcm94eV9saXN0LnNwbGl0KCI6IikKICAgICAgcHJveHkgPSBmInt0eXBlX3Byb3h5fTovL3twcm94eV9saXN0WzJdfTp7cHJveHlfbGlzdFszXX1Ae3Byb3h5X2xpc3RbMF19Ontwcm94eV9saXN0WzFdfSIKICAgICAgcHJveGllcyA9IHsKICAgICAgJ2h0dHAnOiBwcm94eSwKICAgICAgJ2h0dHBzJzogcHJveHksfQogICAgZWxzZToKICAgICAgaWYgYWNjb3VudC5zcGxpdCgnXycpWzFdICE9ICIxIjoKICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31DaHV54buDbiB0w6BpIGtob+G6o24gZG8ga2jDtG5nIGPDsyBwcm94eSIpCiAgICAgICAgY29udGludWUKICAgICAgcHJveGllcyA9ICIiCiAgICBpcCwgZmFrZWlwID0gZ2V0SVAocHJveGllcykKICAgIGlmIGlwID09IGZha2VpcCA9PSBOb25lOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31cbsSQ4buUSSBUw4BJIEtIT+G6ok4gRE8gS0jDlE5HIEzhuqRZIMSQxq/hu6JDIElQLCBIw4NZIEtJ4buCTSBUUkEgTOG6oEkgUFJPWFlcbiIpCiAgICAgIGNvbnRpbnVlCiAgICBoZWFkZXJzID0gewogICAgICAnSG9zdCc6ICdhcGkuZGpkb2cuaW8nLAogICAgICAnc2VjLWNoLXVhJzogJyJOb3QvQSlCcmFuZCI7dj0iOCIsICJDaHJvbWl1bSI7dj0iMTI2IiwgIkFuZHJvaWQgV2ViVmlldyI7dj0iMTI2IicsCiAgICAgICdhY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qJywKICAgICAgJ3NlYy1jaC11YS1tb2JpbGUnOiAnPzEnLAogICAgICAndXNlci1hZ2VudCc6IHVzZXJfYWdlbnQsCiAgICAgICdzZWMtY2gtdWEtcGxhdGZvcm0nOiAnIkFuZHJvaWQiJywKICAgICAgJ29yaWdpbic6ICdodHRwczovL2RqZG9nLmlvJywKICAgICAgJ3gtcmVxdWVzdGVkLXdpdGgnOiAnbWFyay52aWEuZ3EnLAogICAgICAnc2VjLWZldGNoLXNpdGUnOiAnc2FtZS1zaXRlJywKICAgICAgJ3NlYy1mZXRjaC1tb2RlJzogJ2NvcnMnLAogICAgICAnc2VjLWZldGNoLWRlc3QnOiAnZW1wdHknLAogICAgICAnYWNjZXB0LWVuY29kaW5nJzogJ2d6aXAsIGRlZmxhdGUsIGJyLCB6c3RkJywKICAgICAgJ2FjY2VwdC1sYW5ndWFnZSc6ICd2aS1WTix2aTtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNycsCiAgICAgICdwcmlvcml0eSc6ICd1PTEsIGknCiAgfQogICAgI3VzZXJuYW1lLCB0b2tlbiA9IExPR0lOKGhlYWRlcnMsIGRhdGEsIHByb3hpZXMpCiAgICBoZWFkZXJzWyJhdXRob3JpemF0aW9uIl0gPSBhdXRob3JpemF0aW9uCiAgICBhZG9wdGVkID0gSU5GT1JNQVRJT04oaGVhZGVycywgcHJveGllcykKICAgIGlmIGFkb3B0ZWQgPT0gRmFsc2U6CiAgICAgICBkYXRhID0gQURPUFRFRChoZWFkZXJzLCBwcm94aWVzKQogICAgZW5lcmd5LCBiYWxhbmNlLCBsZXZlbCwgZ29sZFBlclNlY29uZCwgbWF4RW5lcmd5LCBjbGlja0NvZWZmaWNpZW50ID0gQkFSX0FNT1VOVChoZWFkZXJzLCBwcm94aWVzKQogICAgcHJpbnQoZiIiInvEkeG6rW19e8SRZW59PDw8PDw8PDw8PDw8PDw8PDx7bGFtfVt7dsOgbmdCR317xJHhu499VEjDlE5HIFRJTiBUw4BJIEtIT+G6ok4gREpET0cuSU97xJFlbkJHfXtsYW19XXvEkWVufT4+Pj4+Pj4+Pj4+Pj4+Pj5cbnvEkWVufeOAmPCfkaTjgJl7dHLhuq9uZ31Uw6BpIGtob+G6o257xJHhu499OiB7dHLhuq9uZ30oe2jhu5NuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfXt0cuG6r25nfSlcbnvEkWVufeOAmPCfqpnjgJl7dHLhuq9uZ31T4buRIETGsCB7xJHhu499OiB7dsOgbmd9e2JhbGFuY2U6LH1cbnvEkWVufeOAmPCflKLjgJl7dHLhuq9uZ31MZXZlbHvEkeG7j306IHtsYW19e2xldmVsfVxue8SRZW5944CY8J+TiuOAmXt0cuG6r25nfVRow7RuZyBz4buRIEdhbWV7xJHhu499OiB7bOG7pWN9e2VuZXJneX17xJFlbn0ve2zhu6VjfXttYXhFbmVyZ3l9IHvEkWVufXwge3bDoG5nfXtnb2xkUGVyU2Vjb25kfXvEkWVufS97dsOgbmd9c1xue8SRZW5944CY8J+Mj+OAmXt0cuG6r25nfUlQIHvEkeG7j306IHtuw6J1fXtpcH0ge2zhu6VjfcK7wrvCuyB7dHLhuq9uZ31GYWtlIElQIHvEkeG7j306IHtsYW19e2Zha2VpcH1cbiIiIikKICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgcHJpbnQoZiJ7xJHhu499XDAzM1sxOzMzOzQwbULhuq5UIMSQ4bqmVSBDSOG6oFkgVE9PTCB7dGjGsOG7nW5nfXvEkeG6rW19e8SR4buPfcK7IHvEkWVufVt7dsOgbmd9e3N0YXJ0X3RpbWUuc3RyZnRpbWUoJyVIOiVNOiVTJyl9e8SRZW59XVxuIikKICAgIHdoaWxlIFRydWU6CiAgICAgIGlmIGVuZXJneS9sZXZlbCA+IDEwOgogICAgICAgIGlmIGVuZXJneS9sZXZlbCA+IDUwMDoKICAgICAgICAgIGNvdW50Q2xpY2sgPSByYW5kb20ucmFuZGludCg0MDAsNTAwKQogICAgICAgIGVsc2U6CiAgICAgICAgICBjb3VudENsaWNrID0gaW50KGVuZXJneS9sZXZlbCkKICAgICAgZWxzZTogYnJlYWsKICAgICAgYW1vdW50ID0gQ0xJQ0soaGVhZGVycywgY291bnRDbGljaywgcHJveGllcykKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBpZiBhbW91bnQgPT0gJ2Vycm9yJzoKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9QuG7iyBkw61uaCBkZWxheSB7xJFlbn3CuyB7xJHhu499ROG7q25nIGNsaWNrIikKICAgICAgICBicmVhawogICAgICBpZiBhbW91bnQgPiAwOgogICAgICAgIHByaW50KGYie8SRZW594pWU4pWQe8SR4buPfVt7dsOgbmd9e25vd190aW1lfXvEkeG7j31dIHt0cuG6r25nfcSQw6MgY2xpY2sge2xhbX17Y291bnRDbGlja30ge3Ry4bqvbmd9bOG6p24ge3bDoG5nfSt7YW1vdW50Oix9IikKICAgICAgICBwcmludChmInvEkWVufeKVmuKruHto4buTbmd9TGluayB0b29sICYgaMaw4bubbmcgZOG6q24gdOG6oWkgVGVsZWdyYW17xJHhu499OiB7bOG7pWN9QEFpcmRyb3BUb29sQ2hhbm5lbFxuIikKICAgICAgZWxzZToKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfUNsaWNrIG5o4bqtbiBwb2lucyB0aOG6pXQgYuG6oWkiKQogICAgICBDT1VOVERPV04oMTApCiAgICAgIGVuZXJneSwgYmFsYW5jZSwgbGV2ZWwsIGdvbGRQZXJTZWNvbmQsIG1heEVuZXJneSwgY2xpY2tDb2VmZmljaWVudCA9IEJBUl9BTU9VTlQoaGVhZGVycywgcHJveGllcykKICAgIGJhbGFuY2UsIHByaWNlVXByYWRlID0gQk9YX01BTEwoaGVhZGVycywgcHJveGllcykKICAgIHdoaWxlIGJhbGFuY2UgPiBwcmljZVVwcmFkZToKICAgICAgZGF0YSA9IExFVkVMX1VQKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgaWYgZGF0YSA9PSBUcnVlOgogICAgICAgIGJhbGFuY2UsIHByaWNlVXByYWRlID0gQk9YX01BTEwoaGVhZGVycywgcHJveGllcykKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBuw6JuZyBj4bqlcCB7bGFtfUJPT1NUIHvEkeG7j30te3ByaWNlVXByYWRlOix9IHvEkWVufcK7IHt2w6BuZ317YmFsYW5jZTosfSIpCiAgICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31Ow6JuZyBj4bqlcCB0aOG6pXQgYuG6oWkiKQogICAgbGlzdFRhc2ssbmV4dFRhc2tMdkZsb29yID0gVEFTS19MSVNLKGhlYWRlcnMsIHByb3hpZXMpCiAgICBpZiBUcnVlOgogICAgICBmb3IgdGFzayBpbiBsaXN0VGFzazoKICAgICAgICBpZF90YXNrID0gdGFza1sidGFza0lkIl0KICAgICAgICByZXdhcmRfdGFzayA9IHRhc2tbInJld2FyZCJdCiAgICAgICAgaW52aXRlTnVtID0gdGFza1siaW52aXRlTnVtIl0KICAgICAgICBpZiB0YXNrWyJmaW5pc2hlZCJdID09IE5vbmUgYW5kIGludml0ZU51bSA9PSAwOgogICAgICAgICAgZGF0YSA9IFRBU0tfRklOSVNIKGhlYWRlcnMsIGlkX3Rhc2ssIHByb3hpZXMpCiAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICBpZiBkYXRhID09IFRydWU6CiAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGhvw6BuIHRow6BuaCBuaGnhu4dtIHbhu6Uge2xhbX17aWRfdGFza30ge3bDoG5nfSt7cmV3YXJkX3Rhc2s6LH0iKQogICAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31Ib8OgbiB0aMOgbmggbmhp4buHbSB24bulIHtsYW19e2lkX3Rhc2t9IHvEkeG7j310aOG6pXQgYuG6oWkiKQogICAgZWxzZToKICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q2jGsGEgxJHhuqF0IGxldmVsIHtsYW19e25leHRUYXNrTHZGbG9vcn0ge3Ry4bqvbmd9xJHhu4MgbMOgbSBuaGnhu4dtIHbhu6UiKQogICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9xJDhu5RJIFTDgEkgS0hP4bqiTiIpClJVTl9ESkRPRygp"