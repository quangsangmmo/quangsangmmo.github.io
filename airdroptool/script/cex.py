api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMCIKbmFtZV90b29sID0gImNleCIKQkFOTkVSKG5hbWVfdG9vbCwgdmVyc2lvbikKcHJpbnQoZiIiIgp7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge2xhbX1Dw4FDIENI4buoQyBOxIJORyBD4bumQSBUT09MCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIGNsaWNrCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIHN0YXJ0IGZhcm0Ke8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gY2xhaW0gZnJhbQp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9SG/DoG4gdGjDoG5oIGPDoWMgbmhp4buHbSB24bulIChuZ2/DoGkgVGVsZWdyYW0pCiIiIikKZGVmIGdldFVzZXJJbmZvKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIGlwID0gdGFza3MgPSBiYWxhbmNlID0gdXNlcm5hbWUgPSBlbWFpbCA9IGF2YWlsYWJsZVRhcHMgPSBmYXJtU3RhcnRlZEF0ID0gbWF4Q2hpbGRyZW5Db3VudCA9IHNlcnZlclRpbWUgPSBtaW5pbmdFcmFJbnRlcnZhbEluU2Vjb25kcyA9IE5vbmUKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvZ2V0VXNlckluZm8iLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvZ2V0VXNlckluZm8iLGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICAjcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICBmYXJtUmV3YXJkID0gZ2V0ZGF0YVsiZmFybVJld2FyZCJdCiAgICAgIGlmIGZhcm1SZXdhcmQgPT0gIjAuMDAiOgogICAgICAgIGZhcm1SZXdhcmQgPSBzdGFydEZhcm0oaGVhZGVycywgZGF0YSwgcHJveGllcykKICAgICAgICBpZiBwcm94aWVzOgogICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2NleHAuY2V4LmlvL2FwaS9nZXRVc2VySW5mbyIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgICAgZWxzZToKICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvZ2V0VXNlckluZm8iLGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICAgICNyZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgaXAgPSBnZXRkYXRhWyJpcCJdCiAgICAgIHRhc2tzID0gZ2V0ZGF0YVsidGFza3MiXQogICAgICBiYWxhbmNlID0gZ2V0ZGF0YVsiYmFsYW5jZSJdCiAgICAgIGlmICJ1c2VybmFtZSIgaW4gZ2V0ZGF0YToKICAgICAgICB1c2VybmFtZSA9IGdldGRhdGFbInVzZXJuYW1lIl0KICAgICAgZWxzZToKICAgICAgICB1c2VybmFtZSA9IGdldGRhdGFbImZpcnN0X25hbWUiXQogICAgICBlbWFpbCA9IGdldGRhdGFbImVtYWlsIl0KICAgICAgYXZhaWxhYmxlVGFwcyA9IGdldGRhdGFbImF2YWlsYWJsZVRhcHMiXQogICAgICBmYXJtU3RhcnRlZEF0ID0gZ2V0ZGF0YVsiZmFybVN0YXJ0ZWRBdCJdCiAgICAgIG1heENoaWxkcmVuQ291bnQgPSBnZXRkYXRhWyJtYXhDaGlsZHJlbkNvdW50Il0KICAgICAgc2VydmVyVGltZSA9IGdldGRhdGFbInNlcnZlclRpbWUiXQogICAgICBtaW5pbmdFcmFJbnRlcnZhbEluU2Vjb25kcyA9IGdldGRhdGFbIm1pbmluZ0VyYUludGVydmFsSW5TZWNvbmRzIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIENFWCIpCiAgICAgIFJVTl9DRVgoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBpcCwgdGFza3MsIGJhbGFuY2UsIHVzZXJuYW1lLCBlbWFpbCwgYXZhaWxhYmxlVGFwcywgZmFybVN0YXJ0ZWRBdCwgbWF4Q2hpbGRyZW5Db3VudCwgc2VydmVyVGltZSwgbWluaW5nRXJhSW50ZXJ2YWxJblNlY29uZHMKZGVmIGNsYWltVGFwcyhoZWFkZXJzLCBkYXRhLCB0YXBzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBpcCA9IGJhbGFuY2UgPSB1c2VybmFtZSA9IGVtYWlsID0gYXZhaWxhYmxlVGFwcyA9IGZhcm1TdGFydGVkQXQgPSBtYXhDaGlsZHJlbkNvdW50ID0gTm9uZQogIGRhdGFbImRhdGEiXVsidGFwcyJdID0gdGFwcwogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2NleHAuY2V4LmlvL2FwaS9jbGFpbVRhcHMiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvY2xhaW1UYXBzIixoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgI3Jlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgaXAgPSBkYXRhWyJpcCJdCiAgICAgIGJhbGFuY2UgPSBkYXRhWyJiYWxhbmNlIl0KICAgICAgdXNlcm5hbWUgPSBkYXRhWyJ1c2VybmFtZSJdCiAgICAgIGVtYWlsID0gZGF0YVsiZW1haWwiXQogICAgICBhdmFpbGFibGVUYXBzID0gZGF0YVsiYXZhaWxhYmxlVGFwcyJdCiAgICAgIGZhcm1TdGFydGVkQXQgPSBkYXRhWyJmYXJtU3RhcnRlZEF0Il0KICAgICAgbWF4Q2hpbGRyZW5Db3VudCA9IGRhdGFbIm1heENoaWxkcmVuQ291bnQiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgQ0VYIikKICAgICAgUlVOX0NFWCgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGlwLCBiYWxhbmNlLCB1c2VybmFtZSwgZW1haWwsICBhdmFpbGFibGVUYXBzLCBmYXJtU3RhcnRlZEF0LCBtYXhDaGlsZHJlbkNvdW50CmRlZiBjbGFpbUZhcm0oaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgYmFsYW5jZSA9IGNsYWltZWRCYWxhbmNlID0gTm9uZQogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2NleHAuY2V4LmlvL2FwaS9jbGFpbUZhcm0iLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvY2xhaW1GYXJtIixoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgI3Jlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgYmFsYW5jZSA9IGRhdGFbImJhbGFuY2UiXQogICAgICBjbGFpbWVkQmFsYW5jZSA9IGRhdGFbImNsYWltZWRCYWxhbmNlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIENFWCIpCiAgICAgIFJVTl9DRVgoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBiYWxhbmNlLCBjbGFpbWVkQmFsYW5jZQpkZWYgc3RhcnRGYXJtKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIGZhcm1SZXdhcmQgPSBOb25lCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vY2V4cC5jZXguaW8vYXBpL3N0YXJ0RmFybSIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2NleHAuY2V4LmlvL2FwaS9zdGFydEZhcm0iLGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICAjcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICBmYXJtUmV3YXJkID0gZGF0YVsiZmFybVJld2FyZCJdCiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY33EkMOjIGLhuq90IMSR4bqndSBGQVJNIHt2w6BuZ30re2Zhcm1SZXdhcmR9IHts4bulY31zYXUga2hpIGvhur90IHRow7pjIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIENFWCIpCiAgICAgIFJVTl9DRVgoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBmYXJtUmV3YXJkCmRlZiBzdGFydFRhc2soaGVhZGVycywgZGF0YSwgdGFza0lkLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBzdGF0ZSA9IHRpdGxlID0gcmV3YXJkID0gTm9uZQogIGRhdGFbImRhdGEiXVsidGFza0lkIl0gPSB0YXNrSWQKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvc3RhcnRUYXNrIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vY2V4cC5jZXguaW8vYXBpL3N0YXJ0VGFzayIsaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgICNyZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsiZGF0YSJdCiAgICAgIHN0YXRlID0gZGF0YVsic3RhdGUiXQogICAgICB0aXRsZSA9IGRhdGFbInRpdGxlIl0KICAgICAgcmV3YXJkID0gZGF0YVsicmV3YXJkIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIENFWCIpCiAgICAgIFJVTl9DRVgoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBzdGF0ZSwgdGl0bGUsIHJld2FyZApkZWYgY2hlY2tUYXNrKGhlYWRlcnMsIGRhdGEsIHRhc2tJZCwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgZGF0YVsiZGF0YSJdWyJ0YXNrSWQiXSA9IHRhc2tJZAogIHN0YXRlID0gdGl0bGUgPSBOb25lCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgd2hpbGUgc3RhdGUgIT0gIlJlYWR5VG9DbGFpbSI6CiAgICAgICAgaWYgcHJveGllczoKICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9jZXhwLmNleC5pby9hcGkvY2hlY2tUYXNrIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgICBlbHNlOgogICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2NleHAuY2V4LmlvL2FwaS9jaGVja1Rhc2siLGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICAgICNyZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgICBzdGF0ZSA9IGdldGRhdGFbInN0YXRlIl0KICAgICAgICB0aXRsZSA9IGdldGRhdGFbInRpdGxlIl0KICAgICAgICBpZiBzdGF0ZSA9PSAiUmVhZHlUb0NsYWltIjoKICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9Q2hlY2sge2xhbX17dGl0bGV9IHts4bulY31USMOATkggQ8OUTkciKQogICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31DaGVjayB7bGFtfXt0aXRsZX0ge8SR4buPfVRI4bqkVCBC4bqgSSIpCiAgICAgICAgICB0aW1lLnNsZWVwKDMwKQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgQ0VYIikKICAgICAgUlVOX0NFWCgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHN0YXRlLCB0aXRsZQpkZWYgY2xhaW1UYXNrKGhlYWRlcnMsIGRhdGEsIHRhc2tJZCwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgYmFsYW5jZSA9IGNsYWltZWRCYWxhbmNlID0gc3RhdGUgPSB0aXRsZSA9IE5vbmUKICBkYXRhWyJkYXRhIl1bInRhc2tJZCJdID0gdGFza0lkCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vY2V4cC5jZXguaW8vYXBpL2NsYWltVGFzayIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2NleHAuY2V4LmlvL2FwaS9jbGFpbVRhc2siLGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICAjcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICBiYWxhbmNlID0gZGF0YVsiYmFsYW5jZSJdCiAgICAgIGNsYWltZWRCYWxhbmNlID0gZGF0YVsiY2xhaW1lZEJhbGFuY2UiXQogICAgICBzdGF0ZSA9IGRhdGFbInRhc2siXVsic3RhdGUiXQogICAgICB0aXRsZSA9IGRhdGFbInRhc2siXVsidGl0bGUiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgQ0VYIikKICAgICAgUlVOX0NFWCgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UsIGNsYWltZWRCYWxhbmNlLCBzdGF0ZSwgdGl0bGUKCmRlZiBSVU5fQ0VYKCk6CiAgd2l0aCBvcGVuKCdjb25maWcvY2V4Lmpzb24nLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGU6CiAgICBjb25maWdfZGF0YSA9IGpzb24ubG9hZHMocmVtb3ZlX2NvbW1lbnRzKGZpbGUucmVhZCgpKSkKICB1c2VycyA9IGNvbmZpZ19kYXRhCiAgaWYgbGVuKHVzZXJzKSA+IDEwOgogICAgcHJpbnQoIkLhuqFuIGNo4buJIMSRxrDhu6NjIHBow6lwIHRow6ptIHThu5FpIMSRYSAxMCB0w6BpIGtob+G6o24gxJHhu4MgY2jhuqF5IHRvb2wiKQogICAgZXhpdCgpCiAgZm9yIHVzZXIgaW4gdXNlcnM6CiAgICBhY2NvdW50ID0gdXNlclsiU1RUX0FDQ09VTlQiXQogICAgZGF0YSA9IHVzZXJbIkRBVEEiXQogICAgaWYgZGF0YSA9PSAiIiBvciBkYXRhID09ICJ0aGF5X3Ro4bq/X2LhurFuZ19kYXRhIjoKICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfVTDoGkga2hv4bqjbiB7dsOgbmd9e2FjY291bnQuc3BsaXQoJ18nKVsxXX0ge8SR4buPfURBVEEgxJFhbmcgYuG7iyB0cuG7kW5nIikKICAgICAgY29udGludWUKICAgIHdpdGggb3BlbignY29uZmlnL3NldHRpbmcuanNvbicsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToKICAgICAgY29uZmlnX2FjYyA9IGpzb24ubG9hZHMocmVtb3ZlX2NvbW1lbnRzKGZpbGUucmVhZCgpKSlbYWNjb3VudF0KICAgIHByb3h5X2xpc3QgPSBjb25maWdfYWNjWyJwcm94eSJdCiAgICB0eXBlX3Byb3h5ID0gY29uZmlnX2FjY1sidHlwZV9wcm94eSJdCiAgICB1c2VyX2FnZW50ID0gY29uZmlnX2FjY1sidXNlci1hZ2VudCJdCiAgICBpZiBwcm94eV9saXN0ICE9ICIiOgogICAgICBwcm94eV9saXN0ID0gcHJveHlfbGlzdC5zcGxpdCgiOiIpCiAgICAgIHByb3h5ID0gZiJ7dHlwZV9wcm94eX06Ly97cHJveHlfbGlzdFsyXX06e3Byb3h5X2xpc3RbM119QHtwcm94eV9saXN0WzBdfTp7cHJveHlfbGlzdFsxXX0iCiAgICAgIHByb3hpZXMgPSB7CiAgICAgICdodHRwJzogcHJveHksCiAgICAgICdodHRwcyc6IHByb3h5LH0KICAgIGVsc2U6CiAgICAgIGlmIGFjY291bnQuc3BsaXQoJ18nKVsxXSAhPSAiMSI6CiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q2h1eeG7g24gdMOgaSBraG/huqNuIGRvIGtow7RuZyBjw7MgcHJveHkiKQogICAgICAgIGNvbnRpbnVlCiAgICAgIHByb3hpZXMgPSAiIgogICAgaXAsIGZha2VpcCA9IGdldElQKHByb3hpZXMpCiAgICBpZiBpcCA9PSBmYWtlaXAgPT0gTm9uZToKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499XG7EkOG7lEkgVMOASSBLSE/huqJOIERPIEtIw5RORyBM4bqkWSDEkMav4buiQyBJUCwgSMODWSBLSeG7gk0gVFJBIEzhuqBJIFBST1hZXG4iKQogICAgICBjb250aW51ZQogICAgaGVhZGVycyA9IHsKICAgICAgJ0hvc3QnOiAnY2V4cC5jZXguaW8nLAogICAgICAnc2VjLWNoLXVhJzogJyJDaHJvbWl1bSI7dj0iMTI0IiwgIkFuZHJvaWQgV2ViVmlldyI7dj0iMTI0IiwgIk5vdC1BLkJyYW5kIjt2PSI5OSInLAogICAgICAnYWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24sIHRleHQvcGxhaW4sICovKicsCiAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzogJz8xJywKICAgICAgJ3VzZXItYWdlbnQnOiB1c2VyX2FnZW50LAogICAgICAnc2VjLWNoLXVhLXBsYXRmb3JtJzogJyJBbmRyb2lkIicsCiAgICAgICdvcmlnaW4nOiAnaHR0cHM6Ly9jZXhwLmNleC5pbycsCiAgICAgICdyZWZlcmVyJzogJ2h0dHBzOi8vY2V4cC5jZXguaW8vJ30KICAgIGlwR2FtZSwgdGFza3MsIGJhbGFuY2UsIHVzZXJuYW1lLCBlbWFpbCwgYXZhaWxhYmxlVGFwcywgZmFybVN0YXJ0ZWRBdCwgbWF4Q2hpbGRyZW5Db3VudCwgc2VydmVyVGltZSwgbWluaW5nRXJhSW50ZXJ2YWxJblNlY29uZHMgPSBnZXRVc2VySW5mbyhoZWFkZXJzLCBkYXRhLCBwcm94aWVzKQogICAgcHJpbnQoZiIiInvEkeG6rW19e8SRZW59PDw8PDw8PDw8PDw8PDw8PDw8e2xhbX1be3bDoG5nQkd9e8SR4buPfVRIw5RORyBUSU4gVMOASSBLSE/huqJOIENFWC5JT3vEkWVuQkd9e2xhbX1de8SRZW59Pj4+Pj4+Pj4+Pj4+Pj4+Pj5cbnvEkWVufeOAmPCfkaTjgJl7dHLhuq9uZ31Vc2VyTmFtZSB7xJHhu499OiB7bOG7pWN9e3VzZXJuYW1lfSB7dHLhuq9uZ30oe2jhu5NuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfXt0cuG6r25nfSlcbnvEkWVufeOAmPCfqpnjgJl7dHLhuq9uZ31T4buRIETGsCB7xJHhu499OiB7dsOgbmd9e2JhbGFuY2V9XG57xJFlbn3jgJjwn5OK44CZe3Ry4bqvbmd9VGjDtG5nIHPhu5EgR2FtZXvEkeG7j306IHt2w6BuZ317YXZhaWxhYmxlVGFwc317xJFlbn0ve3bDoG5nfXttYXhDaGlsZHJlbkNvdW50fVxue8SRZW5944CY8J+Tp+OAmXt0cuG6r25nfUVtYWlse8SR4buPfToge3hhbmh9e2VtYWlsfVxue8SRZW5944CY8J+Mj+OAmXt0cuG6r25nfUlQIHvEkeG7j306IHtuw6J1fXtpcH0ge2zhu6VjfcK7wrvCuyB7dHLhuq9uZ31GYWtlIElQIHvEkeG7j306IHtsYW19e2Zha2VpcH1cbiIiIikKICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgcHJpbnQoZiJ7xJHhu499XDAzM1sxOzMzOzQwbULhuq5UIMSQ4bqmVSBDSOG6oFkgVE9PTCB7dGjGsOG7nW5nfXvEkeG6rW19e8SR4buPfcK7IHvEkWVufVt7dsOgbmd9e3N0YXJ0X3RpbWUuc3RyZnRpbWUoJyVIOiVNOiVTJyl9e8SRZW59XVxuIikKICAgIGlmIGF2YWlsYWJsZVRhcHMgPiAwOgogICAgICB0YXBzID0gYXZhaWxhYmxlVGFwcwogICAgICBpcCwgbmV3YmFsYW5jZSwgdXNlcm5hbWUsIGVtYWlsLCAgYXZhaWxhYmxlVGFwcywgZmFybVN0YXJ0ZWRBdCwgbWF4Q2hpbGRyZW5Db3VudCA9IGNsYWltVGFwcyhoZWFkZXJzLCBkYXRhLCB0YXBzLCBwcm94aWVzKQogICAgICBpZiBuZXdiYWxhbmNlID4gYmFsYW5jZToKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY33EkMOjIENMSUNLIHt0YXBzfSBs4bqnbiB7xJHhu499wrsge3bDoG5nfXtuZXdiYWxhbmNlfSIpCiAgICAgIGVsc2U6CiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499Q0xJQ0sge3RhcHN9IEzhuqZOIFRI4bqkVCBC4bqgSXvEkeG7j33CuyB7dsOgbmd9e25ld2JhbGFuY2V9IikKICAgIGVsc2U6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgaOG6v3QgbMaw4bujdCBjbGljayIpCiAgICBkdCA9IGRhdGV0aW1lLnN0cnB0aW1lKGZhcm1TdGFydGVkQXQsICIlWS0lbS0lZFQlSDolTTolUy4lZloiKQogICAgZHQgPSBkdC5yZXBsYWNlKHR6aW5mbz10aW1lem9uZS51dGMpCiAgICB0aW1lc3RhbXAgPSBpbnQoZHQudGltZXN0YW1wKCkgKiAxMDAwKQogICAgaWYgdGltZXN0YW1wK21pbmluZ0VyYUludGVydmFsSW5TZWNvbmRzKjEwMDAgPCBzZXJ2ZXJUaW1lOgogICAgICBiYWxhbmNlLCBjbGFpbWVkQmFsYW5jZSA9IGNsYWltRmFybShoZWFkZXJzLCBkYXRhLCBwcm94aWVzKQogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9xJDDoyBDbGFpbSBGQVJNIHt2w6BuZ30re2NsYWltZWRCYWxhbmNlfSB7xJHhu499wrsge3bDoG5nfXtiYWxhbmNlfSIpCiAgICAgICNmYXJtUmV3YXJkID0gc3RhcnRGYXJtKGhlYWRlcnMsIHByb3hpZXMpCiAgICBlbHNlOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ31DaMawYSDEkeG6v24gdGjhu51pIGdpYW4gbmjhuq1uIHtsYW19RmFybSBSZXdhcmRzIikKICAgIAogICAgZm9yIHRhc2tJZCBpbiB0YXNrczoKICAgICAgaWYgdGFza3NbdGFza0lkXVsicHJpb3JpdHkiXSA+IDcgYW5kIHRhc2tzW3Rhc2tJZF1bInN0YXRlIl0gIT0gIkNsYWltZWQiOgogICAgICAgICNwcmludCh0YXNrc1t0YXNrSWRdKQogICAgICAgIGlmICJKb2luIiBvciAiU3Vic2NyaWJlIiBpbiB0YXNrc1t0YXNrSWRdWyJ0aXRsZSJdOgogICAgICAgICAgY29udGludWUKICAgICAgICBpZiB0YXNrc1t0YXNrSWRdWyJzdGF0ZSJdID09ICJSZWFkeVRvQ2xhaW0iOgogICAgICAgICAgYmFsYW5jZSwgY2xhaW1lZEJhbGFuY2UsIHN0YXRlLCB0aXRsZSA9IGNsYWltVGFzayhoZWFkZXJzLCBkYXRhLCB0YXNrSWQsIHByb3hpZXMpCiAgICAgICAgICBpZiBzdGF0ZSA9PSAiQ2xhaW1lZCI6CiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfUhvw6BuIHRow6BuaCB7bGFtfXt0aXRsZX0ge3bDoG5nfSt7Y2xhaW1lZEJhbGFuY2V9IHvEkeG7j33CuyB7dsOgbmd9e2JhbGFuY2V9IikKICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31DbGFpbSB7bGFtfXt0aXRsZX0ge8SR4buPfSBUSOG6pFQgQuG6oEkiKQogICAgICAgIGVsaWYgdGFza3NbdGFza0lkXVsic3RhdGUiXSA9PSAiUmVhZHlUb0NoZWNrIjoKICAgICAgICAgIHN0YXRlLCB0aXRsZSA9IGNoZWNrVGFzayhoZWFkZXJzLCBkYXRhLCB0YXNrSWQsIHByb3hpZXMpCiAgICAgICAgICBpZiBzdGF0ZSA9PSAiUmVhZHlUb0NsYWltIjoKICAgICAgICAgICAgYmFsYW5jZSwgY2xhaW1lZEJhbGFuY2UsIHN0YXRlLCB0aXRsZSA9IGNsYWltVGFzayhoZWFkZXJzLCBkYXRhLCB0YXNrSWQsIHByb3hpZXMpCiAgICAgICAgICAgIGlmIHN0YXRlID09ICJDbGFpbWVkIjoKICAgICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfUhvw6BuIHRow6BuaCB7bGFtfXt0aXRsZX0ge3bDoG5nfSt7Y2xhaW1lZEJhbGFuY2V9IHvEkeG7j33CuyB7dsOgbmd9e2JhbGFuY2V9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31DbGFpbSB7bGFtfXt0aXRsZX0ge8SR4buPfSBUSOG6pFQgQuG6oEkiKQogICAgICAgICAgZWxzZToKICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfUNoZWNrIHtsYW19e3RpdGxlfSB7xJHhu499VEjhuqRUIELhuqBJIikKICAgICAgICBlbHNlOgogICAgICAgICAgc3RhdGUsIHRpdGxlLCByZXdhcmQgPSBzdGFydFRhc2soaGVhZGVycywgZGF0YSwgdGFza0lkLCBwcm94aWVzKQogICAgICAgICAgaWYgc3RhdGUgPT0gIlJlYWR5VG9DaGVjayI6CiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfVN0YXJ0IHtsYW19e3RpdGxlfSIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNjApCiAgICAgICAgICAgIHN0YXRlID0gY2hlY2tUYXNrKGhlYWRlcnMsIGRhdGEsIHRhc2tJZCwgcHJveGllcykKICAgICAgICAgICAgYmFsYW5jZSwgY2xhaW1lZEJhbGFuY2UsIHN0YXRlLCB0aXRsZSA9IGNsYWltVGFzayhoZWFkZXJzLCBkYXRhLCB0YXNrSWQsIHByb3hpZXMpCiAgICAgICAgICAgIGlmIHN0YXRlID09ICJDbGFpbWVkIjoKICAgICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfUhvw6BuIHRow6BuaCB7bGFtfXt0aXRsZX0ge3bDoG5nfSt7Y2xhaW1lZEJhbGFuY2V9IHvEkeG7j33CuyB7dsOgbmd9e2JhbGFuY2V9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31DbGFpbSB7bGFtfXt0aXRsZX0ge8SR4buPfVRI4bqkVCBC4bqgSSIpCiAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ33EkOG7lEkgVMOASSBLSE/huqJOIikKUlVOX0NFWCgp"