api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMSIKbmFtZV90b29sID0gImRvdGNvaW4iCkJBTk5FUihuYW1lX3Rvb2wsIHZlcnNpb24pCnByaW50KGYiIiIKe8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHtsYW19Q8OBQyBDSOG7qEMgTsSCTkcgQ+G7pkEgVE9PTAp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBjbGljawp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBz4butIGThu6VuZyBib29zdGVyCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIG7Dom5nIGPhuqVwIGJvb3N0ZXIgKGtow7RuZyBj4bqnbiB0aGnhur90KQp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBob8OgbiB0aMOgbmggY8OhYyBuaGnhu4dtIHbhu6UKIiIiKQpkZWYgUFJPRklMRShoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2pqdm5tb3luY21jZXdudXlreWlkLnN1cGFiYXNlLmNvL3Jlc3QvdjEvcnBjL2dldF91c2VyX2luZm8iLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249e30sIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9qanZubW95bmNtY2V3bnV5a3lpZC5zdXBhYmFzZS5jby9yZXN0L3YxL3JwYy9nZXRfdXNlcl9pbmZvIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXt9LCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICB1c2VybmFtZSA9IGdldGRhdGFbImZpcnN0X25hbWUiXQogICAgICBsZXZlbCA9IGdldGRhdGFbImxldmVsIl0KICAgICAgZW5lcmd5ID0gZ2V0ZGF0YVsiZGFpbHlfYXR0ZW1wdHMiXQogICAgICBlbmVyZ3lNYXggPSBnZXRkYXRhWyJsaW1pdF9hdHRlbXB0cyJdCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJiYWxhbmNlIl0KICAgICAgZGFtZSA9IGdldGRhdGFbIm11bHRpcGxlX2NsaWNrcyJdCiAgICAgIGNsYW4gPSBnZXRkYXRhWyJncm91cCJdCiAgICAgIHRyeV9sdWNrID0gZ2V0ZGF0YVsiZ2FtZXgyX3RpbWVzIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIERPVENPSU4iKQogICAgICBSVU5fRE9UQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHVzZXJuYW1lLCBiYWxhbmNlLCBlbmVyZ3ksIGNsYW4sIGRhbWUsIGVuZXJneU1heCwgbGV2ZWwsIHRyeV9sdWNrCmRlZiBDTElDSyhoZWFkZXJzLCBkYXRhLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzWyJDb250ZW50LUxlbmd0aCJdID0gc3RyKGxlbihzdHIoZGF0YSkucmVwbGFjZSgiICIsIiIpKSkKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9qanZubW95bmNtY2V3bnV5a3lpZC5zdXBhYmFzZS5jby9yZXN0L3YxL3JwYy9zYXZlX2NvaW5zIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vamp2bm1veW5jbWNld251eWt5aWQuc3VwYWJhc2UuY28vcmVzdC92MS9ycGMvc2F2ZV9jb2lucyIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgc3VjY2VzcyA9IHJlc3BvbnNlLmpzb24oKVsic3VjY2VzcyJdCiAgICAgICNwcmludChyZXNwb25zZS50ZXh0KQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgRE9UQ09JTiIpCiAgICAgIFJVTl9ET1RDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gc3VjY2VzcwpkZWYgTEVWRUxfVVAoaGVhZGVycywgZGF0YSwgdHlwZVVwZ3JhZGUsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9qanZubW95bmNtY2V3bnV5a3lpZC5zdXBhYmFzZS5jby9yZXN0L3YxL3JwYy97dHlwZVVwZ3JhZGV9IiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoZiJodHRwczovL2pqdm5tb3luY21jZXdudXlreWlkLnN1cGFiYXNlLmNvL3Jlc3QvdjEvcnBjL3t0eXBlVXBncmFkZX0iLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIHN1Y2Nlc3MgPSByZXNwb25zZS5qc29uKClbInN1Y2Nlc3MiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgRE9UQ09JTiIpCiAgICAgIFJVTl9ET1RDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gc3VjY2VzcwpkZWYgVFJZX0xVQ0soaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoZiJodHRwczovL2pqdm5tb3luY21jZXdudXlreWlkLnN1cGFiYXNlLmNvL3Jlc3QvdjEvcnBjL3RyeV95b3VyX2x1Y2siLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249eyJjb2lucyI6MTUwMDAwfSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmImh0dHBzOi8vamp2bm1veW5jbWNld251eWt5aWQuc3VwYWJhc2UuY28vcmVzdC92MS9ycGMvdHJ5X3lvdXJfbHVjayIsIGhlYWRlcnM9aGVhZGVycywganNvbj17ImNvaW5zIjoxNTAwMDB9LCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgI3ByaW50KHJlc3BvbnNlLmpzb24oKSkKICAgICAgc3VjY2VzcyA9IHJlc3BvbnNlLmpzb24oKVsic3VjY2VzcyJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBET1RDT0lOIikKICAgICAgUlVOX0RPVENPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBzdWNjZXNzCmRlZiBMSVNUX1RBU0soaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChmImh0dHBzOi8vYXBpLmRvdGNvaW4uYm90L3Jlc3QvdjEvcnBjL2dldF9maWx0ZXJlZF90YXNrcz9wbGF0Zm9ybT1hbmRyb2lkJmxvY2FsZT12aSZpc19wcmVtaXVtPWZhbHNlIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoZiJodHRwczovL2FwaS5kb3Rjb2luLmJvdC9yZXN0L3YxL3JwYy9nZXRfZmlsdGVyZWRfdGFza3M/cGxhdGZvcm09YW5kcm9pZCZsb2NhbGU9dmkmaXNfcHJlbWl1bT1mYWxzZSIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcHJpbnQocmVzcG9uc2Uuc3RhdHVzX2NvZGUpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBsaXN0VGFzayA9IHJlc3BvbnNlLmpzb24oKQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgRE9UQ09JTiIpCiAgICAgIFJVTl9ET1RDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gbGlzdFRhc2sKZGVmIExJU1RfVEFTSyhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5kb3Rjb2luLmJvdC9yZXN0L3YxL3JwYy9nZXRfZmlsdGVyZWRfdGFza3M/cGxhdGZvcm09YW5kcm9pZCZsb2NhbGU9dmkmaXNfcHJlbWl1bT1mYWxzZSIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5kb3Rjb2luLmJvdC9yZXN0L3YxL3JwYy9nZXRfZmlsdGVyZWRfdGFza3M/cGxhdGZvcm09YW5kcm9pZCZsb2NhbGU9dmkmaXNfcHJlbWl1bT1mYWxzZSIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIHByaW50KHJlc3BvbnNlLnN0YXR1c19jb2RlKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBET1RDT0lOIikKICAgICAgUlVOX0RPVENPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBnZXRkYXRhCmRlZiBDT01QTEVURV9UQVNLKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9hcGkuZG90Y29pbi5ib3QvcmVzdC92MS9ycGMvY29tcGxldGVfdGFzayIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9hcGkuZG90Y29pbi5ib3QvcmVzdC92MS9ycGMvY29tcGxldGVfdGFzayIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgcHJpbnQocmVzcG9uc2UuanNvbigpKQogICAgICBzdWNjZXNzID0gcmVzcG9uc2UuanNvbigpWyJzdWNjZXNzIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIERPVENPSU4iKQogICAgICBSVU5fRE9UQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHN1Y2Nlc3MKZGVmIEpPSU5fR1JPVVAoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoZiJodHRwczovL2FwaS5kb3Rjb2luLmJvdC9yZXN0L3YxL3JwYy9qb2luX2dyb3VwIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXsiZ2lkIjoxMDAxMDA2NTAzMTIyfSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmImh0dHBzOi8vYXBpLmRvdGNvaW4uYm90L3Jlc3QvdjEvcnBjL2pvaW5fZ3JvdXAiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249eyJnaWQiOjEwMDEwMDY1MDMxMjJ9LCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgI3ByaW50KHJlc3BvbnNlLmpzb24oKSkKICAgICAgdGl0bGUgPSByZXNwb25zZS5qc29uKClbInRpdGxlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIERPVENPSU4iKQogICAgICBSVU5fRE9UQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHRpdGxlCgoKZGVmIFJVTl9ET1RDT0lOKCk6CiAgd2l0aCBvcGVuKCdjb25maWcvZG90Y29pbi5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgY29uZmlnX2RhdGEgPSBqc29uLmxvYWRzKHJlbW92ZV9jb21tZW50cyhmaWxlLnJlYWQoKSkpCiAgdXNlcnMgPSBjb25maWdfZGF0YQogIGlmIGxlbih1c2VycykgPiAxMDoKICAgIHByaW50KCJC4bqhbiBjaOG7iSDEkcaw4bujYyBwaMOpcCB0aMOqbSB04buRaSDEkWEgMTAgdMOgaSBraG/huqNuIMSR4buDIGNo4bqheSB0b29sIikKICAgIGV4aXQoKQogIGZvciB1c2VyIGluIHVzZXJzOgogICAgYWNjb3VudCA9IHVzZXJbIlNUVF9BQ0NPVU5UIl0KICAgIGRhdGFfZG90Y29pbiA9IHVzZXJbIkRBVEEiXQogICAgaWYgZGF0YV9kb3Rjb2luID09ICIiIG9yIGRhdGFfZG90Y29pbiA9PSBbInRoYXlfdGjhur9fYuG6sW5nX2F1dGhvcml6YXRpb24iLCJ0aGF5X3Ro4bq/X2LhurFuZ194LXRlbGVncmFtLXVzZXItaWQiXToKICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfVTDoGkga2hv4bqjbiB7dsOgbmd9e2FjY291bnQuc3BsaXQoJ18nKVsxXX0ge8SR4buPfURBVEEgxJFhbmcgYuG7iyB0cuG7kW5nIikKICAgICAgY29udGludWUKICAgIGF1dGhvcml6YXRpb24gPSBkYXRhX2RvdGNvaW5bMF0KICAgIHVzZXJfaWQgPSBkYXRhX2RvdGNvaW5bMV0KICAgIHdpdGggb3BlbignY29uZmlnL3NldHRpbmcuanNvbicsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToKICAgICAgY29uZmlnX2FjYyA9IGpzb24ubG9hZHMocmVtb3ZlX2NvbW1lbnRzKGZpbGUucmVhZCgpKSlbYWNjb3VudF0KICAgIHByb3h5X2xpc3QgPSBjb25maWdfYWNjWyJwcm94eSJdCiAgICB0eXBlX3Byb3h5ID0gY29uZmlnX2FjY1sidHlwZV9wcm94eSJdCiAgICB1c2VyX2FnZW50ID0gY29uZmlnX2FjY1sidXNlci1hZ2VudCJdCiAgICBpZiBwcm94eV9saXN0ICE9ICIiOgogICAgICBwcm94eV9saXN0ID0gcHJveHlfbGlzdC5zcGxpdCgiOiIpCiAgICAgIHByb3h5ID0gZiJ7dHlwZV9wcm94eX06Ly97cHJveHlfbGlzdFsyXX06e3Byb3h5X2xpc3RbM119QHtwcm94eV9saXN0WzBdfTp7cHJveHlfbGlzdFsxXX0iCiAgICAgIHByb3hpZXMgPSB7CiAgICAgICdodHRwJzogcHJveHksCiAgICAgICdodHRwcyc6IHByb3h5LH0KICAgIGVsc2U6CiAgICAgIGlmIGFjY291bnQuc3BsaXQoJ18nKVsxXSAhPSAiMSI6CiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q2h1eeG7g24gdMOgaSBraG/huqNuIGRvIGtow7RuZyBjw7MgcHJveHkiKQogICAgICAgIGNvbnRpbnVlCiAgICAgIHByb3hpZXMgPSAiIgogICAgaXAsIGZha2VpcCA9IGdldElQKHByb3hpZXMpCiAgICBpZiBpcCA9PSBmYWtlaXAgPT0gTm9uZToKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499XG7EkOG7lEkgVMOASSBLSE/huqJOIERPIEtIw5RORyBM4bqkWSDEkMav4buiQyBJUCwgSMODWSBLSeG7gk0gVFJBIEzhuqBJIFBST1hZXG4iKQogICAgICBjb250aW51ZQogICAgaGVhZGVycyA9IHsKICAgICAgIkNvbnRlbnQtTGVuZ3RoIjogIjIiLAogICAgICAiWC1DbGllbnQtSW5mbyI6ICJwb3N0Z3Jlc3QtanMvMC4wLjAtYXV0b21hdGVkIiwKICAgICAgIlNlYy1DSC1VQSI6ICciQW5kcm9pZCBXZWJWaWV3Ijt2PSIxMjUiLCAiQ2hyb21pdW0iO3Y9IjEyNSIsICJOb3QuQS9CcmFuZCI7dj0iMjQiJywKICAgICAgIlNlYy1DSC1VQS1Nb2JpbGUiOiAiPzEiLAogICAgICAiQXV0aG9yaXphdGlvbiI6IGF1dGhvcml6YXRpb24sCiAgICAgICJVc2VyLUFnZW50IjogdXNlcl9hZ2VudCwKICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgIkNvbnRlbnQtUHJvZmlsZSI6ICJwdWJsaWMiLAogICAgICAiQXBpa2V5IjogImV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpwYzNNaU9pSnpkWEJoWW1GelpTSXNJbkpsWmlJNkltcHFkbTV0YjNsdVkyMWpaWGR1ZFhscmVXbGtJaXdpY205c1pTSTZJbUZ1YjI0aUxDSnBZWFFpT2pFM01EZzNNREU1T0RJc0ltVjRjQ0k2TWpBeU5ESTNOems0TW4wLm9aaF9FQ0E2ZkEyTmx3b1VhbWYxVHFGNDVsck1DMHVJZEpYdlZpdERiWjgiLAogICAgICAiWC1UZWxlZ3JhbS1Vc2VyLUlkIjogdXNlcl9pZCwKICAgICAgIlNlYy1DSC1VQS1QbGF0Zm9ybSI6ICciQW5kcm9pZCInLAogICAgICAiQWNjZXB0IjogIiovKiIsCiAgICAgICJPcmlnaW4iOiAiaHR0cHM6Ly9kb3QuZGFwcGxhYi54eXoiLAogICAgICAiU2VjLUZldGNoLVNpdGUiOiAiY3Jvc3Mtc2l0ZSIsCiAgICAgICJTZWMtRmV0Y2gtTW9kZSI6ICJjb3JzIiwKICAgICAgIlNlYy1GZXRjaC1EZXN0IjogImVtcHR5IiwKICAgICAgIlJlZmVyZXIiOiAiaHR0cHM6Ly9kb3QuZGFwcGxhYi54eXovIiwKICAgICAgIkFjY2VwdC1FbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlLCBiciwgenN0ZCIsCiAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAidmktVk4sdmk7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjciLAogICAgICAiUHJpb3JpdHkiOiAidT0xLCBpIn0KICAgIHVzZXJuYW1lLCBiYWxhbmNlLCBlbmVyZ3ksIGNsYW4sIGRhbWUsIGVuZXJneU1heCwgbGV2ZWwsIHRyeV9sdWNrID0gUFJPRklMRShoZWFkZXJzLCBwcm94aWVzKQogICAgaWYgY2xhbiAhPSBOb25lOgogICAgICB0aXRsZUNsYW4gPSBjbGFuWyJ0aXRsZSJdCiAgICAgIGNvaW5zQ2xhbiA9IGYie2NsYW5bJ3RvdGFsX2NvaW5zJ106LH0iCiAgICAgIG1lbWJlcnNDbGFuID0gY2xhblsidG90YWxfdXNlcnMiXQogICAgICBlbmVyZ3lDbGFuID0gY2xhblsiYXR0ZW1wdHMiXQogICAgICBkYW1lQ2xhbiA9IGNsYW5bIm11bHRpdGFwIl0KICAgIGVsc2U6CiAgICAgIHRpdGxlQ2xhbiA9IGNvaW5zQ2xhbiA9IG1lbWJlcnNDbGFuID0gZW5lcmd5Q2xhbiA9IGRhbWVDbGFuID0gTm9uZQogICAgcHJpbnQoZiIiInvEkeG6rW19e8SRZW59PDw8PDw8PDw8PDw8PDw8PDx7bGFtfVt7dsOgbmdCR317xJHhu499VEjDlE5HIFRJTiBUw4BJIEtIT+G6ok4gRE9UQ09JTnvEkWVuQkd9e2xhbX1de8SRZW59Pj4+Pj4+Pj4+Pj4+Pj4+Pj5cbnvEkWVufeOAmPCfkaTjgJl7dHLhuq9uZ31Vc2VyTmFtZSB7xJHhu499OiB7bOG7pWN9e3VzZXJuYW1lfSB7dHLhuq9uZ30oe2jhu5NuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfXt0cuG6r25nfSlcbnvEkWVufeOAmPCfqpnjgJl7dHLhuq9uZ31T4buRIETGsCB7xJHhu499OiB7dsOgbmd9e2JhbGFuY2U6LH1cbnvEkWVufeOAmPCfk4rjgJl7dHLhuq9uZ31UaMO0bmcgc+G7kSBHYW1le8SR4buPfToge2zhu6VjfSt7ZGFtZX17xJFlbn0ve2zhu6VjfWNsaWNrIHt2w6BuZ317ZW5lcmd5fXvEkeG7j30ve3bDoG5nfXtlbmVyZ3lNYXh94pqhXG57xJFlbn3jgJjwn5On44CZe3Ry4bqvbmd9VGjDtG5nIHRpbiBDbGFue8SR4buPfToge3hhbmh9e3RpdGxlQ2xhbn0ge8SRZW59fHt2w6BuZ317Y29pbnNDbGFuffCfqpl7xJFlbn18e2zhu6VjfXttZW1iZXJzQ2xhbn3wn5Gle8SRZW59fHt2w6BuZ30re2VuZXJneUNsYW598J+UiyB7aOG7k25nfSt7ZGFtZUNsYW598J+Rhlxue8SRZW5944CY8J+Mj+OAmXt0cuG6r25nfUlQIHvEkeG7j306IHtuw6J1fXtpcH0ge2zhu6VjfcK7wrvCuyB7dHLhuq9uZ31GYWtlIElQIHvEkeG7j306IHtsYW19e2Zha2VpcH1cbiIiIikKICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgcHJpbnQoZiJ7xJHhu499XDAzM1sxOzMzOzQwbULhuq5UIMSQ4bqmVSBDSOG6oFkgVE9PTCB7dGjGsOG7nW5nfXvEkeG6rW19e8SR4buPfcK7IHvEkWVufVt7dsOgbmd9e3N0YXJ0X3RpbWUuc3RyZnRpbWUoJyVIOiVNOiVTJyl9e8SRZW59XVxuIikKICAgIGlmIGNsYW4gPT0gTm9uZToKICAgICAgdHJ5OgogICAgICAgIHRpdGxlID0gSk9JTl9HUk9VUChoZWFkZXJzLCBwcm94aWVzKQogICAgICAgIGlmIHRpdGxlOgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgdGhhbSBnaWEgZ3JvdXAge3bDoG5nfXt0aXRsZX1cbiIpCiAgICAgIGV4Y2VwdDogcGFzcwogICAgaWYgdHJ5X2x1Y2sgPiAwOgogICAgICBzdWNjZXNzID0gVFJZX0xVQ0soaGVhZGVycywgcHJveGllcykKICAgICAgaWYgc3VjY2VzcyA9PSBUcnVlOgogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBuaOG6rW4gxJHGsOG7o2MgezE1MDAwMDosfSB04burIHt2w6BuZ31Eb3Rjb2luIEdhbWUgeDJcbiIpCiAgICBkZWYgVVBHUkFERShiYWxhbmNlLCBkYW1lLCBlbmVyZ3ksIGVuZXJneU1heCk6CiAgICAgIHN1Y2Nlc3MgPSBMRVZFTF9VUChoZWFkZXJzLCB7Imx2bCI6ZGFtZX0sICJhZGRfbXVsdGl0YXAiLCBwcm94aWVzKQogICAgICBpZiBzdWNjZXNzID09IFRydWU6CiAgICAgICAgdXNlcm5hbWUsIG5ld2JhbGFuY2UsIGVuZXJneSwgY2xhbiwgZGFtZSwgZW5lcmd5TWF4LCBsZXZlbCA9IFBST0ZJTEUoaGVhZGVycywgcHJveGllcykKICAgICAgICBwcmljZSA9IGJhbGFuY2UgLSBuZXdiYWxhbmNlCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIG7Dom5nIGPhuqVwIHto4buTbmd9TXVsdGl0YXAge3Ry4bqvbmd9KHtsYW19e2RhbWUtMX17dHLhuq9uZ30pIHvEkeG7j30te3ByaWNlfSB7xJFlbn3CuyB7dsOgbmd9e25ld2JhbGFuY2U6LH1cbiIpCiAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgc3VjY2VzcyA9IExFVkVMX1VQKGhlYWRlcnMsIHsibHZsIjplbmVyZ3lNYXgtOX0sICJhZGRfYXR0ZW1wdHMiLCBwcm94aWVzKQogICAgICBpZiBzdWNjZXNzID09IFRydWU6CiAgICAgICAgdXNlcm5hbWUsIG5ld2JhbGFuY2UsIGVuZXJneSwgY2xhbiwgZGFtZSwgZW5lcmd5TWF4LCBsZXZlbCA9IFBST0ZJTEUoaGVhZGVycywgcHJveGllcykKICAgICAgICBwcmljZSA9IGJhbGFuY2UgLSBuZXdiYWxhbmNlCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIG7Dom5nIGPhuqVwIHto4buTbmd9RGFpbHkgQXR0ZW1wdHMge3Ry4bqvbmd9KHtsYW19e2VuZXJneU1heC0xMH17dHLhuq9uZ30pIHvEkeG7j30te3ByaWNlOix9IHvEkWVufcK7IHt2w6BuZ317bmV3YmFsYW5jZTosfVxuIikKICAgICAgICBiYWxhbmNlID0gbmV3YmFsYW5jZQogICAgICByZXR1cm4gYmFsYW5jZSwgZGFtZSwgZW5lcmd5LCBlbmVyZ3lNYXgKICAgICNiYWxhbmNlLCBkYW1lLCBlbmVyZ3ksIGVuZXJneU1heCA9IFVQR1JBREUoYmFsYW5jZSwgZGFtZSwgZW5lcmd5LCBlbmVyZ3lNYXgpCiAgICAiIiIKICAgIGxpc3RUYXNrID0gTElTVF9UQVNLKGhlYWRlcnMsIHByb3hpZXMpCiAgICBmb3IgdGFzayBpbiBsaXN0VGFzazoKICAgICAgaWYgdGFza1siY2F0ZWdvcnkiXSAhPSAxOgogICAgICAgIHByaW50KHRhc2spCiAgICAgICAgc3VjY2VzcyA9IENPTVBMRVRFX1RBU0soaGVhZGVycywgeyJvaWQiOnRhc2tbJ2lkJ119LCBwcm94aWVzKQogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBpZiBzdWNjZXNzID09IFRydWU6CiAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBob8OgbiB0aMOgbmgge2xhbX17dGFza1sndGl0bGUnXX0ge3bDoG5nfSt7dGFza1sncmV3YXJkJ106LH1cbiIpCiAgICAgICAgZWxzZToKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499SG/DoG4gdGjDoG5oIHtsYW19e3Rhc2tbJ3RpdGxlJ119IHvEkeG7j310aOG6pXQgYuG6oWlcbiIpCiAgICAiIiIKICAgIHdoaWxlIFRydWU6CiAgICAgIGlmIGVuZXJneSA+IDA6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCxlbmVyZ3kpOgogICAgICAgICAgI3ByaW50KCkKICAgICAgICAgIHN1Y2Nlc3MgPSBDTElDSyhoZWFkZXJzLCB7ImNvaW5zIjoyMDAwMH0sIHByb3hpZXMpCiAgICAgICAgICBpZiBzdWNjZXNzID09IFRydWU6CiAgICAgICAgICAgIHVzZXJuYW1lLCBuZXdiYWxhbmNlLCBlbmVyZ3ksIGNsYW4sIGRhbWUsIGVuZXJneU1heCwgbGV2ZWwsIHRyeV9sdWNrID0gUFJPRklMRShoZWFkZXJzLCBwcm94aWVzKQogICAgICAgICAgICBjb2xsZWN0QW1vdW50ID0gbmV3YmFsYW5jZSAtIGJhbGFuY2UKICAgICAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICBwcmludChmInvEkWVufeKVlOKVkHvEkeG7j31be3bDoG5nfXtub3dfdGltZX17xJHhu499XSB7dHLhuq9uZ33EkMOjIENMSUNLIHt2w6BuZ30re2NvbGxlY3RBbW91bnQ6LH0ge8SR4buPfeKAoiB7bGFtfXtlbmVyZ3l9IGVuZXJneSB7xJHhu499wrsiLCBlbmQ9IiAiKQogICAgICAgICAgICBwcmludChmInt2w6BuZ317bmV3YmFsYW5jZTosfVxue8SRZW594pWa4qu4e2jhu5NuZ31MaW5rIHRvb2wgJiBoxrDhu5tuZyBk4bqrbiB04bqhaSBUZWxlZ3JhbXvEkeG7j306IHts4bulY31AQWlyZHJvcFRvb2xDaGFubmVsXG4iKQogICAgICAgICAgICAjYmFsYW5jZSwgZGFtZSwgZW5lcmd5LCBlbmVyZ3lNYXggPSBVUEdSQURFKGJhbGFuY2UsIGRhbWUsIGVuZXJneSwgZW5lcmd5TWF4KQogICAgICAgICAgZWxzZToKICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfSBDbGljayB0aOG6pXQgYuG6oWkhIikKICAgICAgZWxzZToKICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31I4bq+VCBMxq/hu6JUIENMSUNLLCBI4bq+VCBCT09TVEVSUyB7xJHhu499wrsge3bDoG5nfcSQ4buUSSBUw4BJIEtIT+G6ok4iKQogICAgICAgIGJyZWFrClJVTl9ET1RDT0lOKCk="