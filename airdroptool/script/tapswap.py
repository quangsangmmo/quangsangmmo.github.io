api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMCIKbmFtZV90b29sID0gInRhcHN3YXAiCkJBTk5FUihuYW1lX3Rvb2wsIHZlcnNpb24pCgpkZWYgTE9HSU4oaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVyc1siQ29udGVudC1MZW5ndGgiXSA9IHN0cihsZW4oc3RyKGRhdGEpLnJlcGxhY2UoIiAiLCIiKSkpCiAgYWNjZXNzX3Rva2VuID0gdXNlcm5hbWUgPSBlbmVyZ3kgPSBiYWxhbmNlID0gbGlndWUgPSBkYW1lID0gZW5lcmd5X2xldmVsID0gY2hhcmdlX2xldmVsID0gY291bnRUdXJibyA9IGNvdW50RnVsbEVuZXJneSA9IE5vbmUKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkudGFwc3dhcC5haS9hcGkvYWNjb3VudC9sb2dpbiIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS50YXBzd2FwLmFpL2FwaS9hY2NvdW50L2xvZ2luIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBhY2Nlc3NfdG9rZW4gPSByZXNwb25zZS5qc29uKClbImFjY2Vzc190b2tlbiJdCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbInBsYXllciJdCiAgICAgIHVzZXJuYW1lID0gZ2V0ZGF0YVsibmFtZSJdCiAgICAgIGVuZXJneSA9IGdldGRhdGFbImVuZXJneSJdCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJzaGFyZXMiXQogICAgICBsaWd1ZSA9IGdldGRhdGFbImxpZ3VlIl0KICAgICAgZGFtZSA9IGdldGRhdGFbInRhcF9sZXZlbCJdCiAgICAgIGVuZXJneV9sZXZlbCA9IGdldGRhdGFbImVuZXJneV9sZXZlbCJdCiAgICAgIGNoYXJnZV9sZXZlbCA9IGdldGRhdGFbImNoYXJnZV9sZXZlbCJdCiAgICAgIGNvdW50VHVyYm8gPSBnZXRkYXRhWyJib29zdCJdWzFdWyJjbnQiXQogICAgICBjb3VudEZ1bGxFbmVyZ3kgPSBnZXRkYXRhWyJib29zdCJdWzBdWyJjbnQiXQogICAgICBjb25mID0gcmVzcG9uc2UuanNvbigpWyJjb25mIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgZXJyb3JfY291bnQgKz0gMQogICAgICBwcmludChmInvEkeG7j31Iw6BtIExPR0lOLCDEkWFuZyB44bqjeSByYSBs4buXaS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499LiBM4buXaToge3N0cihlKX0iKQogICAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IMSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBow6BtIFJVTl9UQVBTV0FQKCkiKQogICAgICAgIFJVTl9UQVBTV0FQKCkKICAgICAgICBicmVhawogICAgICBDT1VOVERPV04oMTApCiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEtleUVycm9yKSBhcyBlOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KGYie8SR4buPfUjDoG0gTE9HSU4sIEVycm9yOiB7c3RyKGUpfS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499IikKICAgICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqXt0cuG6r25nfSDEkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgaMOgbSBSVU5fVEFQU1dBUCgpIikKICAgICAgICBSVU5fVEFQU1dBUCgpCiAgICAgICAgYnJlYWsKICAgICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBhY2Nlc3NfdG9rZW4sIHVzZXJuYW1lLCBlbmVyZ3ksIGJhbGFuY2UsIGxpZ3VlLCBkYW1lLCBlbmVyZ3lfbGV2ZWwsIGNoYXJnZV9sZXZlbCwgY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCBjb25mCgpkZWYgU1VCTUlUX1RBUFMoaGVhZGVycywgY29udGVudF9pZCwgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgaGVhZGVyc1siQ29udGVudC1MZW5ndGgiXSA9IHN0cihsZW4oc3RyKGRhdGEpLnJlcGxhY2UoIiAiLCIiKSkpCiAgaGVhZGVyc1siQ29udGVudC1JZCJdID0gc3RyKGNvbnRlbnRfaWQpCiAgdXNlcm5hbWUgPSBlbmVyZ3kgPSBiYWxhbmNlICA9IE5vbmUKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkudGFwc3dhcC5haS9hcGkvcGxheWVyL3N1Ym1pdF90YXBzIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLnRhcHN3YXAuYWkvYXBpL3BsYXllci9zdWJtaXRfdGFwcyIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsicGxheWVyIl0KICAgICAgZW5lcmd5ID0gZ2V0ZGF0YVsiZW5lcmd5Il0KICAgICAgYmFsYW5jZSA9IGdldGRhdGFbInNoYXJlcyJdCiAgICAgIGhlYWRlcnMucG9wKCJDb250ZW50LUlkIikKICAgICAgaGVhZGVycy5wb3AoIkNvbnRlbnQtTGVuZ3RoIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgZXJyb3JfY291bnQgKz0gMQogICAgICBwcmludChmInvEkeG7j31Iw6BtIFNVQk1JVF9UQVBTLCDEkWFuZyB44bqjeSByYSBs4buXaS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499LiBM4buXaToge3N0cihlKX0iKQogICAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IMSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBow6BtIFJVTl9UQVBTV0FQKCkiKQogICAgICAgIFJVTl9UQVBTV0FQKCkKICAgICAgICBicmVhawogICAgICBDT1VOVERPV04oMTApCiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEtleUVycm9yKSBhcyBlOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KGYie8SR4buPfUjDoG0gU1VCTUlUX1RBUFMsIEVycm9yOiB7c3RyKGUpfS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499IikKICAgICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqXt0cuG6r25nfSDEkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgaMOgbSBSVU5fVEFQU1dBUCgpIikKICAgICAgICBSVU5fVEFQU1dBUCgpCiAgICAgICAgYnJlYWsKICAgICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBlbmVyZ3ksIGJhbGFuY2UKCmRlZiBMRVZFTF9VUChoZWFkZXJzLCBkYXRhLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzWyJDb250ZW50LUxlbmd0aCJdID0gc3RyKGxlbihzdHIoZGF0YSkucmVwbGFjZSgiICIsIiIpKSkKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkudGFwc3dhcC5haS9hcGkvcGxheWVyL3VwZ3JhZGUiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkudGFwc3dhcC5haS9hcGkvcGxheWVyL3VwZ3JhZGUiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbInBsYXllciJdCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJzaGFyZXMiXQogICAgICB0eXBlVXBncmFkZSA9IGRhdGFbInR5cGUiXQogICAgICBsZXZlbCA9IGdldGRhdGFbZiJ7dHlwZVVwZ3JhZGV9X2xldmVsIl0KICAgICAgaGVhZGVycy5wb3AoIkNvbnRlbnQtTGVuZ3RoIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb24gYXMgZToKICAgICAgZXJyb3JfY291bnQgKz0gMQogICAgICBwcmludChmInvEkeG7j31Iw6BtIExFVkVMX1VQLCDEkWFuZyB44bqjeSByYSBs4buXaS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499LiBM4buXaToge3N0cihlKX0iKQogICAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IMSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBow6BtIFJVTl9UQVBTV0FQKCkiKQogICAgICAgIFJVTl9UQVBTV0FQKCkKICAgICAgICBicmVhawogICAgICBDT1VOVERPV04oMTApCiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEtleUVycm9yKSBhcyBlOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KGYie8SR4buPfUjDoG0gTEVWRUxfVVAsIEVycm9yOiB7c3RyKGUpfS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499IikKICAgICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqXt0cuG6r25nfSDEkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgaMOgbSBSVU5fVEFQU1dBUCgpIikKICAgICAgICBSVU5fVEFQU1dBUCgpCiAgICAgICAgYnJlYWsKICAgICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBiYWxhbmNlLCBsZXZlbAoKZGVmIEFDVElWRV9CT09TVChoZWFkZXJzLCBkYXRhLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBoZWFkZXJzWyJDb250ZW50LUxlbmd0aCJdID0gc3RyKGxlbihzdHIoZGF0YSkucmVwbGFjZSgiICIsIiIpKSkKICB1c2VybmFtZSA9IGVuZXJneSA9IGJhbGFuY2UgID0gTm9uZQogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS50YXBzd2FwLmFpL2FwaS9wbGF5ZXIvYXBwbHlfYm9vc3QiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkudGFwc3dhcC5haS9hcGkvcGxheWVyL2FwcGx5X2Jvb3N0IiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJwbGF5ZXIiXQogICAgICBjb3VudFR1cmJvID0gZ2V0ZGF0YVsiYm9vc3QiXVsxXVsiY250Il0KICAgICAgY291bnRGdWxsRW5lcmd5ID0gZ2V0ZGF0YVsiYm9vc3QiXVswXVsiY250Il0KICAgICAgc3RhdHVzX2NvZGUgPSByZXNwb25zZS5zdGF0dXNfY29kZQogICAgICBlbmVyZ3kgPSBnZXRkYXRhWyJlbmVyZ3kiXQogICAgICBoZWFkZXJzLnBvcCgiQ29udGVudC1MZW5ndGgiKQogICAgICBicmVhawogICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KGYie8SR4buPfUjDoG0gQUNUSVZFX0JPT1NULCDEkWFuZyB44bqjeSByYSBs4buXaS4gVGjhu60gbOG6oWkgbOG6p24ge3bDoG5nfXtlcnJvcl9jb3VudH17xJFlbn0ve3bDoG5nfXttYXhfcmV0cmllc317xJHhu499LiBM4buXaToge3N0cihlKX0iKQogICAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IMSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBow6BtIFJVTl9UQVBTV0FQKCkiKQogICAgICAgIFJVTl9UQVBTV0FQKCkKICAgICAgICBicmVhawogICAgICBDT1VOVERPV04oMTApCiAgICBleGNlcHQgKFZhbHVlRXJyb3IsIEtleUVycm9yKSBhcyBlOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KGYie8SR4buPfUjDoG0gQUNUSVZFX0JPT1NULCBFcnJvcjoge3N0cihlKX0uIFRo4butIGzhuqFpIGzhuqduIHt2w6BuZ317ZXJyb3JfY291bnR9e8SRZW59L3t2w6BuZ317bWF4X3JldHJpZXN9e8SR4buPfSIpCiAgICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6l7dHLhuq9uZ30gxJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGjDoG0gUlVOX1RBUFNXQVAoKSIpCiAgICAgICAgUlVOX1RBUFNXQVAoKQogICAgICAgIGJyZWFrCiAgICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCBzdGF0dXNfY29kZSwgZW5lcmd5CgpkZWYgUlVOX1RBUFNXQVAoKToKICBzdHQgPSAwCiAgd2l0aCBvcGVuKCdjb25maWcvdGFwc3dhcC5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgY29uZmlnX2RhdGEgPSBqc29uLmxvYWRzKHJlbW92ZV9jb21tZW50cyhmaWxlLnJlYWQoKSkpCiAgdXNlcnMgPSBjb25maWdfZGF0YQogIGlmIGxlbih1c2VycykgPiAxMDoKICAgIHByaW50KCJC4bqhbiBjaOG7iSDEkcaw4bujYyBwaMOpcCB0aMOqbSB04buRaSDEkWEgMTAgdMOgaSBraG/huqNuIMSR4buDIGNo4bqheSB0b29sIikKICAgIGV4aXQoKQogIGZvciB1c2VyIGluIHVzZXJzOgogICAgYWNjb3VudCA9IHVzZXJbIlNUVF9BQ0NPVU5UIl0KICAgIGRhdGEgPSB1c2VyWyJEQVRBIl0KICAgIGlmIGRhdGEgPT0gIiI6CiAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31Uw6BpIGtob+G6o24ge3bDoG5nfXthY2NvdW50LnNwbGl0KCdfJylbMV19IHvEkeG7j31EQVRBIMSRYW5nIGLhu4sgdHLhu5FuZyIpCiAgICAgIGNvbnRpbnVlCiAgICB3aXRoIG9wZW4oJ2NvbmZpZy9zZXR0aW5nLmpzb24nLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGU6CiAgICAgIGNvbmZpZ19hY2MgPSBqc29uLmxvYWRzKHJlbW92ZV9jb21tZW50cyhmaWxlLnJlYWQoKSkpW2FjY291bnRdCiAgICBkYXRhID0gdXNlclsiZGF0YV90YXBzd2FwIl1bMF0KICAgIGNvbnRlbnRfaWQgPSB1c2VyWyJkYXRhX3RhcHN3YXAiXVsxXQogICAgdGltZXN0YW1wID0gdXNlclsiZGF0YV90YXBzd2FwIl1bMl0KICAgIGNhY2hlX2lkID0gdXNlclsiZGF0YV90YXBzd2FwIl1bM10KICAgIHByb3h5X2xpc3QgPSBjb25maWdfYWNjWyJwcm94eSJdCiAgICB0eXBlX3Byb3h5ID0gY29uZmlnX2FjY1sidHlwZV9wcm94eSJdCiAgICB1c2VyX2FnZW50ID0gY29uZmlnX2FjY1sidXNlci1hZ2VudCJdCiAgICBpZiBwcm94eV9saXN0ICE9ICIiOgogICAgICBwcm94eV9saXN0ID0gcHJveHlfbGlzdC5zcGxpdCgiOiIpCiAgICAgIHByb3h5ID0gZiJ7dHlwZV9wcm94eX06Ly97cHJveHlfbGlzdFsyXX06e3Byb3h5X2xpc3RbM119QHtwcm94eV9saXN0WzBdfTp7cHJveHlfbGlzdFsxXX0iCiAgICAgIHByb3hpZXMgPSB7CiAgICAgICdodHRwJzogcHJveHksCiAgICAgICdodHRwcyc6IHByb3h5LH0KICAgIGVsc2U6CiAgICAgIGlmIGFjY291bnQuc3BsaXQoJ18nKVsxXSAhPSAiMSI6CiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q2h1eeG7g24gdMOgaSBraG/huqNuIGRvIGtow7RuZyBjw7MgcHJveHkiKQogICAgICAgIGNvbnRpbnVlCiAgICAgIHByb3hpZXMgPSAiIgogICAgaXAsIGZha2VpcCA9IGdldElQKHByb3hpZXMpCiAgICBpZiBpcCA9PSBmYWtlaXAgPT0gTm9uZToKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499XG7EkOG7lEkgVMOASSBLSE/huqJOIERPIEtIw5RORyBM4bqkWSDEkMav4buiQyBJUCwgSMODWSBLSeG7gk0gVFJBIEzhuqBJIFBST1hZXG4iKQogICAgICBjb250aW51ZQogICAgaGVhZGVycyA9IHsKICAgICAgIkhvc3QiOiAiYXBpLnRhcHN3YXAuYWkiLAogICAgICAiQ29ubmVjdGlvbiI6ICJrZWVwLWFsaXZlIiwKICAgICAgInNlYy1jaC11YSI6ICciQW5kcm9pZCBXZWJWaWV3Ijt2PSIxMjUiLCAiQ2hyb21pdW0iO3Y9IjEyNSIsICJOb3QuQS9CcmFuZCI7dj0iMjQiJywKICAgICAgIngtYm90IjogIm5vIiwKICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAiVXNlci1BZ2VudCI6IHVzZXJfYWdlbnQsCiAgICAgICJ4LWN2IjogIjYzMSIsCiAgICAgICJDYWNoZS1JZCI6IGNhY2hlX2lkLAogICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAieC1hcHAiOiAidGFwc3dhcF9zZXJ2ZXIiLAogICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICJBY2NlcHQiOiAiKi8qIiwKICAgICAgIk9yaWdpbiI6ICJodHRwczovL2FwcC50YXBzd2FwLmNsdWIiLAogICAgICAiWC1SZXF1ZXN0ZWQtV2l0aCI6ICJtYXJrLnZpYS5neCIsCiAgICAgICJTZWMtRmV0Y2gtU2l0ZSI6ICJjcm9zcy1zaXRlIiwKICAgICAgIlNlYy1GZXRjaC1Nb2RlIjogImNvcnMiLAogICAgICAiU2VjLUZldGNoLURlc3QiOiAiZW1wdHkiLAogICAgICAiUmVmZXJlciI6ICJodHRwczovL2FwcC50YXBzd2FwLmNsdWIvIiwKICAgICAgIkFjY2VwdC1FbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlLCBiciwgenN0ZCIsCiAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAidmktVk4sdmk7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjciCiAgICB9CiAgICBhY2Nlc3NfdG9rZW4sIHVzZXJuYW1lLCBlbmVyZ3ksIGJhbGFuY2UsIGxpZ3VlLCBkYW1lLCBlbmVyZ3lfbGV2ZWwsIGNoYXJnZV9sZXZlbCwgY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCBjb25mID0gTE9HSU4oaGVhZGVycywgZGF0YSwgcHJveGllcykKICAgIGhlYWRlcnNbIkF1dGhvcml6YXRpb24iXSA9IGYiQmVhcmVyIHthY2Nlc3NfdG9rZW59IgogICAgbGlndWVfbmFtZSA9IGNvbmZbJ2xpZ3VlcyddW2xpZ3VlXVsndGl0bGUnXQogICAgZW5lcmd5TWF4ID0gZW5lcmd5X2xldmVsICogNTAwCiAgICBwcmludChmIiIie8SR4bqtbX17xJFlbn08PDw8PDw8PDw8PDw8PDw8e2xhbX1be3bDoG5nQkd9e8SR4buPfVRIw5RORyBUSU4gVMOASSBLSE/huqJOIFRBUFNXQVB7xJFlbkJHfXtsYW19XXvEkWVufT4+Pj4+Pj4+Pj4+Pj4+Pj4+XG57xJFlbn3jgJjwn5Gk44CZe3Ry4bqvbmd9VXNlck5hbWUge8SR4buPfToge2zhu6VjfXt1c2VybmFtZX0ge3Ry4bqvbmd9KHto4buTbmd9e2FjY291bnQuc3BsaXQoJ18nKVsxXX17dHLhuq9uZ30pXG57xJFlbn3jgJjwn6qZ44CZe3Ry4bqvbmd9U+G7kSBExrAge8SR4buPfToge3bDoG5nfXtiYWxhbmNlOix9XG57xJFlbn3jgJjwn5Si44CZe3Ry4bqvbmd9TGV2ZWwge8SR4buPfToge2xhbX17bGlndWVfbmFtZX0gXG57xJFlbn3jgJjwn5OK44CZe3Ry4bqvbmd9VGjDtG5nIHPhu5EgR2FtZXvEkeG7j306IHt2w6BuZ30re2RhbWV9e8SRZW59L3t2w6BuZ31jbGljayB7xJHhu499W3tsYW19e2VuZXJneX17xJFlbn0ve2xhbX17ZW5lcmd5TWF4fXvEkeG7j31dIHt2w6BuZ317Y291bnRUdXJib30ge2NvdW50RnVsbEVuZXJneX1cbnvEkWVufeOAmPCfjI/jgJl7dHLhuq9uZ31JUCB7xJHhu499OiB7bsOidX17aXB9IHts4bulY33Cu8K7wrsge3Ry4bqvbmd9RmFrZSBJUCB7xJHhu499OiB7bGFtfXtmYWtlaXB9XG4iIiIpCiAgICBzdGFydF90aW1lID0gZGF0ZXRpbWUubm93KCkKICAgIHByaW50KGYie8SR4buPfVwwMzNbMTszMzs0MG1C4bquVCDEkOG6plUgQ0jhuqBZIFRPT0wge3RoxrDhu51uZ317xJHhuq1tfXvEkeG7j33CuyB7xJFlbn1be3bDoG5nfXtzdGFydF90aW1lLnN0cmZ0aW1lKCclSDolTTolUycpfXvEkWVufV1cbiIpCiAgICBUYXBDb25maWcgPSB7InByaWNlIjo5OTk5OTk5OTl9CiAgICBFbmVyZ3lDb25maWcgPSB7InByaWNlIjo5OTk5OTk5OTl9CiAgICBSZWNvdmVyeUNvbmZpZyA9IHsicHJpY2UiOjk5OTk5OTk5OX0KICAgIGlmIGRhbWUgPCBsZW4oY29uZlsidGFwX2xldmVscyJdKToKICAgICAgVGFwQ29uZmlnID1jb25mWyJ0YXBfbGV2ZWxzIl1bZGFtZV0KICAgIGlmIGVuZXJneV9sZXZlbCA8IGxlbihjb25mWyJlbmVyZ3lfbGV2ZWxzIl0pOgogICAgICBFbmVyZ3lDb25maWcgPWNvbmZbImVuZXJneV9sZXZlbHMiXVtlbmVyZ3lfbGV2ZWxdCiAgICBpZiBjaGFyZ2VfbGV2ZWwgPCBsZW4oY29uZlsiY2hhcmdlX2xldmVscyJdKToKICAgICAgUmVjb3ZlcnlDb25maWcgPWNvbmZbImNoYXJnZV9sZXZlbHMiXVtjaGFyZ2VfbGV2ZWxdCiAgICBkZWYgVVBHUkFERShiYWxhbmNlLCBUYXBDb25maWcsIEVuZXJneUNvbmZpZywgUmVjb3ZlcnlDb25maWcpOgogICAgICB3aGlsZSBiYWxhbmNlID4gVGFwQ29uZmlnWyJwcmljZSJdIG9yIGJhbGFuY2UgPiBFbmVyZ3lDb25maWdbInByaWNlIl0gb3IgYmFsYW5jZSA+IFJlY292ZXJ5Q29uZmlnWyJwcmljZSJdOgogICAgICAgIGlmIFJlY292ZXJ5Q29uZmlnWyJwcmljZSJdIDw9IFRhcENvbmZpZ1sicHJpY2UiXSBhbmQgUmVjb3ZlcnlDb25maWdbInByaWNlIl0gPD0gRW5lcmd5Q29uZmlnWyJwcmljZSJdOgogICAgICAgICAgbmFtZVVwZ3JhZGUgPSAiUmVjaGFyZ2luZyBTcGVlZCIKICAgICAgICAgIHR5cGVVcGdyYWRlID0gImNoYXJnZSIKICAgICAgICAgIHByaWNlID0gUmVjb3ZlcnlDb25maWdbInByaWNlIl0KICAgICAgICBlbGlmIFRhcENvbmZpZ1sicHJpY2UiXSA8PSBSZWNvdmVyeUNvbmZpZ1sicHJpY2UiXSBhbmQgVGFwQ29uZmlnWyJwcmljZSJdIDw9IEVuZXJneUNvbmZpZ1sicHJpY2UiXToKICAgICAgICAgIG5hbWVVcGdyYWRlID0gIk11bHRpdGFwIgogICAgICAgICAgdHlwZVVwZ3JhZGUgPSAidGFwIgogICAgICAgICAgcHJpY2UgPSBUYXBDb25maWdbInByaWNlIl0KICAgICAgICBlbHNlOgogICAgICAgICAgbmFtZVVwZ3JhZGUgPSAiRW5lcmd5IExpbWl0IgogICAgICAgICAgdHlwZVVwZ3JhZGUgPSAiZW5lcmd5IgogICAgICAgICAgcHJpY2UgPSBFbmVyZ3lDb25maWdbInByaWNlIl0KICAgICAgICBpZiBwcmljZSA8IDk5OTk5OTk5OToKICAgICAgICAgIGJhbGFuY2UsIGxldmVsID0gTEVWRUxfVVAoaGVhZGVycywgeyJ0eXBlIjp0eXBlVXBncmFkZX0sIHByb3hpZXMpCiAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAge2jhu5NuZ317bmFtZVVwZ3JhZGV9IHt0cuG6r25nfSh7bGFtfXtsZXZlbH17dHLhuq9uZ30pIHts4bulY33igKIge8SR4buPfS17cHJpY2V9IHvEkWVufcK7IHt2w6BuZ317YmFsYW5jZTosfSIpCiAgICAgICAgICBhY2Nlc3NfdG9rZW4sIHVzZXJuYW1lLCBlbmVyZ3ksIGJhbGFuY2UsIGxpZ3VlLCBkYW1lLCBlbmVyZ3lfbGV2ZWwsIGNoYXJnZV9sZXZlbCwgY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCBjb25mID0gTE9HSU4oaGVhZGVycywgZGF0YSwgcHJveGllcykKICAgICAgICAgIGhlYWRlcnNbIkF1dGhvcml6YXRpb24iXSA9IGYiQmVhcmVyIHthY2Nlc3NfdG9rZW59IgogICAgICAgICAgVGFwQ29uZmlnID1jb25mWyJ0YXBfbGV2ZWxzIl1bZGFtZV0KICAgICAgICAgIEVuZXJneUNvbmZpZyA9Y29uZlsiZW5lcmd5X2xldmVscyJdW2VuZXJneV9sZXZlbF0KICAgICAgICAgIFJlY292ZXJ5Q29uZmlnID1jb25mWyJjaGFyZ2VfbGV2ZWxzIl1bY2hhcmdlX2xldmVsXQogICAgICByZXR1cm4gYmFsYW5jZSwgVGFwQ29uZmlnLCBFbmVyZ3lDb25maWcsIFJlY292ZXJ5Q29uZmlnCiAgICAiIiJwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31Ow4JORyBD4bqkUCBCT09TVCIpCiAgICBiYWxhbmNlLCBUYXBDb25maWcsIEVuZXJneUNvbmZpZywgUmVjb3ZlcnlDb25maWcgPSBVUEdSQURFKGJhbGFuY2UsIFRhcENvbmZpZywgRW5lcmd5Q29uZmlnLCBSZWNvdmVyeUNvbmZpZykKICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31LSMOUTkcgxJDhu6YgVEnhu4BOIE7Dgk5HIEPhuqRQIEJPT1NUIikiIiIKICAgIHdoaWxlIFRydWU6CiAgICAgIGlmIGVuZXJneS9kYW1lID4gMTA6CiAgICAgICAgaWYgZW5lcmd5L2RhbWUgPiAxMDA6CiAgICAgICAgICBjb3VudFRhcCA9IHJhbmRvbS5yYW5kaW50KDEwMCxpbnQoZW5lcmd5L2RhbWUpKQogICAgICAgIGVsc2U6CiAgICAgICAgICBjb3VudFRhcCA9IGludChlbmVyZ3kvZGFtZSkKICAgICAgICBlbmVyZ3ksIG5ld2JhbGFuY2UgPSBTVUJNSVRfVEFQUyhoZWFkZXJzLCBjb250ZW50X2lkLCB7InRhcHMiOmNvdW50VGFwLCJ0aW1lIjogdGltZXN0YW1wfSwgcHJveGllcykKICAgICAgICBzY29yZSA9IG5ld2JhbGFuY2UgLSBiYWxhbmNlCiAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgcHJpbnQoZiJ7xJFlbn3ilZTilZB7xJHhu499W3t2w6BuZ317bm93X3RpbWV9e8SR4buPfV0ge3Ry4bqvbmd9xJDDoyBDTElDSyB7bOG7pWN9e2NvdW50VGFwfSB7dHLhuq9uZ31s4bqnbiB7dsOgbmd9K3tzY29yZX0ge8SR4buPfcK7IHt2w6BuZ317bmV3YmFsYW5jZTosfSIpCiAgICAgICAgcHJpbnQoZiJ7xJFlbn3ilZriq7h7aOG7k25nfUxpbmsgdG9vbCAmIGjGsOG7m25nIGThuqtuIHThuqFpIFRlbGVncmFte8SR4buPfToge2zhu6VjfUBBbnViaXNNTU9cbiIpCiAgICAgIGVsc2U6CiAgICAgICAgYWNjZXNzX3Rva2VuLCB1c2VybmFtZSwgZW5lcmd5LCBiYWxhbmNlLCBsaWd1ZSwgZGFtZSwgZW5lcmd5X2xldmVsLCBjaGFyZ2VfbGV2ZWwsIGNvdW50VHVyYm8sIGNvdW50RnVsbEVuZXJneSwgY29uZiA9IExPR0lOKGhlYWRlcnMsIGRhdGEsIHByb3hpZXMpCiAgICAgICAgaGVhZGVyc1siQXV0aG9yaXphdGlvbiJdID0gZiJCZWFyZXIge2FjY2Vzc190b2tlbn0iCiAgICAgICAgaWYgY291bnRGdWxsRW5lcmd5ID4gMDoKICAgICAgICAgIGNvdW50VHVyYm8sIGNvdW50RnVsbEVuZXJneSwgc3RhdHVzX2NvZGUsIGVuZXJneSA9IEFDVElWRV9CT09TVChoZWFkZXJzLCB7InR5cGUiOiJlbmVyZ3kifSwgcHJveGllcykKICAgICAgICAgIGlmIHN0YXR1c19jb2RlID09IDIwMToKICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfcSQw6Mga8OtY2ggaG/huqF0IEZ1bGwgRW5lcmd5IiwgZW5kPSIgIikKICAgICAgICAgICAgZW5lcmd5TWF4ID0gZW5lcmd5X2xldmVsICogNTAwCiAgICAgICAgICAgIHByaW50KGYie8SR4buPfVt7bGFtfXtlbmVyZ3l9e8SRZW59L3tsYW19e2VuZXJneU1heH17xJHhu499XVxuIikKICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j33EkMOjIGvDrWNoIGhv4bqhdCBGdWxsIEVuZXJneSBUSOG6pFQgQuG6oElcbiIpCiAgICAgICAgZWxzZToKICAgICAgICAgIGlmIGNvdW50VHVyYm8gPiAwOgogICAgICAgICAgICBmb3IgaSBpbiByYW5nZSgwLGNvdW50VHVyYm8pOgogICAgICAgICAgICAgIGNvdW50VHVyYm8sIGNvdW50RnVsbEVuZXJneSwgc3RhdHVzX2NvZGUsIGVuZXJneSA9IEFDVElWRV9CT09TVChoZWFkZXJzLCB7InR5cGUiOiJ0dXJibyJ9LCBwcm94aWVzKQogICAgICAgICAgICAgIGlmIHN0YXR1c19jb2RlID09IDIwMToKICAgICAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9xJDDoyBrw61jaCBob+G6oXQgVHVyYm8iLCBlbmQ9IiAiKQogICAgICAgICAgICAgICAgdG90YWxTY29yZSA9IDAKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgIGVuZXJneSwgbmV3YmFsYW5jZSA9IFNVQk1JVF9UQVBTKGhlYWRlcnMsIGNvbnRlbnRfaWQsIHsidGFwcyI6NDk5LCJ0aW1lIjp0aW1lc3RhbXB9LCBwcm94aWVzKQogICAgICAgICAgICAgICAgICBzY29yZSA9IG5ld2JhbGFuY2UgLSBiYWxhbmNlCiAgICAgICAgICAgICAgICAgIHRvdGFsU2NvcmUgKz0gc2NvcmUKICAgICAgICAgICAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICAgICAgICAgICAgaWYgc2NvcmUgPCAxMDA6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHByaW50KGYie3bDoG5nfSt7dG90YWxTY29yZX0ge8SR4buPfcK7IHt2w6BuZ317bmV3YmFsYW5jZTosfSIpCiAgICAgICAgICAgICAgICAjYmFsYW5jZSwgVGFwQ29uZmlnLCBFbmVyZ3lDb25maWcsIFJlY292ZXJ5Q29uZmlnID0gVVBHUkFERShiYWxhbmNlLCBUYXBDb25maWcsIEVuZXJneUNvbmZpZywgUmVjb3ZlcnlDb25maWcpCiAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499xJDDoyBrw61jaCBob+G6oXQgVHVyYm8gVEjhuqRUIELhuqBJXG4iKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9SOG6vlQgTMav4buiVCBDTElDSywgSOG6vlQgQk9PU1RFUlMge8SR4buPfcK7IHt2w6BuZ33EkOG7lEkgVMOASSBLSE/huqJOIikKICAgICAgICAgIGJyZWFrClJVTl9UQVBTV0FQKCk="