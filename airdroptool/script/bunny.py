api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMCIKbmFtZV90b29sID0gImJ1bm55IgpCQU5ORVIobmFtZV90b29sLCB2ZXJzaW9uKQpwcmludChmIiIiCnvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7bGFtfUPDgUMgQ0jhu6hDIE7Egk5HIEPhu6ZBIFRPT0wKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gxJFp4buDbSBkYW5oIGjDoG5nIG5nw6B5CnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIGNsaWNrCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIHPhu60gZOG7pW5nIGJvb3N0ZXIKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbsOibmcgY+G6pXAgYm9vc3Rlcgp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBob8OgbiB0aMOgbmggY8OhYyBuaGnhu4dtIHbhu6UgKFNvb24pCiIiIikKZGVmIFBST0ZJTEUoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvLyIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgdXNlcm5hbWUgPSBnZXRkYXRhWyJ1c2VyIl1bIm5pY2tuYW1lIl0KICAgICAgYmFsYW5jZSA9IGdldGRhdGFbInVzZXIiXVsiY29pbnMiXQogICAgICBlbmVyZ3kgPSBnZXRkYXRhWyJlbmVyZ3kiXQogICAgICBjbGFuID0gZ2V0ZGF0YVsiY2xhbiJdCiAgICAgIGRhbWUgPSBnZXRkYXRhWyJ1c2VyIl1bInVwZ3JhZGVzIl1bIm11bHRpdGFwIl1bInZhbHVlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEJVTk5ZIikKICAgICAgUlVOX0JVTk5ZKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gdXNlcm5hbWUsIGJhbGFuY2UsIGVuZXJneSwgY2xhbiwgZGFtZQpkZWYgQ0xJQ0soaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL3RhcHMiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vdGFwcyIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICBiYWxhbmNlID0gZ2V0ZGF0YVsiY29pbnMiXQogICAgICBlbmVyZ3kgPSBnZXRkYXRhWyJlbmVyZ3kiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgQlVOTlkiKQogICAgICBSVU5fQlVOTlkoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBiYWxhbmNlLCBlbmVyZ3kKZGVmIEFDVElWRV9CT09TVChoZWFkZXJzLCB0eXBlX2Jvb3N0LCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL2Jvb3N0cy9hY3Rpb24ve3R5cGVfYm9vc3R9IiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vYm9vc3RzL2FjdGlvbi97dHlwZV9ib29zdH0iLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIHN0YXR1cyA9IGdldGRhdGFbInN0YXR1cyJdCiAgICAgIGVuZXJneSA9IGdldGRhdGFbImVuZXJneSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBCVU5OWSIpCiAgICAgIFJVTl9CVU5OWSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGVuZXJneSwgc3RhdHVzCmRlZiBCT09TVFMoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vYm9vc3RzIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL2Jvb3N0cyIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgdHlwZTAgPSBnZXRkYXRhWyJhY3Rpb25zIl1bMF1bInR5cGUiXQogICAgICB0eXBlMSA9IGdldGRhdGFbImFjdGlvbnMiXVsxXVsidHlwZSJdCiAgICAgIGlmIHR5cGUwID09ICJNRUdBX0JPT1NUIiBvciB0eXBlMSA9PSAiUkVTRVRfRU5FUkdZIjoKICAgICAgICBjb3VudFR1cmJvID0gZ2V0ZGF0YVsiYWN0aW9ucyJdWzBdWyJjb3VudCJdCiAgICAgICAgY291bnRGdWxsRW5lcmd5ID0gZ2V0ZGF0YVsiYWN0aW9ucyJdWzFdWyJjb3VudCJdCiAgICAgIGVsc2U6CiAgICAgICAgY291bnRUdXJibyA9IGdldGRhdGFbImFjdGlvbnMiXVsxXVsiY291bnQiXQogICAgICAgIGNvdW50RnVsbEVuZXJneSA9IGdldGRhdGFbImFjdGlvbnMiXVswXVsiY291bnQiXQogICAgICB0YXBDb25maWcgPSBnZXRkYXRhWyJ1cGdyYWRlcyJdWzBdCiAgICAgIGVuZXJneUNvbmZpZyA9IGdldGRhdGFbInVwZ3JhZGVzIl1bMV0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEJVTk5ZIikKICAgICAgUlVOX0JVTk5ZKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCB0YXBDb25maWcsIGVuZXJneUNvbmZpZwpkZWYgREFJTFkoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL2RhaWx5L2NsYWltIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5idW5ueWFwcC5pby9kYWlseS9jbGFpbSIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgc3RhdHVzID0gZ2V0ZGF0YVsic3RhdHVzIl0KICAgICAgaWYgc3RhdHVzID09ICJzdWNjZXNzIjoKICAgICAgICByZXdhcmRfYW1vdW50ID0gZ2V0ZGF0YVsicmV3YXJkX2Ftb3VudCJdCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9xJBp4buDbSBkYW5oIHRow6BuaCBjw7RuZyB7dsOgbmd9K3tyZXdhcmRfYW1vdW50fSIpCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBCVU5OWSIpCiAgICAgIFJVTl9CVU5OWSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHJld2FyZF9hbW91bnQsIHN0YXR1cwpkZWYgREFJTFlfTElTVChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5idW5ueWFwcC5pby9kYWlseS9saXN0IiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL2RhaWx5L2xpc3QiLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIHN0YXR1cyA9IGdldGRhdGFbInN0YXR1cyJdCiAgICAgIGlzX2NsYWltZWRfdG9kYXkgPSBGYWxzZQogICAgICBpZiBzdGF0dXMgPT0gInN1Y2Nlc3MiOgogICAgICAgIGlzX2NsYWltZWRfdG9kYXkgPSBnZXRkYXRhWyJpc19jbGFpbWVkX3RvZGF5Il0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEJVTk5ZIikKICAgICAgUlVOX0JVTk5ZKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gaXNfY2xhaW1lZF90b2RheQpkZWYgTUVHQV9DTElDSyhoZWFkZXJzLCBkYXRhLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vdGFwcy9tZWdhIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL3RhcHMvbWVnYSIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICBiYWxhbmNlID0gZ2V0ZGF0YVsiY29pbnMiXQogICAgICBlbmVyZ3kgPSBnZXRkYXRhWyJlbmVyZ3kiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgQlVOTlkiKQogICAgICBSVU5fQlVOTlkoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBiYWxhbmNlLCBlbmVyZ3kKZGVmIExFVkVMX1VQKGhlYWRlcnMsIHR5cGVVcGdyYWRlLCBrZXlfbGV2ZWwsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KGYiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vYm9vc3RzL3VwZ3JhZGUve3R5cGVVcGdyYWRlfS97a2V5X2xldmVsfSIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChmImh0dHBzOi8vYXBpLmJ1bm55YXBwLmlvL2Jvb3N0cy91cGdyYWRlL3t0eXBlVXBncmFkZX0ve2tleV9sZXZlbH0iLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJ1c2VyIl1bImNvaW5zIl0KICAgICAgZW5lcmd5ID0gZ2V0ZGF0YVsiZW5lcmd5Il0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEJVTk5ZIikKICAgICAgUlVOX0JVTk5ZKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gYmFsYW5jZSwgZW5lcmd5CmRlZiBMRVZFTF9VUChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGYiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vZHVuZ2VvbiIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KGYiaHR0cHM6Ly9hcGkuYnVubnlhcHAuaW8vZHVuZ2VvbiIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgYmFsYW5jZSA9IGdldGRhdGFbInVzZXIiXVsiY29pbnMiXQogICAgICBlbmVyZ3kgPSBnZXRkYXRhWyJlbmVyZ3kiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgQlVOTlkiKQogICAgICBSVU5fQlVOTlkoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBiYWxhbmNlLCBlbmVyZ3kKCmRlZiBSVU5fQlVOTlkoKToKICB3aXRoIG9wZW4oJ2NvbmZpZy9idW5ueS5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgY29uZmlnX2RhdGEgPSBqc29uLmxvYWRzKHJlbW92ZV9jb21tZW50cyhmaWxlLnJlYWQoKSkpCiAgdXNlcnMgPSBjb25maWdfZGF0YQogIGlmIGxlbih1c2VycykgPiAxMDoKICAgIHByaW50KCJC4bqhbiBjaOG7iSDEkcaw4bujYyBwaMOpcCB0aMOqbSB04buRaSDEkWEgMTAgdMOgaSBraG/huqNuIMSR4buDIGNo4bqheSB0b29sIikKICAgIGV4aXQoKQogIGZvciB1c2VyIGluIHVzZXJzOgogICAgYWNjb3VudCA9IHVzZXJbIlNUVF9BQ0NPVU5UIl0KICAgIGNvb2tpZSA9IHVzZXJbIkNPT0tJRSJdCiAgICBpZiBjb29raWUgPT0gIiIgb3IgY29va2llID09ICJ0aGF5X3Ro4bq/X2LhurFuZ19jb29raWUiOgogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499VMOgaSBraG/huqNuIHt2w6BuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfSB7xJHhu499REFUQSDEkWFuZyBi4buLIHRy4buRbmciKQogICAgICBjb250aW51ZQogICAgd2l0aCBvcGVuKCdjb25maWcvc2V0dGluZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgICBjb25maWdfYWNjID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKVthY2NvdW50XQogICAgcHJveHlfbGlzdCA9IGNvbmZpZ19hY2NbInByb3h5Il0KICAgIHR5cGVfcHJveHkgPSBjb25maWdfYWNjWyJ0eXBlX3Byb3h5Il0KICAgIHVzZXJfYWdlbnQgPSBjb25maWdfYWNjWyJ1c2VyLWFnZW50Il0KICAgIGlmIHByb3h5X2xpc3QgIT0gIiI6CiAgICAgIHByb3h5X2xpc3QgPSBwcm94eV9saXN0LnNwbGl0KCI6IikKICAgICAgcHJveHkgPSBmInt0eXBlX3Byb3h5fTovL3twcm94eV9saXN0WzJdfTp7cHJveHlfbGlzdFszXX1Ae3Byb3h5X2xpc3RbMF19Ontwcm94eV9saXN0WzFdfSIKICAgICAgcHJveGllcyA9IHsKICAgICAgJ2h0dHAnOiBwcm94eSwKICAgICAgJ2h0dHBzJzogcHJveHksfQogICAgZWxzZToKICAgICAgaWYgYWNjb3VudC5zcGxpdCgnXycpWzFdICE9ICIxIjoKICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31DaHV54buDbiB0w6BpIGtob+G6o24gZG8ga2jDtG5nIGPDsyBwcm94eSIpCiAgICAgICAgY29udGludWUKICAgICAgcHJveGllcyA9ICIiCgogICAgaXAsIGZha2VpcCA9IGdldElQKHByb3hpZXMpCiAgICBpZiBpcCA9PSBmYWtlaXAgPT0gTm9uZToKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499XG7EkOG7lEkgVMOASSBLSE/huqJOIERPIEtIw5RORyBM4bqkWSDEkMav4buiQyBJUCwgSMODWSBLSeG7gk0gVFJBIEzhuqBJIFBST1hZXG4iKQogICAgICBjb250aW51ZQogICAgaGVhZGVycyA9IHsKICAgICAgIkhvc3QiOiAiYXBpLmJ1bm55YXBwLmlvIiwKICAgICAgInNlYy1jaC11YSI6ICciQW5kcm9pZCBXZWJWaWV3Ijt2PSIxMjUiLCAiQ2hyb21pdW0iO3Y9IjEyNSIsICJOb3QuQS9CcmFuZCI7dj0iMjQiJywKICAgICAgImFjY2VwdC1sYW5ndWFnZSI6ICJlbiIsCiAgICAgICJzZWMtY2gtdWEtbW9iaWxlIjogIj8xIiwKICAgICAgInVzZXItYWdlbnQiOiB1c2VyX2FnZW50LAogICAgICAic2VjLWNoLXVhLXBsYXRmb3JtIjogJyJBbmRyb2lkIicsCiAgICAgICJhY2NlcHQiOiAiKi8qIiwKICAgICAgIm9yaWdpbiI6ICJodHRwczovL2J1bm55YXBwLmlvIiwKICAgICAgIngtcmVxdWVzdGVkLXdpdGgiOiAibWFyay52aWEuZ3giLAogICAgICAic2VjLWZldGNoLXNpdGUiOiAic2FtZS1zaXRlIiwKICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLAogICAgICAic2VjLWZldGNoLWRlc3QiOiAiZW1wdHkiLAogICAgICAicmVmZXJlciI6ICJodHRwczovL2J1bm55YXBwLmlvLyIsCiAgICAgICJhY2NlcHQtZW5jb2RpbmciOiAiZ3ppcCwgZGVmbGF0ZSwgYnIsIHpzdGQiLAogICAgICAiY29va2llIjogY29va2llLAogICAgICAicHJpb3JpdHkiOiAidT0xLCBpIgogICAgfQogICAgCiAgICB1c2VybmFtZSwgYmFsYW5jZSwgZW5lcmd5LCBjbGFuLCBkYW1lPSBQUk9GSUxFKGhlYWRlcnMsIHByb3hpZXMpCiAgICBjb3VudFR1cmJvLCBjb3VudEZ1bGxFbmVyZ3ksIHRhcENvbmZpZywgZW5lcmd5Q29uZmlnID0gQk9PU1RTKGhlYWRlcnMsIHByb3hpZXMpCiAgICBwcmludChmIiIie8SR4bqtbX17xJFlbn08PDw8PDw8PDw8PDw8PDw8PDx7bGFtfVt7dsOgbmdCR317xJHhu499VEjDlE5HIFRJTiBUw4BJIEtIT+G6ok4gQlVOTll7xJFlbkJHfXtsYW19XXvEkWVufT4+Pj4+Pj4+Pj4+Pj4+Pj4+Plxue8SRZW5944CY8J+RpOOAmXt0cuG6r25nfVVzZXJOYW1lIHvEkeG7j306IHts4bulY317dXNlcm5hbWV9IHt0cuG6r25nfSh7aOG7k25nfXthY2NvdW50LnNwbGl0KCdfJylbMV19e3Ry4bqvbmd9KVxue8SRZW5944CY8J+qmeOAmXt0cuG6r25nfVPhu5EgRMawIHvEkeG7j306IHt2w6BuZ317YmFsYW5jZTosfVxue8SRZW5944CY8J+TiuOAmXt0cuG6r25nfVRow7RuZyBz4buRIEdhbWV7xJHhu499OiB7bOG7pWN9K3tkYW1lfXvEkWVufS97bOG7pWN9Y2xpY2sge3bDoG5nfXtlbmVyZ3l94pqhIHtsYW19e2NvdW50VHVyYm99IHtjb3VudEZ1bGxFbmVyZ3l9XG57xJFlbn3jgJjwn5On44CZe3Ry4bqvbmd9VGjDtG5nIHRpbiBDbGFue8SR4buPfToge3hhbmh9e2NsYW5bJ3RpdGxlJ119XG57xJFlbn3jgJjwn4yP44CZe3Ry4bqvbmd9SVAge8SR4buPfToge27DonV9e2lwfSB7bOG7pWN9wrvCu8K7IHt0cuG6r25nfUZha2UgSVAge8SR4buPfToge2xhbX17ZmFrZWlwfVxuIiIiKQogICAgc3RhcnRfdGltZSA9IGRhdGV0aW1lLm5vdygpCiAgICBwcmludChmInvEkeG7j31cMDMzWzE7MzM7NDBtQuG6rlQgxJDhuqZVIENI4bqgWSBUT09MIHt0aMaw4budbmd9e8SR4bqtbX17xJHhu499wrsge8SRZW59W3t2w6BuZ317c3RhcnRfdGltZS5zdHJmdGltZSgnJUg6JU06JVMnKX17xJFlbn1dXG4iKQogICAgaWYgREFJTFlfTElTVChoZWFkZXJzLCBwcm94aWVzKSA9PSBGYWxzZToKICAgICAgcmV3YXJkX2Ftb3VudCwgc3RhdHVzID0gREFJTFkoaGVhZGVycywgcHJveGllcykKICAgIGRlZiBVUEdSQURFKGJhbGFuY2UsIHRhcENvbmZpZywgZW5lcmd5Q29uZmlnKToKICAgICAgd2hpbGUgYmFsYW5jZSA+IHRhcENvbmZpZ1siY29zdCJdIG9yIGJhbGFuY2UgPiBlbmVyZ3lDb25maWdbImNvc3QiXToKICAgICAgICB0eXBlVXBncmFkZSA9IE5vbmUKICAgICAgICBpZiBiYWxhbmNlID4gdGFwQ29uZmlnWyJjb3N0Il0gYW5kIHR5cGVVcGdyYWRlID09IE5vbmUgYW5kIHRhcENvbmZpZ1sibGV2ZWwiXSA8IDEzOgogICAgICAgICAgdHlwZVVwZ3JhZGUgPSB0YXBDb25maWdbInR5cGUiXQogICAgICAgICAgbGV2ZWwgPSB0YXBDb25maWdbImxldmVsIl0KICAgICAgICAgIGtleV9sZXZlbCA9IGxldmVsKjIrMQogICAgICAgICAgcHJpY2UgPSB0YXBDb25maWdbImNvc3QiXQogICAgICAgIGlmIGJhbGFuY2UgPiBlbmVyZ3lDb25maWdbImNvc3QiXSBhbmQgdHlwZVVwZ3JhZGUgPT0gTm9uZSBhbmQgZW5lcmd5Q29uZmlnWyJsZXZlbCJdIDwgMTM6CiAgICAgICAgICB0eXBlVXBncmFkZSA9IGVuZXJneUNvbmZpZ1sidHlwZSJdCiAgICAgICAgICBsZXZlbCA9IGVuZXJneUNvbmZpZ1sibGV2ZWwiXQogICAgICAgICAga2V5X2xldmVsID0gbGV2ZWwqMisyCiAgICAgICAgICBwcmljZSA9IGVuZXJneUNvbmZpZ1siY29zdCJdCiAgICAgICAgaWYgdHlwZVVwZ3JhZGUgPT0gTm9uZToKICAgICAgICAgIGJyZWFrCiAgICAgICAgYmFsYW5jZSwgZW5lcmd5ID0gTEVWRUxfVVAoaGVhZGVycyx0eXBlVXBncmFkZSwga2V5X2xldmVsLCBwcm94aWVzKQogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAge2jhu5NuZ317dHlwZVVwZ3JhZGV9IHt0cuG6r25nfSh7bGFtfXtsZXZlbCsxfXt0cuG6r25nfSkge2zhu6VjfeKAoiB7xJHhu499LXtwcmljZTosfSB7xJFlbn3CuyB7dsOgbmd9e2JhbGFuY2U6LH1cbiIpCiAgICAgICAgY291bnRUdXJibywgY291bnRGdWxsRW5lcmd5LCB0YXBDb25maWcsIGVuZXJneUNvbmZpZyA9IEJPT1NUUyhoZWFkZXJzLCBwcm94aWVzKQogICAgICByZXR1cm4gYmFsYW5jZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcKICAgICNwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31Ow4JORyBD4bqkUCBCT09TVCIpCiAgICBiYWxhbmNlLCB0YXBDb25maWcsIGVuZXJneUNvbmZpZyA9IFVQR1JBREUoYmFsYW5jZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcpCiAgICAjcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfUjhur5UIFRJ4buATiBOw4JORyBD4bqkUCBCT09TVFxuIikKICAgIHVzZXJuYW1lLCBiYWxhbmNlLCBlbmVyZ3ksIGNsYW4sIGRhbWU9IFBST0ZJTEUoaGVhZGVycywgcHJveGllcykKICAgIHdoaWxlIFRydWU6CiAgICAgIGlmIGVuZXJneSA+IDA6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCxlbmVyZ3kpOgogICAgICAgICAgbmV3YmFsYW5jZSwgZW5lcmd5ID0gQ0xJQ0soaGVhZGVycywgeyJjb2lucyI6MTAwMCpkYW1lfSwgcHJveGllcykKICAgICAgICAgIGNvbGxlY3RBbW91bnQgPSBuZXdiYWxhbmNlIC0gYmFsYW5jZQogICAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgIHByaW50KGYie8SRZW594pWU4pWQe8SR4buPfVt7dsOgbmd9e25vd190aW1lfXvEkeG7j31dIHt0cuG6r25nfcSQw6MgQ0xJQ0sge3bDoG5nfSt7Y29sbGVjdEFtb3VudDosfSB7xJHhu4994oCiIHtsYW19e2VuZXJneX0gZW5lcmd5IHvEkeG7j33CuyIsIGVuZD0iICIpCiAgICAgICAgICBwcmludChmInt2w6BuZ317bmV3YmFsYW5jZTosfVxue8SRZW594pWa4qu4e2jhu5NuZ31MaW5rIHRvb2wgJiBoxrDhu5tuZyBk4bqrbiB04bqhaSBUZWxlZ3JhbXvEkeG7j317xJHhu499OiB7bOG7pWN9QEFpcmRyb3BUb29sQ2hhbm5lbFxuIikKICAgICAgICAgIGJhbGFuY2UsIHRhcENvbmZpZywgZW5lcmd5Q29uZmlnID0gVVBHUkFERShiYWxhbmNlLCB0YXBDb25maWcsIGVuZXJneUNvbmZpZykKICAgICAgICAgIHVzZXJuYW1lLCBiYWxhbmNlLCBlbmVyZ3ksIGNsYW4sIGRhbWU9IFBST0ZJTEUoaGVhZGVycywgcHJveGllcykKICAgICAgZWxzZToKICAgICAgICBjb3VudFR1cmJvLCBjb3VudEZ1bGxFbmVyZ3ksIHRhcENvbmZpZywgZW5lcmd5Q29uZmlnID0gQk9PU1RTKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgICAgaWYgY291bnRGdWxsRW5lcmd5ID4gMDoKICAgICAgICAgIGVuZXJneSwgc3RhdHVzID0gQUNUSVZFX0JPT1NUKGhlYWRlcnMsICJSRVNFVF9FTkVSR1kiLCBwcm94aWVzKQogICAgICAgICAgaWYgc3RhdHVzID09ICJzdWNjZXNzIjoKICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfcSQw6Mga8OtY2ggaG/huqF0IEZ1bGwgRW5lcmd5IHvEkeG7j33igKIge2xhbX17ZW5lcmd5fSBlbmVyZ3lcbiIpCiAgICAgICAgICBlbHNlOgogICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499xJDDoyBrw61jaCBob+G6oXQgRnVsbCBFbmVyZ3kgVEjhuqRUIELhuqBJIikKICAgICAgICBlbHNlOgogICAgICAgICAgaWYgY291bnRUdXJibyA+IDI6CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDIsY291bnRUdXJibyk6CiAgICAgICAgICAgICAgZW5lcmd5LCBzdGF0dXMgPSBBQ1RJVkVfQk9PU1QoaGVhZGVycywgIk1FR0FfQk9PU1QiLCBwcm94aWVzKQogICAgICAgICAgICAgIGlmIHN0YXR1cyA9PSAic3VjY2VzcyI6CiAgICAgICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfcSQw6Mga8OtY2ggaG/huqF0IFR1cmJvIiwgZW5kPSIgIikKICAgICAgICAgICAgICAgIG5ld2JhbGFuY2UsIGVuZXJneSA9IE1FR0FfQ0xJQ0soaGVhZGVycywgeyJjb2lucyI6MTAwMCpkYW1lKjEwfSxwcm94aWVzKQogICAgICAgICAgICAgICAgc2NvcmUgPSBuZXdiYWxhbmNlIC0gYmFsYW5jZQogICAgICAgICAgICAgICAgYmFsYW5jZSA9IG5ld2JhbGFuY2UKICAgICAgICAgICAgICAgIHByaW50KGYie3bDoG5nfSt7c2NvcmU6LH0ge8SR4buPfcK7IHt2w6BuZ317bmV3YmFsYW5jZTosfSIpCiAgICAgICAgICAgICAgICBiYWxhbmNlLCB0YXBDb25maWcsIGVuZXJneUNvbmZpZyA9IFVQR1JBREUoYmFsYW5jZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcpCiAgICAgICAgICAgICAgICB1c2VybmFtZSwgYmFsYW5jZSwgZW5lcmd5LCBjbGFuLCBkYW1lPSBQUk9GSUxFKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499xJDDoyBrw61jaCBob+G6oXQgVHVyYm8gVEjhuqRUIELhuqBJIikKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHt0cuG6r25nfUjhur5UIEzGr+G7olQgQ0xJQ0ssIEjhur5UIEJPT1NURVJTIHvEkeG7j33CuyB7dsOgbmd9xJDhu5RJIFTDgEkgS0hP4bqiTiIpCiAgICAgICAgICBicmVhawpSVU5fQlVOTlkoKQ=="