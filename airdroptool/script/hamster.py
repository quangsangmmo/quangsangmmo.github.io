api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI4LjAuMCIKbmFtZV90b29sID0gImhhbXN0ZXIiCkJBTk5FUihuYW1lX3Rvb2wsIHZlcnNpb24pCnByaW50KGYiIiIKe8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHtsYW19Q8OBQyBDSOG7qEMgTsSCTkcgQ+G7pkEgVE9PTAp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byDEkWnhu4NtIGRhbmggaMOgbmcgbmfDoHkKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbMOgbSBuaGnhu4dtIHbhu6UgbcOjIG1vcnNlICYgZGFpbHkgY29tYm8Ke8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gcmFuZG9tIGNsaWNrCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIHPhu60gZOG7pW5nIGJvb3N0ZXIKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbsOibmcgY+G6pXAgYm9vc3Rlcgp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBuw6JuZyBj4bqlcCB0aOG6uyAKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gaG/DoG4gdGjDoG5oIGPDoWMgbmhp4buHbSB24bulIChuZ2/DoGkgVGVsZWdyYW0pCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIGNsYWltIGzhu6NpIG5odeG6rW4KIiIiKQphbnN3ZXIgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vcXVhbmdzYW5nbW1vLmdpdGh1Yi5pby9haXJkcm9wdG9vbC9hbnN3ZXIuanNvbiIpLmpzb24oKQpkZWYgTUVfVEVMRUdSQU0oaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2F1dGgvbWUtdGVsZWdyYW0iLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2F1dGgvbWUtdGVsZWdyYW0iLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJ0ZWxlZ3JhbVVzZXIiXQogICAgICB0cnk6CiAgICAgICAgdXNlcm5hbWUgPSBnZXRkYXRhWyJ1c2VybmFtZSJdCiAgICAgIGV4Y2VwdDoKICAgICAgICB1c2VybmFtZSA9IGdldGRhdGFbImxhc3ROYW1lIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHVzZXJuYW1lCmRlZiBDT05GSUcoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvY29uZmlnIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NvbmZpZyIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGNvbmZpZyA9IHJlc3BvbnNlLmpzb24oKVsiY2xpY2tlckNvbmZpZyJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBIQU1TVEVSIikKICAgICAgUlVOX0hBTVNURVIoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBjb25maWcKZGVmIFNZTkMoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvc3luYyIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9zeW5jIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsiY2xpY2tlclVzZXIiXQogICAgICBpZF91c2VyID0gZ2V0ZGF0YVsiaWQiXQogICAgICBiYWxhbmNlID0gaW50KGdldGRhdGFbImJhbGFuY2VDb2lucyJdKQogICAgICBsZXZlbCA9IGdldGRhdGFbImxldmVsIl0KICAgICAgZW5lcmd5ID0gZ2V0ZGF0YVsiYXZhaWxhYmxlVGFwcyJdCiAgICAgIGVuZXJneU1heCA9IGdldGRhdGFbIm1heFRhcHMiXQogICAgICBkYW1lID0gZ2V0ZGF0YVsiZWFyblBlclRhcCJdCiAgICAgIHJlY292ZXJ5RW5lcmd5ID0gZ2V0ZGF0YVsidGFwc1JlY292ZXJQZXJTZWMiXQogICAgICBleGNoYW5nZUlkID0gZ2V0ZGF0YVsiZXhjaGFuZ2VJZCJdCiAgICAgIGVhcm5QZXJIb3VyID0gZ2V0ZGF0YVsiZWFyblBhc3NpdmVQZXJIb3VyIl0KICAgICAgCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBIQU1TVEVSIikKICAgICAgUlVOX0hBTVNURVIoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBpZF91c2VyLCBiYWxhbmNlLCBsZXZlbCwgZW5lcmd5LCBlbmVyZ3lNYXgsIGRhbWUsIHJlY292ZXJ5RW5lcmd5LCBleGNoYW5nZUlkLCBlYXJuUGVySG91cgpkZWYgTElTVF9UQVNLUyhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9saXN0LXRhc2tzIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2xpc3QtdGFza3MiLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBsaXN0X3Rhc2tzID0gcmVzcG9uc2UuanNvbigpWyJ0YXNrcyJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBIQU1TVEVSIikKICAgICAgUlVOX0hBTVNURVIoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBsaXN0X3Rhc2tzCmRlZiBDSEVDS19UQVNLKGhlYWRlcnMsIGRhdGEsIGJhbGFuY2UsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NoZWNrLXRhc2siLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9jaGVjay10YXNrIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJ0YXNrIl0KICAgICAgc3RhdHVzID0gZ2V0ZGF0YVsiaXNDb21wbGV0ZWQiXQogICAgICByZXdhcmRUYXNrID0gZ2V0ZGF0YVsicmV3YXJkQ29pbnMiXQogICAgICBuYW1lVGFzayA9IGRhdGFbInRhc2tJZCJdLnJlcGxhY2UoIl8iLCIgIikKICAgICAgaWYgc3RhdHVzID09IFRydWU6CiAgICAgICAgYmFsYW5jZSA9IHJlc3BvbnNlLmpzb24oKVsiY2xpY2tlclVzZXIiXVsiYmFsYW5jZUNvaW5zIl0KICAgICAgICBpZiBkYXRhWyJ0YXNrSWQiXSA9PSAic3RyZWFrX2RheXMiOgogICAgICAgICAgZGF5cyA9IGdldGRhdGFbImRheXMiXQogICAgICAgICAgcmV3YXJkVGFzayA9IGdldGRhdGFbInJld2FyZHNCeURheXMiXVtkYXlzLTFdWyJyZXdhcmRDb2lucyJdCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqXt0cuG6r25nfSBIT8OATiBUSMOATkgge2xhbX17bmFtZVRhc2sudXBwZXIoKX0ge3bDoG5nfSt7cmV3YXJkVGFza30ge8SRZW59wrsge3bDoG5nfXtpbnQoYmFsYW5jZSk6LH0iKQogICAgICBlbHNlOgogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6l7xJHhu499IEzDgE0gTkhJ4buGTSBW4bukIHtsYW19e25hbWVUYXNrLnVwcGVyKCl9IHvEkeG7j31USOG6pFQgQuG6oEkge8SRZW59wrsge3bDoG5nfXtiYWxhbmNlOix9IikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIG5hbWVUYXNrLCByZXdhcmRUYXNrCmRlZiBTRUxFQ1RfRVhDSEFOR0UoaGVhZGVycywgYmFsYW5jZSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvc2VsZWN0LWV4Y2hhbmdlIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXsiZXhjaGFuZ2VJZCI6Im9reCJ9LCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3NlbGVjdC1leGNoYW5nZSIsIGhlYWRlcnM9aGVhZGVycywganNvbj17ImV4Y2hhbmdlSWQiOiJva3gifSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbImNsaWNrZXJVc2VyIl0KICAgICAgZXhjaGFuZ2VJZCA9IGdldGRhdGFbImV4Y2hhbmdlSWQiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgSEFNU1RFUiIpCiAgICAgIFJVTl9IQU1TVEVSKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gZXhjaGFuZ2VJZApkZWYgVVBHUkFERV9JTkZPKGhlYWRlcnMsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3VwZ3JhZGVzLWZvci1idXkiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvdXBncmFkZXMtZm9yLWJ1eSIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIHVwZ3JhZGVzSW5mbyA9IHJlc3BvbnNlLmpzb24oKVsidXBncmFkZXNGb3JCdXkiXQogICAgICBkYWlseUNvbWJvID0gcmVzcG9uc2UuanNvbigpWyJkYWlseUNvbWJvIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHVwZ3JhZGVzSW5mbywgZGFpbHlDb21ibwpkZWYgQlVZX1VQR1JBREUoaGVhZGVycywgZGF0YSwgYmFsYW5jZSwgdXBncmFkZXNJbmZvLCBkYWlseUNvbWJvLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9idXktdXBncmFkZSIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCAgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9idXktdXBncmFkZSIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICAKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGJhbGFuY2UgPSByZXNwb25zZS5qc29uKClbImNsaWNrZXJVc2VyIl1bImJhbGFuY2VDb2lucyJdCiAgICAgIHVwZ3JhZGVzSW5mbyA9IHJlc3BvbnNlLmpzb24oKVsidXBncmFkZXNGb3JCdXkiXQogICAgICBkYWlseUNvbWJvID0gcmVzcG9uc2UuanNvbigpWyJkYWlseUNvbWJvIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UsIHVwZ3JhZGVzSW5mbywgZGFpbHlDb21ibwpkZWYgQ0xBSU1fMU0oaGVhZGVycywgZGF0YSwgYmFsYW5jZSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvY2xhaW0tZGFpbHktY2lwaGVyIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLmhhbXN0ZXJrb21iYXRnYW1lLmlvL2NsaWNrZXIvY2xhaW0tZGFpbHktY2lwaGVyIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgICNyZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhaWx5Q2lwaGVyIl0KICAgICAgICBzdGF0dXMgPSBnZXRkYXRhWyJpc0NsYWltZWQiXQogICAgICAgIGlmIHN0YXR1cyA9PSBUcnVlOgogICAgICAgICAgYmFsYW5jZSA9IHJlc3BvbnNlLmpzb24oKVsiY2xpY2tlclVzZXIiXVsiYmFsYW5jZUNvaW5zIl0KICAgICAgICAgIHJld2FyZENpcGhlciA9IGdldGRhdGFbImJvbnVzQ29pbnMiXQogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IEhPw4BOIFRIw4BOSCB7bGFtfU3DgyBNT1JTRSB7dsOgbmd9K3tyZXdhcmRDaXBoZXJ9IHvEkWVufcK7IHt2w6BuZ317aW50KGJhbGFuY2UpOix9IikKICAgICAgZWxzZToKICAgICAgICBpZiByZXNwb25zZS5qc29uKClbImVycm9yX2NvZGUiXSA9PSAiREFJTFlfQ0lQSEVSX0RPVUJMRV9DTEFJTUVEIjoKICAgICAgICAgIHBhc3MKICAgICAgICAgICNub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAjcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IE5ISeG7hk0gVuG7pCB7bGFtfU3DgyBNT1JTRSB7dHLhuq9uZ33EkMODIEhPw4BOIFRIw4BOSCBUUsav4buaQyDEkMOTIHvEkWVufcK7IHt2w6BuZ317aW50KGJhbGFuY2UpOix9IikKICAgICAgICBlbHNlOgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe8SR4buPfSBMw4BNIE5ISeG7hk0gVuG7pCB7bGFtfU3DgyBNT1JTRSB7xJHhu499VEjhuqRUIELhuqBJIHvEkWVufcK7IHt2w6BuZ317aW50KGJhbGFuY2UpOix9IikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UKZGVmIENMQUlNXzVNKGhlYWRlcnMsIGJhbGFuY2UsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NsYWltLWRhaWx5LWNvbWJvIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2NsYWltLWRhaWx5LWNvbWJvIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICAjcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYWlseUNvbWJvIl0KICAgICAgICBzdGF0dXMgPSBnZXRkYXRhWyJpc0NsYWltZWQiXQogICAgICAgIGlmIHN0YXR1cyA9PSBUcnVlOgogICAgICAgICAgYmFsYW5jZSA9IHJlc3BvbnNlLmpzb24oKVsiY2xpY2tlclVzZXIiXVsiYmFsYW5jZUNvaW5zIl0KICAgICAgICAgIHJld2FyZENpcGhlciA9IGdldGRhdGFbImJvbnVzQ29pbnMiXQogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pe3Ry4bqvbmd9IEhPw4BOIFRIw4BOSCB7bGFtfURBSUxZIENPTUJPIHt2w6BuZ30re3Jld2FyZENpcGhlcn0ge8SRZW59wrsge3bDoG5nfXtpbnQoYmFsYW5jZSk6LH1cbiIpCiAgICAgIGVsc2U6CiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqXvEkeG7j30gTMOATSBOSEnhu4ZNIFbhu6Qge2xhbX1EQUlMWSBDT01CTyB7xJHhu499VEjhuqRUIELhuqBJIHvEkWVufcK7IHt2w6BuZ317YmFsYW5jZTosfVxuIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UKZGVmIEJPT1NUUyhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9ib29zdHMtZm9yLWJ1eSIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9ib29zdHMtZm9yLWJ1eSIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbImJvb3N0c0ZvckJ1eSJdCiAgICAgIHRhcENvbmZpZyA9IGdldGRhdGFbMF0KICAgICAgZW5lcmd5Q29uZmlnID0gZ2V0ZGF0YVsxXQogICAgICBmdWxsZW5lcmd5Q29uZmlnID0gZ2V0ZGF0YVsyXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgSEFNU1RFUiIpCiAgICAgIFJVTl9IQU1TVEVSKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcsIGZ1bGxlbmVyZ3lDb25maWcKZGVmIExFVkVMX1VQKGhlYWRlcnMsIHR5cGVVcGdyYWRlLCBiYWxhbmNlLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkgKiAxMDAwKQogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuaGFtc3RlcmtvbWJhdGdhbWUuaW8vY2xpY2tlci9idXktYm9vc3QiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249eyJib29zdElkIjp0eXBlVXBncmFkZSwidGltZXN0YW1wIjp0aW1lc3RhbXB9LCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL2J1eS1ib29zdCIsIGhlYWRlcnM9aGVhZGVycywganNvbj17ImJvb3N0SWQiOnR5cGVVcGdyYWRlLCJ0aW1lc3RhbXAiOnRpbWVzdGFtcH0pCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJjbGlja2VyVXNlciJdCiAgICAgIGJhbGFuY2UgPSBpbnQoZ2V0ZGF0YVsiYmFsYW5jZUNvaW5zIl0pCiAgICAgIGVuZXJneSA9IGdldGRhdGFbImF2YWlsYWJsZVRhcHMiXQogICAgICBkYW1lID0gZ2V0ZGF0YVsiZWFyblBlclRhcCJdCiAgICAgIGVuZXJneU1heCA9IGdldGRhdGFbIm1heFRhcHMiXQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJib29zdHNGb3JCdXkiXQogICAgICB0YXBDb25maWcgPSBnZXRkYXRhWzBdCiAgICAgIGVuZXJneUNvbmZpZyA9IGdldGRhdGFbMV0KICAgICAgZnVsbGVuZXJneUNvbmZpZyA9IGdldGRhdGFbMl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UsIGVuZXJneSwgZGFtZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcsIGZ1bGxlbmVyZ3lDb25maWcsIGVuZXJneU1heApkZWYgVEFQKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3RhcCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5oYW1zdGVya29tYmF0Z2FtZS5pby9jbGlja2VyL3RhcCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsiY2xpY2tlclVzZXIiXQogICAgICBiYWxhbmNlID0gaW50KGdldGRhdGFbImJhbGFuY2VDb2lucyJdKQogICAgICBlbmVyZ3kgPSBnZXRkYXRhWyJhdmFpbGFibGVUYXBzIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIEhBTVNURVIiKQogICAgICBSVU5fSEFNU1RFUigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGJhbGFuY2UsIGVuZXJneQoKZGVmIFVQR1JBREUoYmFsYW5jZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcsIGZ1bGxlbmVyZ3lDb25maWcsIGVuZXJneSwgZGFtZSk6CiAgd2hpbGUgYmFsYW5jZSA+IGVuZXJneUNvbmZpZ1sicHJpY2UiXToKICAgIHR5cGVVcGdyYWRlID0gZW5lcmd5Q29uZmlnWyJpZCJdCiAgICBsZXZlbCA9IGVuZXJneUNvbmZpZ1sibGV2ZWwiXQogICAgcHJpY2UgPSBlbmVyZ3lDb25maWdbInByaWNlIl0KICAgIGJhbGFuY2UsIGVuZXJneSwgZGFtZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcsIGZ1bGxlbmVyZ3lDb25maWcsIGVuZXJneU1heCA9IExFVkVMX1VQKGhlYWRlcnMsdHlwZVVwZ3JhZGUsIHByb3hpZXMpCiAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAge2jhu5NuZ317dHlwZVVwZ3JhZGV9IHt0cuG6r25nfSh7bGFtfXtsZXZlbCsxfXt0cuG6r25nfSkge2zhu6VjfeKAoiB7xJHhu499LXtwcmljZX0ge8SRZW59wrsge3bDoG5nfXtiYWxhbmNlOix9IikKICByZXR1cm4gYmFsYW5jZSwgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcsIGZ1bGxlbmVyZ3lDb25maWcsIGVuZXJneSwgZGFtZQoKZGVmIFJVTl9IQU1TVEVSKCk6CiAgd2l0aCBvcGVuKCdjb25maWcvaGFtc3Rlci5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgY29uZmlnX2RhdGEgPSBqc29uLmxvYWRzKHJlbW92ZV9jb21tZW50cyhmaWxlLnJlYWQoKSkpCiAgdXNlcnMgPSBjb25maWdfZGF0YQogIGlmIGxlbih1c2VycykgPiAxMDoKICAgIHByaW50KCJC4bqhbiBjaOG7iSDEkcaw4bujYyBwaMOpcCB0aMOqbSB04buRaSDEkWEgMTAgdMOgaSBraG/huqNuIMSR4buDIGNo4bqheSB0b29sIikKICAgIGV4aXQoKQogIGZvciB1c2VyIGluIHVzZXJzOgogICAgYWNjb3VudCA9IHVzZXJbIlNUVF9BQ0NPVU5UIl0KICAgIGF1dGhvcml6YXRpb24gPSB1c2VyWyJBVVRIT1JJWkFUSU9OIl0KICAgIGlmIGF1dGhvcml6YXRpb24gPT0gIiIgb3IgYXV0aG9yaXphdGlvbiA9PSAidGhheV90aOG6v19i4bqxbmdfYXV0aG9yaXphdGlvbiI6CiAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31Uw6BpIGtob+G6o24ge3bDoG5nfXthY2NvdW50LnNwbGl0KCdfJylbMV19IHvEkeG7j31EQVRBIMSRYW5nIGLhu4sgdHLhu5FuZyIpCiAgICAgIGNvbnRpbnVlCiAgICB3aXRoIG9wZW4oJ2NvbmZpZy9zZXR0aW5nLmpzb24nLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGU6CiAgICAgIGNvbmZpZ19hY2MgPSBqc29uLmxvYWRzKHJlbW92ZV9jb21tZW50cyhmaWxlLnJlYWQoKSkpW2FjY291bnRdCiAgICBwcm94eV9saXN0ID0gY29uZmlnX2FjY1sicHJveHkiXQogICAgdHlwZV9wcm94eSA9IGNvbmZpZ19hY2NbInR5cGVfcHJveHkiXQogICAgdXNlcl9hZ2VudCA9IGNvbmZpZ19hY2NbInVzZXItYWdlbnQiXQogICAgaWYgcHJveHlfbGlzdCAhPSAiIjoKICAgICAgcHJveHlfbGlzdCA9IHByb3h5X2xpc3Quc3BsaXQoIjoiKQogICAgICBwcm94eSA9IGYie3R5cGVfcHJveHl9Oi8ve3Byb3h5X2xpc3RbMl19Ontwcm94eV9saXN0WzNdfUB7cHJveHlfbGlzdFswXX06e3Byb3h5X2xpc3RbMV19IgogICAgICBwcm94aWVzID0gewogICAgICAnaHR0cCc6IHByb3h5LAogICAgICAnaHR0cHMnOiBwcm94eSx9CiAgICBlbHNlOgogICAgICBpZiBhY2NvdW50LnNwbGl0KCdfJylbMV0gIT0gIjEiOgogICAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHt0cuG6r25nfSBDaHV54buDbiB0w6BpIGtob+G6o24gZG8ga2jDtG5nIGPDsyBwcm94eSIpCiAgICAgICAgY29udGludWUKICAgICAgcHJveGllcyA9ICIiCiAgICBpcCwgZmFrZWlwID0gZ2V0SVAocHJveGllcykKICAgIGlmIGlwID09IGZha2VpcCA9PSBOb25lOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31cbsSQ4buUSSBUw4BJIEtIT+G6ok4gRE8gS0jDlE5HIEzhuqRZIMSQxq/hu6JDIElQLCBIw4NZIEtJ4buCTSBUUkEgTOG6oEkgUFJPWFlcbiIpCiAgICAgIGNvbnRpbnVlCiAgICBoZWFkZXJzID0gewogICAgICAiSG9zdCI6ImFwaS5oYW1zdGVya29tYmF0Z2FtZS5pbyIsCiAgICAgICJDb25uZWN0aW9uIjoia2VlcC1hbGl2ZSIsCiAgICAgICJzZWMtY2gtdWEiOiciQW5kcm9pZCBXZWJWaWV3Ijt2PSIxMjUiLCAiQ2hyb21pdW0iO3Y9IjEyNSIsICJOb3QuQS9CcmFuZCI7dj0iMjQiJywKICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiI/MSIsCiAgICAgICJBdXRob3JpemF0aW9uIjphdXRob3JpemF0aW9uLAogICAgICAiVXNlci1BZ2VudCI6dXNlcl9hZ2VudCwKICAgICAgInNlYy1jaC11YS1wbGF0Zm9ybSI6ICciQW5kcm9pZCInLAogICAgICAiYWNjZXB0IjogIiovKiIsCiAgICAgICJvcmlnaW4iOiAiaHR0cDovL2hhbXN0ZXJrb21iYXRnYW1lLmlvIiwKICAgICAgIngtcmVxdWVzdGVkLXdpdGgiOiAibWFyay52aWEuZ3giLAogICAgICAic2VjLWZldGNoLXNpdGUiOiAic2FtZS1zaXRlIiwKICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLAogICAgICAic2VjLWZldGNoLWRlc3QiOiAiZW1wdHkiLAogICAgICAicmVmZXJlciI6ICJodHRwOi8vaGFtc3RlcmtvbWJhdGdhbWUuaW8iLAogICAgICAiYWNjZXB0LWVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyLCB6c3RkIiwKICAgICAgInByaW9yaXR5IjogInU9MSwgaSIKICAgIH0KICAgIHVzZXJuYW1lID0gTUVfVEVMRUdSQU0oaGVhZGVycywgcHJveGllcykKICAgIGNvbmZpZyA9IENPTkZJRyhoZWFkZXJzLCBwcm94aWVzKQogICAgaWRfdXNlciwgYmFsYW5jZSwgbGV2ZWwsIGVuZXJneSwgZW5lcmd5TWF4LCBkYW1lLCByZWNvdmVyeUVuZXJneSwgZXhjaGFuZ2VJZCwgZWFyblBlckhvdXIgPSBTWU5DKGhlYWRlcnMsIHByb3hpZXMpCiAgICB1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8gPSBVUEdSQURFX0lORk8oaGVhZGVycywgcHJveGllcykKICAgIHByaW50KGYiIiJ7xJHhuq1tfXvEkWVufTw8PDw8PDw8PDw8PDw8PDw8e2xhbX1be3bDoG5nQkd9e8SR4buPfVRIw5RORyBUSU4gVMOASSBLSE/huqJOIEhBTVNURVJ7xJFlbkJHfXtsYW19XXvEkWVufT4+Pj4+Pj4+Pj4+Pj4+Pj4+XG57xJFlbn3jgJjwn5Gk44CZe3Ry4bqvbmd9VXNlck5hbWUge8SR4buPfToge2zhu6VjfXt1c2VybmFtZX0ge3Ry4bqvbmd9KHto4buTbmd9e2FjY291bnQuc3BsaXQoJ18nKVsxXX17dHLhuq9uZ30pXG57xJFlbn3jgJjwn6qZ44CZe3Ry4bqvbmd9U+G7kSBExrAge8SR4buPfToge3bDoG5nfXtiYWxhbmNlOix9IHvEkWVufXwge3bDoG5nfSt7ZWFyblBlckhvdXI6LH17xJHhu499L3t2w6BuZ31oXG57xJFlbn3jgJjwn5OK44CZe3Ry4bqvbmd9VGjDtG5nIHPhu5EgR2FtZXvEkeG7j306IHts4bulY30re2RhbWV9e8SRZW59L3ts4bulY31jbGljayB7xJHhu499W3tsYW19e2VuZXJneX17xJFlbn0ve2xhbX17ZW5lcmd5TWF4fXvEkeG7j31dXG57xJFlbn3jgJjwn4yP44CZe3Ry4bqvbmd9SVAge8SR4buPfToge27DonV9e2lwfSB7bOG7pWN9wrvCu8K7IHt0cuG6r25nfUZha2UgSVAge8SR4buPfToge2xhbX17ZmFrZWlwfVxuIiIiKQogICAgc3RhcnRfdGltZSA9IGRhdGV0aW1lLm5vdygpCiAgICBwcmludChmInvEkeG7j31cMDMzWzE7MzM7NDBtQuG6rlQgxJDhuqZVIENI4bqgWSBUT09MIHt0aMaw4budbmd9e8SR4bqtbX17xJHhu499wrsge8SRZW59W3t2w6BuZ317c3RhcnRfdGltZS5zdHJmdGltZSgnJUg6JU06JVMnKX17xJFlbn1dXG4iKQogICAgaWYgZGFpbHlDb21ib1siaXNDbGFpbWVkIl0gPT0gRmFsc2U6CiAgICAgIHByaW50KGYie3Ry4bqvbmd9VGjhursgxJHDoyB0aHUgdGjhuq1wIHt2w6BuZ317ZGFpbHlDb21ib1sndXBncmFkZUlkcyddfVxuIikKICAgIGlmIGV4Y2hhbmdlSWQgPT0gTm9uZSBvciBleGNoYW5nZUlkID09ICJoYW1zdGVyIjoKICAgICAgZXhjaGFuZ2VJZCA9IFNFTEVDVF9FWENIQU5HRShoZWFkZXJzLCBwcm94aWVzKQogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMODIENI4buMTiBTw4BOIHtsYW19e2V4Y2hhbmdlSWQudXBwZXIoKX0iKQogICAgbGlzdF90YXNrcyA9IExJU1RfVEFTS1MoaGVhZGVycywgcHJveGllcykKICAgIGZvciB0YXNrIGluIGxpc3RfdGFza3M6CiAgICAgIGlmIHRhc2tbImlzQ29tcGxldGVkIl0gPT0gRmFsc2UgYW5kIHRhc2tbImlkIl0gIT0gImludml0ZV9mcmllbmRzIjoKICAgICAgICBuYW1lVGFzaywgcmV3YXJkVGFzayA9IENIRUNLX1RBU0soaGVhZGVycywgeyJ0YXNrSWQiOnRhc2tbImlkIl19LCBiYWxhbmNlLCBwcm94aWVzKQogICAgI03huq10IG3DowogICAgYmFsYW5jZSA9IENMQUlNXzFNKGhlYWRlcnMsIHsiY2lwaGVyIjphbnN3ZXJbIm1vcnNlX2hhbXN0ZXIiXX0sIGJhbGFuY2UsIHByb3hpZXMpCiAgICB0b3RhbE5vQXZhaWxhYmxlID0gMAogICAgdG90YWxJc0F2YWlsYWJsZSA9IDAKICAgIHRhcENvbmZpZywgZW5lcmd5Q29uZmlnLCBmdWxsZW5lcmd5Q29uZmlnID0gQk9PU1RTKGhlYWRlcnMsIHByb3hpZXMpCiAgICAjQ29tYm8KICAgIGlmIHN0cihkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJWQvJW0vJVkvJUgvJU0vJVMiKSkgPCBhbnN3ZXJbImRhdGVfZXhwaXJlZCJdOgogICAgICBsaXN0MSA9IGFuc3dlclsibGlzdF9jb21ibyJdCiAgICBlbHNlOgogICAgICBsaXN0MSA9IFtdCiAgICBsaXN0MiA9IGRhaWx5Q29tYm9bInVwZ3JhZGVJZHMiXQogICAgZGF0YV81TSA9IGxpc3QxLmNvcHkoKQogICAgZm9yIGl0ZW0gaW4gbGlzdDI6CiAgICAgICAgaWYgaXRlbSBpbiBkYXRhXzVNOgogICAgICAgICAgICBkYXRhXzVNLnJlbW92ZShpdGVtKQogICAgZGVmIFVQREFURV9DT01CTyhpZF81TSx1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCB0YXJnZXRMVl81TSwgcHJveGllcyk6CiAgICAgIGZvciB1IGluIHVwZ3JhZGVzSW5mbzoKICAgICAgICBpZiBpZF81TSA9PSB1WyJpZCJdOgogICAgICAgICAgaWRfNU0gPSB1WyJpZCJdCiAgICAgICAgICBuYW1lXzVNID0gdVsibmFtZSJdCiAgICAgICAgICBwcm9maXRfNU0gPSB1WyJwcm9maXRQZXJIb3VyRGVsdGEiXQogICAgICAgICAgcHJpY2VfNU0gPSB1WyJwcmljZSJdCiAgICAgICAgICBES181TSA9IHVbImNvbmRpdGlvbiJdCiAgICAgICAgICBsZXZlbF81TSA9IHVbImxldmVsIl0KICAgICAgICAgIGlzQXZhaWxhYmxlXzVNID0gdVsiaXNBdmFpbGFibGUiXQogICAgICAgICAgZGVsYXkgPSAwCiAgICAgICAgICB0cnk6CiAgICAgICAgICAgIGRlbGF5ID0gdVsiY29vbGRvd25TZWNvbmRzIl0KICAgICAgICAgIGV4Y2VwdDogCiAgICAgICAgICAgIGRlbGF5ID0gMAogICAgICAgICAgaWYgZGVsYXkgIT0gMDoKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q+G6p24gcGjhuqNpIGNo4budIHt2w6BuZ317ZGVsYXl9IHt0cuG6r25nfWdpw6J5IMSR4buDIG7Dom5nIGPhuqVwIHts4bulY317bmFtZV81TX1cbiIpCiAgICAgICAgICAgIHJldHVybiB1cGdyYWRlc0luZm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCBsZXZlbF81TQogICAgICAgICAgICBicmVhawogICAgICAgICAgaWYgREtfNU0gIT0gTm9uZToKICAgICAgICAgICAgaWYgaXNBdmFpbGFibGVfNU0gPT0gRmFsc2UgYW5kIERLXzVNWyJfdHlwZSJdID09ICJCeVVwZ3JhZGUiOgogICAgICAgICAgICAgIGlkX0NPTiA9IERLXzVNWyJ1cGdyYWRlSWQiXQogICAgICAgICAgICAgIHRhcmdldExWX0NPTiA9IERLXzVNWyJsZXZlbCJdKzEKICAgICAgICAgICAgICBuYW1lX0NPTiA9ICIiCiAgICAgICAgICAgICAgZm9yIGNvbiBpbiB1cGdyYWRlc0luZm86CiAgICAgICAgICAgICAgICBpZiBpZF9DT04gPT0gY29uWyJpZCJdOgogICAgICAgICAgICAgICAgICBuYW1lX0NPTiA9IGNvblsibmFtZSJdCiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9Q+G6p24gbsOibmcge2zhu6VjfXtuYW1lX0NPTn0ge3Ry4bqvbmd9bMOqbiBsZXZlbCB7bGFtfXt0YXJnZXRMVl9DT059IHt0cuG6r25nfcSR4buDIG7Dom5nIHts4bulY317bmFtZV81TX0ge3Ry4bqvbmd9bMOqbiBsZXZlbCB7bGFtfXt0YXJnZXRMVl81TX1cbiIpCiAgICAgICAgICAgICAgdXBncmFkZXNJbmZvLCBiYWxhbmNlLCBlYXJuUGVySG91ciwgbGV2ZWxfQ09OID0gVVBEQVRFX0NPTUJPKGlkX0NPTix1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCB0YXJnZXRMVl9DT04sIHByb3hpZXMpCiAgICAgICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgICAgIGlmIGxldmVsX0NPTiA+PSB0YXJnZXRMVl9DT046CiAgICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBuw6JuZyBj4bqlcCB7bOG7pWN9e25hbWVfQ09OfSB7dHLhuq9uZ30oe2xhbX17dGFyZ2V0TFZfQ09OfXt0cuG6r25nfSlcbiIpCiAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ31DaMawYSBuw6JuZyBj4bqlcCB7bOG7pWN9e25hbWVfQ09OfSB7dHLhuq9uZ31sw6puIGxldmVsIHtsYW19e3RhcmdldExWX0NPTn0ge3Ry4bqvbmd9KHtsYW19e2xldmVsX0NPTn17dHLhuq9uZ30pXG4iKQogICAgICAgICAgICAgICAgcmV0dXJuIHVwZ3JhZGVzSW5mbywgYmFsYW5jZSwgZWFyblBlckhvdXIsIGxldmVsXzVNCiAgICAgICAgICAgIGVsaWYgdVsiY29uZGl0aW9uIl1bIl90eXBlIl0gPT0gIk1vcmVSZWZlcnJhbHNDb3VudCIgYW5kIERLXzVNID09IEZhbHNlOgogICAgICAgICAgICAgIG1vcmVSZWYgPSB1WyJjb25kaXRpb24iXVsibW9yZVJlZmVycmFsc0NvdW50Il0KICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499Q+G6p24gY8OzIHRow6ptIHt2w6BuZ317bW9yZVJlZn0gUmVmZXJyYWwge8SR4buPfcSR4buDIG7Dom5nIGPhuqVwIHRo4bq7IHto4buTbmd9e3VbJ25hbWUnXX0iKQogICAgICAgICAgICAgIHJldHVybiB1cGdyYWRlc0luZm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCBsZXZlbF81TQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB3aGlsZSBpc0F2YWlsYWJsZV81TSA9PSBUcnVlIGFuZCBsZXZlbF81TSA8IHRhcmdldExWXzVNIGFuZCBiYWxhbmNlID4gcHJpY2VfNU06CiAgICAgICAgICAgIGlmIHByaWNlXzVNID4gNTAwMDAwMDoKICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31C4buOIFFVQSBOw4JORyBD4bqkUCB7bOG7pWN9e25hbWVfNU19IHt0cuG6r25nfURPIEdJw4EgUVXDgSBDQU8ge2zhu6VjfSh7dsOgbmd9e3ByaWNlXzVNOix9e2zhu6VjfSkiKQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHRpbWVzdGFtcCA9IGludCh0aW1lLnRpbWUoKSAqIDEwMDApCiAgICAgICAgICAgIG5ld2JhbGFuY2UsIHVwZ3JhZGVzSW5mbywgZGFpbHlDb21ibyA9IEJVWV9VUEdSQURFKGhlYWRlcnMsIHsidXBncmFkZUlkIjppZF81TSwidGltZXN0YW1wIjp0aW1lc3RhbXB9LCBiYWxhbmNlLCB1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8sIHByb3hpZXMpCiAgICAgICAgICAgIGVhcm5QZXJIb3VyICs9IHByb2ZpdF81TQogICAgICAgICAgICBpZiBiYWxhbmNlID4gbmV3YmFsYW5jZToKICAgICAgICAgICAgICBiYWxhbmNlID0gbmV3YmFsYW5jZQogICAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgICBwcmludChmInvEkWVufeKVlOKVkOKVkHvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAge2xhbX1DT01CTyB7bOG7pWN9e25hbWVfNU19IHt0cuG6r25nfSh7bGFtfXtsZXZlbF81TX17dHLhuq9uZ30pIikKICAgICAgICAgICAgICBwcmludChmInvEkWVufeKVmuKVkOKVkOKruCB7xJHhu499LXtwcmljZV81TTosfSB7bOG7pWN94oCiIHt2w6BuZ30re3Byb2ZpdF81TTosfXvEkeG7j30ve3bDoG5nfWgge2zhu6VjfcK7wrsge3bDoG5nfXtlYXJuUGVySG91cjosfXvEkeG7j30ve3bDoG5nfWgge8SRZW59wrvCu8K7IHt2w6BuZ317aW50KGJhbGFuY2UpOix9XG4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfU7Dom5nIGPhuqVwIHtsYW19Q09NQk8ge2zhu6VjfXtuYW1lXzVNfSB7xJHhu499VEjhuqRUIELhuqBJXG4iKQogICAgICAgICAgICAgIHJldHVybiB1cGdyYWRlc0luZm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCBsZXZlbF81TQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGZvciBpIGluIHVwZ3JhZGVzSW5mbzoKICAgICAgICAgICAgICBpZiBzdHIoaVsiaWQiXSkgPT0gaWRfNU06CiAgICAgICAgICAgICAgICBkZWxheSA9IDAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgZGVsYXkgPSBpWyJjb29sZG93blNlY29uZHMiXQogICAgICAgICAgICAgICAgZXhjZXB0OiAKICAgICAgICAgICAgICAgICAgZGVsYXkgPSAwCiAgICAgICAgICAgICAgICBpZiBkZWxheSAhPSAwOgogICAgICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31D4bqnbiBwaOG6o2kgY2jhu50ge3bDoG5nfXtkZWxheX0ge3Ry4bqvbmd9Z2nDonkgxJHhu4MgbsOibmcgY+G6pXAge2zhu6VjfXtuYW1lXzVNfVxuIikKICAgICAgICAgICAgICAgICAgcmV0dXJuIHVwZ3JhZGVzSW5mbywgYmFsYW5jZSwgZWFyblBlckhvdXIsIGxldmVsXzVNCiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBwcm9maXRfNU0gPSBpWyJwcm9maXRQZXJIb3VyRGVsdGEiXQogICAgICAgICAgICAgICAgcHJpY2VfNU0gPSBpWyJwcmljZSJdCiAgICAgICAgICAgICAgICBES181TSA9IGlbImlzQXZhaWxhYmxlIl0KICAgICAgICAgICAgICAgIGxldmVsXzVNID0gaVsibGV2ZWwiXQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGlmIGJhbGFuY2UgPCBwcmljZV81TToKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfVRoaeG6v3UgdGnhu4FuIG7Dom5nIGPhuqVwIHts4bulY317bmFtZV81TX0ge3bDoG5nfVByaWNlIHtwcmljZV81TTosfSB7xJFlbn3CuyB7dsOgbmd9e2JhbGFuY2U6LH0iKQogICAgICAgICAgICByZXR1cm4gdXBncmFkZXNJbmZvLCBiYWxhbmNlLCBlYXJuUGVySG91ciwgbGV2ZWxfNU0KICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGJyZWFrCiAgICAgIHJldHVybiB1cGdyYWRlc0luZm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCBsZXZlbF81TQogICAgZm9yIGkgaW4gZGF0YV81TToKICAgICAgZm9yIHUgaW4gdXBncmFkZXNJbmZvOgogICAgICAgIGlmIHVbImlkIl0gPT0gaToKICAgICAgICAgIGlkXzVNID0gdVsiaWQiXQogICAgICAgICAgbmFtZV81TSA9IHVbIm5hbWUiXQogICAgICAgICAgcHJvZml0XzVNID0gdVsicHJvZml0UGVySG91ckRlbHRhIl0KICAgICAgICAgIHByaWNlXzVNID0gdVsicHJpY2UiXSsxCiAgICAgICAgICBES181TSA9IHVbImNvbmRpdGlvbiJdCiAgICAgICAgICB0YXJnZXRMVl81TSA9IHVbImxldmVsIl0rMQogICAgICAgICAgaXNBdmFpbGFibGVfNU0gPSB1WyJpc0F2YWlsYWJsZSJdCiAgICAgICAgICB1cGdyYWRlc0luZm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCBsZXZlbF81TSA9IFVQREFURV9DT01CTyhpZF81TSx1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8sIGJhbGFuY2UsIGVhcm5QZXJIb3VyLCB0YXJnZXRMVl81TSwgcHJveGllcykKICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgIGlmIGxldmVsXzVNID49IHRhcmdldExWXzVNOgogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBuw6JuZyBj4bqlcCB7bGFtfUNPTUJPIHts4bulY317bmFtZV81TX0ge3Ry4bqvbmd9KHtsYW19e3RhcmdldExWXzVNfXt0cuG6r25nfVxuIikKICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ31DaMawYSBuw6JuZyBj4bqlcCB7bGFtfUNPTUJPIHts4bulY317bmFtZV81TX0ge3Ry4bqvbmd9bMOqbiBsZXZlbCB7bGFtfXt0YXJnZXRMVl81TX0ge3Ry4bqvbmd9KHtsYW19e2xldmVsXzVNfXt0cuG6r25nfSlcbiIpCiAgICAgICAgICBicmVhawogICAgaWYgZGFpbHlDb21ib1siaXNDbGFpbWVkIl0gPT0gRmFsc2U6CiAgICAgIGJhbGFuY2UgPSBDTEFJTV81TShoZWFkZXJzLCBiYWxhbmNlLCBwcm94aWVzKQogICAgZWxzZToKICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9xJDDoyBuaOG6rW4ge3bDoG5nfTVNIHt0cuG6r25nfW5nw6B5IGjDtG0gbmF5XG4iKQogICAgd2hpbGUgVHJ1ZToKICAgICAgaWYgZW5lcmd5L2RhbWUgPiAxMDoKICAgICAgICBpZiBlbmVyZ3kvZGFtZSA+IDIwMDoKICAgICAgICAgIGNvdW50VGFwID0gcmFuZG9tLnJhbmRpbnQoMTAwLDIwMCkKICAgICAgICBlbHNlOgogICAgICAgICAgY291bnRUYXAgPSBpbnQoZW5lcmd5L2RhbWUpCiAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpICogMTAwMCkKICAgICAgICBhbW91bnQgPSBkYW1lKmNvdW50VGFwCiAgICAgICAgbmV3YmFsYW5jZSwgZW5lcmd5ID0gVEFQKGhlYWRlcnMsIHsiY291bnQiOmNvdW50VGFwLCJhdmFpbGFibGVUYXBzIjplbmVyZ3ktY291bnRUYXAqZGFtZSwidGltZXN0YW1wIjp0aW1lc3RhbXB9LCBwcm94aWVzKQogICAgICAgIGNvbGxlY3RBbW91bnQgPSBuZXdiYWxhbmNlIC0gYmFsYW5jZQogICAgICAgIGJhbGFuY2UgPSBuZXdiYWxhbmNlCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIHByaW50KGYie8SRZW594pWU4pWQe8SR4buPfVt7dsOgbmd9e25vd190aW1lfXvEkeG7j31dIHt0cuG6r25nfcSQw6MgQ0xJQ0sge2zhu6VjfXtjb3VudFRhcH0ge3Ry4bqvbmd9bOG6p24ge3bDoG5nfSt7Y29sbGVjdEFtb3VudDosfSB7xJHhu499wrsiLCBlbmQ9IiAiKQogICAgICAgIHByaW50KGYie3bDoG5nfXtuZXdiYWxhbmNlOix9XG57xJFlbn3ilZriq7h7aOG7k25nfUxpbmsgdG9vbCAmIGjGsOG7m25nIGThuqtuIHThuqFpIFRlbGVncmFte8SR4buPfToge2zhu6VjfUBBaXJkcm9wVG9vbENoYW5uZWxcbiIpCiAgICAgIGVsc2U6CiAgICAgICAgdGFwQ29uZmlnLCBlbmVyZ3lDb25maWcsIGZ1bGxlbmVyZ3lDb25maWcgPSBCT09TVFMoaGVhZGVycywgcHJveGllcykKICAgICAgICBpZiBmdWxsZW5lcmd5Q29uZmlnWyJsZXZlbCJdIDw9IGZ1bGxlbmVyZ3lDb25maWdbIm1heExldmVsIl0gYW5kIGZ1bGxlbmVyZ3lDb25maWdbImNvb2xkb3duU2Vjb25kcyJdID09IDA6CiAgICAgICAgICBiYWxhbmNlLCBlbmVyZ3ksIGRhbWUsIHRhcENvbmZpZywgZW5lcmd5Q29uZmlnLCBuZXdmdWxsZW5lcmd5Q29uZmlnLCBlbmVyZ3lNYXggPSBMRVZFTF9VUChoZWFkZXJzLCJCb29zdEZ1bGxBdmFpbGFibGVUYXBzIiwgcHJveGllcykKICAgICAgICAgIGlmIGZ1bGxlbmVyZ3lDb25maWdbImxldmVsIl0gPCBuZXdmdWxsZW5lcmd5Q29uZmlnWyJsZXZlbCJdOgogICAgICAgICAgICBmdWxsZW5lcmd5Q29uZmlnID0gbmV3ZnVsbGVuZXJneUNvbmZpZwogICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9xJDDoyBrw61jaCBob+G6oXQgRnVsbCBFbmVyZ3kiLCBlbmQ9IiAiKQogICAgICAgICAgICBwcmludChmInvEkeG7j31be2xhbX17ZW5lcmd5fXvEkWVufS97bGFtfXtlbmVyZ3lNYXh9e8SR4buPfV1cbiIpCiAgICAgICAgICBlbHNlOgogICAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499xJDDoyBrw61jaCBob+G6oXQgRnVsbCBFbmVyZ3kgVEjhuqRUIELhuqBJIikKICAgICAgICBlbHNlOgogICAgICAgICAgYnJlYWsKICAgIGxpc3RfdXBncmFkZSA9IFtdCiAgICBsaXN0X3VwZ3JhZGVfQ29tYm8gPSBbXQogICAgZm9yIHVwZ3JhZGUgaW4gdXBncmFkZXNJbmZvOgogICAgICBkZWxheSA9IDAKICAgICAgaWRfdXBncmFkZSA9IHVwZ3JhZGVbImlkIl0KICAgICAgbmFtZV91cGdyYWRlID0gdXBncmFkZVsibmFtZSJdCiAgICAgIHByb2ZpdF91cGdyYWRlID0gdXBncmFkZVsicHJvZml0UGVySG91ckRlbHRhIl0KICAgICAgcHJpY2VfdXBncmFkZSA9IHVwZ3JhZGVbInByaWNlIl0rMQogICAgICBES191cGdyYWRlID0gdXBncmFkZVsiY29uZGl0aW9uIl0KICAgICAgbGV2ZWxfdXBncmFkZSA9IHVwZ3JhZGVbImxldmVsIl0KICAgICAgaXNBdmFpbGFibGVfdXBncmFkZSA9IHVwZ3JhZGVbImlzQXZhaWxhYmxlIl0KICAgICAgaXNFeHBpcmVkX3VwZ3JhZGUgPSB1cGdyYWRlWyJpc0V4cGlyZWQiXQogICAgICBkZWxheSA9IDAKICAgICAgdHJ5OgogICAgICAgIGRlbGF5ID0gdXBncmFkZVsiY29vbGRvd25TZWNvbmRzIl0KICAgICAgZXhjZXB0OgogICAgICAgIGRlbGF5ID0gMAogICAgICBpZiBpbnQoZGVsYXkpID4gMDoKICAgICAgICBpc0F2YWlsYWJsZV91cGdyYWRlID0gRmFsc2UKICAgICAgICBjb250aW51ZQogICAgICBpZiBpc0V4cGlyZWRfdXBncmFkZSA9PSBGYWxzZSBhbmQgaXNBdmFpbGFibGVfdXBncmFkZSA9PSBUcnVlIGFuZCBwcm9maXRfdXBncmFkZSoyNCozMCA+IHByaWNlX3VwZ3JhZGUgYW5kIGRlbGF5ID09IDA6CiAgICAgICAgaW5mb0l0ZW0gPSBmIntwcm9maXRfdXBncmFkZS9wcmljZV91cGdyYWRlfXx7cHJvZml0X3VwZ3JhZGV9fHtwcmljZV91cGdyYWRlfXx7aWRfdXBncmFkZX18e2xldmVsX3VwZ3JhZGV9fHtuYW1lX3VwZ3JhZGV9fHtpc0F2YWlsYWJsZV91cGdyYWRlfXwiCiAgICAgICAgaW5mb0l0ZW0gKz0gKDI1MC1sZW4oaW5mb0l0ZW0pKSoieCIKICAgICAgICBsaXN0X3VwZ3JhZGUuYXBwZW5kKGluZm9JdGVtKQogICAgbGlzdF91cGdyYWRlID0gc29ydGVkKGxpc3RfdXBncmFkZSwga2V5PWxhbWJkYSB4OiBmbG9hdCh4LnNwbGl0KCd8JylbMF0pLCByZXZlcnNlPVRydWUpCiAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31ISeG7hk4gQ8OTIHtsYW19e2xlbihsaXN0X3VwZ3JhZGUpfSB7dHLhuq9uZ31USOG6uiBM4buiSSBOSFXhuqxOIENBTyBDw5MgVEjhu4IgTsOCTkcgQ+G6pFAiKQogICAgI3ByaW50KGxpc3RfdXBncmFkZSkKICAgIGZvciBpIGluIHJhbmdlKDAsbGVuKGxpc3RfdXBncmFkZSkpOgogICAgICB1cGdyYWRlID0gbGlzdF91cGdyYWRlW2ldCiAgICAgIGlmIHVwZ3JhZGUgIT0gbGlzdF91cGdyYWRlWy0xXToKICAgICAgICBuZXh0X1RCID0gbGlzdF91cGdyYWRlW2krMV0KICAgICAgICBuZXh0X1RCID0gZmxvYXQobmV4dF9UQi5zcGxpdCgnfCcpWzBdKQogICAgICB1cGdyYWRlSW5mbyA9IHVwZ3JhZGUuc3BsaXQoJ3wnKQogICAgICBwcmljZVRCID0gZmxvYXQodXBncmFkZUluZm9bMF0pCiAgICAgIHByb2ZpdF91cGdyYWRlID0gaW50KHVwZ3JhZGVJbmZvWzFdKQogICAgICBwcmljZV91cGdyYWRlID0gaW50KHVwZ3JhZGVJbmZvWzJdKQogICAgICBpZF91cGdyYWRlID0gdXBncmFkZUluZm9bM10KICAgICAgbGV2ZWxfdXBncmFkZSA9IGludCh1cGdyYWRlSW5mb1s0XSkKICAgICAgbmFtZV91cGdyYWRlID0gdXBncmFkZUluZm9bNV0KICAgICAgaXNBdmFpbGFibGVfdXBncmFkZSA9IHVwZ3JhZGVJbmZvWzZdCiAgICAgIGlmIGJhbGFuY2UgPCBwcmljZV91cGdyYWRlOgogICAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31USEnhur5VIFRJ4buATiBOw4JORyB7bOG7pWN9e25hbWVfdXBncmFkZX0ge3bDoG5nfXtwcm9maXRfdXBncmFkZTosfXvEkeG7j30ve3bDoG5nfWgge8SRZW59fCB7xJHhu499e3ByaWNlX3VwZ3JhZGV9IHvEkWVufcK7IHt2w6BuZ317YmFsYW5jZTosfSIpCiAgICAgICAgY29udGludWUKICAgICAgd2hpbGUgYmFsYW5jZSA+IHByaWNlX3VwZ3JhZGUgYW5kIGlzQXZhaWxhYmxlX3VwZ3JhZGUgPT0gIlRydWUiIGFuZCBlYXJuUGVySG91ciA8IDMwMDAwMDA6CiAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpICogMTAwMCkKICAgICAgICBpZiBsZW4obGlzdF91cGdyYWRlKSA+IDE6CiAgICAgICAgICBpZiB1cGdyYWRlICE9IGxpc3RfdXBncmFkZVstMl0gYW5kIGlkX3VwZ3JhZGUgbm90IGluIGxpc3RfdXBncmFkZToKICAgICAgICAgICAgaWYgcHJvZml0X3VwZ3JhZGUvcHJpY2VfdXBncmFkZSA8IG5leHRfVEI6CiAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBuZXdiYWxhbmNlLCBuZXd1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8gPSBCVVlfVVBHUkFERShoZWFkZXJzLCB7InVwZ3JhZGVJZCI6aWRfdXBncmFkZSwidGltZXN0YW1wIjp0aW1lc3RhbXB9LCBiYWxhbmNlLCB1cGdyYWRlc0luZm8sIGRhaWx5Q29tYm8sIHByb3hpZXMpCiAgICAgICAgZWFyblBlckhvdXIgKz0gcHJvZml0X3VwZ3JhZGUKICAgICAgICBpZiBiYWxhbmNlID4gbmV3YmFsYW5jZToKICAgICAgICAgIGJhbGFuY2UgPSBuZXdiYWxhbmNlCiAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICBwcmludChmInvEkWVufeKVlOKVkOKVkHvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAgdGjhursge2zhu6VjfXtuYW1lX3VwZ3JhZGV9IHt0cuG6r25nfSh7bGFtfXtsZXZlbF91cGdyYWRlKzF9e3Ry4bqvbmd9KSIpCiAgICAgICAgICBwcmludChmInvEkWVufeKVmuKVkOKVkOKruCB7xJHhu499LXtwcmljZV91cGdyYWRlOix9IHts4bulY33igKIge3bDoG5nfSt7cHJvZml0X3VwZ3JhZGU6LH17xJHhu499L3t2w6BuZ31oIHts4bulY33Cu8K7IHt2w6BuZ317ZWFyblBlckhvdXI6LH17xJHhu499L3t2w6BuZ31oIHvEkWVufcK7wrvCuyB7dsOgbmd9e2ludChiYWxhbmNlKTosfVxuIikKICAgICAgICAgIGlmIGxlbihkYWlseUNvbWJvWyJ1cGdyYWRlSWRzIl0pID09IDMgYW5kIGRhaWx5Q29tYm9bImlzQ2xhaW1lZCJdID09IEZhbHNlOgogICAgICAgICAgICBiYWxhbmNlID0gQ0xBSU1fNU0oaGVhZGVycywgYmFsYW5jZSwgcHJveGllcykKICAgICAgICBlbHNlOgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31Ow6JuZyBj4bqlcCB7bOG7pWN9e25hbWVfdXBncmFkZX0ge8SR4buPfVRI4bqkVCBC4bqgSSIpCiAgICAgICAgICBicmVhawogICAgICAgIGlmIHVwZ3JhZGUgPT0gbGlzdF91cGdyYWRlWy0xXToKICAgICAgICAgIGJyZWFrCiAgICAgICAgZm9yIGkgaW4gbmV3dXBncmFkZXNJbmZvOgogICAgICAgICAgaWYgc3RyKGlbImlkIl0pID09IGlkX3VwZ3JhZGU6CiAgICAgICAgICAgIGRlbGF5ID0gMAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgZGVsYXkgPSBpWyJjb29sZG93blNlY29uZHMiXQogICAgICAgICAgICBleGNlcHQ6IAogICAgICAgICAgICAgIGRlbGF5ID0gMAogICAgICAgICAgICBpZiBkZWxheSAhPSAwOgogICAgICAgICAgICAgIGlzQXZhaWxhYmxlX3VwZ3JhZGUgPSBGYWxzZQogICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHByb2ZpdF91cGdyYWRlID0gaVsicHJvZml0UGVySG91ckRlbHRhIl0KICAgICAgICAgICAgcHJpY2VfdXBncmFkZSA9IGlbInByaWNlIl0KICAgICAgICAgICAgaXNBdmFpbGFibGVfdXBncmFkZSA9IHN0cihpWyJpc0F2YWlsYWJsZSJdKQogICAgICAgICAgICBsZXZlbF91cGdyYWRlID0gaVsibGV2ZWwiXQogICAgICAgICAgICBicmVhawogICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9S0jDlE5HIEPDkk4gVEjhurogTOG7okkgTkhV4bqsTiBDQU8gUEjDmSBI4buiUCDEkOG7giBOw4JORyBD4bqkUCIpCiAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31I4bq+VCBMxq/hu6JUIENMSUNLLCBI4bq+VCBCT09TVEVSUyB7xJHhu499wrsge3bDoG5nfcSQ4buUSSBUw4BJIEtIT+G6ok4iKQpSVU5fSEFNU1RFUigp"