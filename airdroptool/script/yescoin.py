api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMCIKbmFtZV90b29sID0gInllc2NvaW4iCkJBTk5FUihuYW1lX3Rvb2wsIHZlcnNpb24pCnByaW50KGYiIiIKe8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHtsYW19Q8OBQyBDSOG7qEMgTsSCTkcgQ+G7pkEgVE9PTAp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBjbGljawp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBjbGlhbSBwb2ludCBvZmZsaW5lCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31BdXRvIG7Dom5nIGPhuqVwCnvEkeG7j31be3bDoG5nfSt7xJHhu499XSB7dHLhuq9uZ31Ib8OgbiB0aMOgbmggY8OhYyBuaGnhu4dtIHbhu6UKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gc+G7rSBk4bulbmcgY8OhYyBib29zdGVyIAoiIiIpCmRlZiBBY2NvdW50SW5mbyhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIG1lc3NhZ2UgPSB0b3RhbEFtb3VudCA9IHVzZXJMZXZlbCA9IHVzZXJJZCA9ICIiCiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL2FjY291bnQvZ2V0QWNjb3VudEluZm8iLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvYWNjb3VudC9nZXRBY2NvdW50SW5mbyIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBiYWxhbmNlID0gZGF0YVsiZGF0YSJdWyJjdXJyZW50QW1vdW50Il0KICAgICAgICB1c2VyTGV2ZWwgPSBkYXRhWyJkYXRhIl1bInVzZXJMZXZlbCJdCiAgICAgICAgdXNlcklkID0gZGF0YVsiZGF0YSJdWyJ1c2VySWQiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgWUVTQ09JTiIpCiAgICAgIFJVTl9ZRVNDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gYmFsYW5jZSwgdXNlckxldmVsLCB1c2VySWQKZGVmIEdhbWVJbmZvKGhlYWRlcnMsIHByb3hpZXM9Tm9uZSk6CiAgbWVzc2FnZSA9IGxldmVsX0NsaWNrID0gbWF4X2VuZXJneSA9IGVuZXJneSA9IHJlc2V0X2VuZXJneSA9ICIiCiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL2dhbWUvZ2V0R2FtZUluZm8iLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvZ2FtZS9nZXRHYW1lSW5mbyIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBjbGlja192YWx1ZSA9IGRhdGFbImRhdGEiXVsic2luZ2xlQ29pblZhbHVlIl0KICAgICAgICBtYXhfZW5lcmd5ID0gZGF0YVsiZGF0YSJdWyJjb2luUG9vbFRvdGFsQ291bnQiXQogICAgICAgIGVuZXJneSA9IGRhdGFbImRhdGEiXVsiY29pblBvb2xMZWZ0Q291bnQiXQogICAgICAgIHJlY292ZXJ5X2VuZXJneSA9IGRhdGFbImRhdGEiXVsiY29pblBvb2xSZWNvdmVyeVNwZWVkIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFlFU0NPSU4iKQogICAgICBSVU5fWUVTQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGNsaWNrX3ZhbHVlLCBtYXhfZW5lcmd5LCBlbmVyZ3ksIHJlY292ZXJ5X2VuZXJneQpkZWYgbXlTcXVhZChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIG1lc3NhZ2UgPSBzcXVhZE1lbWJlcnMgPSBzcXVhZENvaW4gPSBzcXVhZExldmVsID0gc3F1YWROYW1lID0gc3F1YWRUZ0xpbmsgPSAiIgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9zcXVhZC9teVNxdWFkIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL3NxdWFkL215U3F1YWQiLCBoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIG1lc3NhZ2UgPSBkYXRhWyJtZXNzYWdlIl0KICAgICAgaWYgbWVzc2FnZSA9PSAiU3VjY2VzcyI6CiAgICAgICAgaXNKb2luU3F1YWQgPSBkYXRhWyJkYXRhIl1bImlzSm9pblNxdWFkIl0KICAgICAgICBpZiBpc0pvaW5TcXVhZCA9PSBUcnVlOgogICAgICAgICAgc3F1YWRJbmZvID0gZGF0YVsiZGF0YSJdWyJzcXVhZEluZm8iXQogICAgICAgICAgc3F1YWRNZW1iZXJzID0gc3F1YWRJbmZvWyJzcXVhZE1lbWJlcnMiXQogICAgICAgICAgc3F1YWRDb2luID0gc3F1YWRJbmZvWyJzcXVhZFRvdGFsQW1vdW50Il0KICAgICAgICAgIHNxdWFkTGV2ZWwgPSBzcXVhZEluZm9bInNxdWFkTGV2ZWwiXQogICAgICAgICAgc3F1YWROYW1lID0gc3F1YWRJbmZvWyJzcXVhZFRpdGxlIl0KICAgICAgICAgIHNxdWFkTGluayA9IHNxdWFkSW5mb1sic3F1YWRUZ0xpbmsiXQogICAgICAgIGVsc2U6CiAgICAgICAgICBzcXVhZE1lbWJlcnMsIHNxdWFkQ29pbiwgc3F1YWRMZXZlbCwgc3F1YWROYW1lLCBzcXVhZExpbmsgPSBqb2luU3F1YWQoaGVhZGVycywgcHJveGllcykKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFlFU0NPSU4iKQogICAgICBSVU5fWUVTQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHNxdWFkTWVtYmVycywgc3F1YWRDb2luLCBzcXVhZExldmVsLCBzcXVhZE5hbWUsIHNxdWFkTGluawoKZGVmIGpvaW5TcXVhZChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIG1lc3NhZ2UgPSBzcXVhZFRpdGxlID0gaXNKb2luU3F1YWQgPSAiIgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvc3F1YWQvam9pblNxdWFkIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXsic3F1YWRUZ0xpbmsiOiJAQWlyZHJvcFRvb2xDaGFubmVsIn0sIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL3NxdWFkL2pvaW5TcXVhZCIsIGhlYWRlcnM9aGVhZGVycywganNvbj17InNxdWFkVGdMaW5rIjoiQEFpcmRyb3BUb29sQ2hhbm5lbCJ9KQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICBtZXNzYWdlID0gZGF0YVsibWVzc2FnZSJdCiAgICAgIGlmIG1lc3NhZ2UgPT0gIlN1Y2Nlc3MiOgogICAgICAgIGlzSm9pblNxdWFkID0gZGF0YVsiZGF0YSJdWyJpc0pvaW5TcXVhZCJdCiAgICAgICAgaWYgaXNKb2luU3F1YWQgPT0gVHJ1ZToKICAgICAgICAgIHNxdWFkSW5mbyA9IGRhdGFbImRhdGEiXVsic3F1YWRJbmZvIl0KICAgICAgICAgIHNxdWFkTWVtYmVycyA9IHNxdWFkSW5mb1sic3F1YWRNZW1iZXJzIl0KICAgICAgICAgIHNxdWFkQ29pbiA9IHNxdWFkSW5mb1sic3F1YWRUb3RhbEFtb3VudCJdCiAgICAgICAgICBzcXVhZExldmVsID0gc3F1YWRJbmZvWyJzcXVhZExldmVsIl0KICAgICAgICAgIHNxdWFkTmFtZSA9IHNxdWFkSW5mb1sic3F1YWRUaXRsZSJdCiAgICAgICAgICBzcXVhZExpbmsgPSBzcXVhZEluZm9bInNxdWFkVGdMaW5rIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFlFU0NPSU4iKQogICAgICBSVU5fWUVTQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHNxdWFkTWVtYmVycywgc3F1YWRDb2luLCBzcXVhZExldmVsLCBzcXVhZE5hbWUsIHNxdWFkTGluawpkZWYgbGVhdmVTcXVhZChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGhlYWRlcnNbImNvbnRlbnQtdHlwZSJdID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIKICBtZXNzYWdlID0gZGF0YSA9ICIiCiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL3NxdWFkL2xlYXZlU3F1YWQiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvc3F1YWQvbGVhdmVTcXVhZCIsIGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgcHJpbnQoZGF0YSkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBkYXRhID0gZGF0YVsiZGF0YSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBZRVNDT0lOIikKICAgICAgUlVOX1lFU0NPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBkYXRhCmRlZiBnZXRMaXN0VGFzayhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIG1lc3NhZ2UgPSBkYXRhID0gIiIKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvdGFzay9nZXRDb21tb25UYXNrTGlzdCIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC90YXNrL2dldENvbW1vblRhc2tMaXN0IiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICBtZXNzYWdlID0gZGF0YVsibWVzc2FnZSJdCiAgICAgIGlmIG1lc3NhZ2UgPT0gIlN1Y2Nlc3MiOgogICAgICAgIGxpc3RUYXNrID0gZGF0YVsiZGF0YSJdCiAgICAgICAgZm9yIFRhc2sgaW4gbGlzdFRhc2s6CiAgICAgICAgICB0YXNrU3RhdHVzID0gVGFza1sidGFza1N0YXR1cyJdCiAgICAgICAgICBpZiB0YXNrU3RhdHVzID09IDA6CiAgICAgICAgICAgIHRhc2tOYW1lLCBib251c0Ftb3VudCA9IGZpbmlzaFRhc2soaGVhZGVycyxUYXNrLHByb3hpZXMpCiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY33EkMOjIGhvw6BuIHRow6BuaCBuaGnhu4dtIHbhu6Uge2zhu6VjfXt0YXNrTmFtZX0ge3bDoG5nfSt7Ym9udXNBbW91bnR98J+qmSIpCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBZRVNDT0lOIikKICAgICAgUlVOX1lFU0NPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQpkZWYgZmluaXNoVGFzayhoZWFkZXJzLFRhc2ssIHByb3hpZXM9Tm9uZSk6CiAgdGFza0lkID0gVGFza1sidGFza0lkIl0KICB0YXNrTmFtZSA9IFRhc2tbInRhc2tOYW1lIl0KICBtZXNzYWdlID0gYm9udXNBbW91bnQgPSAiIgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvdGFzay9maW5pc2hUYXNrIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXRhc2tJZCwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvdGFzay9maW5pc2hUYXNrIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXRhc2tJZCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBib251c0Ftb3VudCA9IGRhdGFbImRhdGEiXVsiYm9udXNBbW91bnQiXQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgWUVTQ09JTiIpCiAgICAgIFJVTl9ZRVNDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gdGFza05hbWUsIGJvbnVzQW1vdW50CmRlZiBDb2xsZWN0KGhlYWRlcnMsY291bnRDb2xsZWN0LCBwcm94aWVzPU5vbmUpOgogIG1lc3NhZ2UgPSBjb2xsZWN0QW1vdW50ID0gY29sbGVjdFN0YXR1cyA9ICIiCiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9nYW1lL2NvbGxlY3RDb2luIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWNvdW50Q29sbGVjdCwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvZ2FtZS9jb2xsZWN0Q29pbiIsIGhlYWRlcnM9aGVhZGVycywganNvbj1jb3VudENvbGxlY3QpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgIG1lc3NhZ2UgPSBkYXRhWyJtZXNzYWdlIl0KICAgICAgaWYgbWVzc2FnZSA9PSAiU3VjY2VzcyI6CiAgICAgICAgY29sbGVjdEFtb3VudCA9IGRhdGFbImRhdGEiXVsiY29sbGVjdEFtb3VudCJdCiAgICAgICAgY29sbGVjdFN0YXR1cyA9IGRhdGFbImRhdGEiXVsiY29sbGVjdFN0YXR1cyJdCiAgICAgIGVsc2U6CiAgICAgICAgcGFzcyNwcmludChyZXNwb25zZS50ZXh0KQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgWUVTQ09JTiIpCiAgICAgIFJVTl9ZRVNDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gY29sbGVjdEFtb3VudCwgY29sbGVjdFN0YXR1cwpkZWYgQ2hlc3RJbmZvKGhlYWRlcnMsIHByb3hpZXM9Tm9uZSk6CiAgbWVzc2FnZSA9IGNvbGxlY3RBbW91bnQgPSBjb2xsZWN0U3RhdHVzID0gIiIKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvZ2FtZS9nZXRTcGVjaWFsQm94SW5mbyIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9nYW1lL2dldFNwZWNpYWxCb3hJbmZvIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICBtZXNzYWdlID0gZGF0YVsibWVzc2FnZSJdCiAgICAgIGlmIG1lc3NhZ2UgPT0gIlN1Y2Nlc3MiOgogICAgICAgIGF1dG9Cb3ggPSBkYXRhWyJkYXRhIl1bImF1dG9Cb3giXQogICAgICAgIGlmIGF1dG9Cb3ggIT0gTm9uZToKICAgICAgICAgIGJveFN0YXR1cyA9IGF1dG9Cb3hbImJveFN0YXR1cyJdCiAgICAgICAgICBpZiBib3hTdGF0dXMgPT0gVHJ1ZToKICAgICAgICAgICAgQ29sbGVjdENoZXN0KGhlYWRlcnMsIGF1dG9Cb3gsIHByb3hpZXMpCiAgICAgICAgcmVjb3ZlcnlCb3ggPSBkYXRhWyJkYXRhIl1bInJlY292ZXJ5Qm94Il0KICAgICAgICBpZiByZWNvdmVyeUJveCAhPSBOb25lOgogICAgICAgICAgYm94U3RhdHVzID0gcmVjb3ZlcnlCb3hbImJveFN0YXR1cyJdCiAgICAgICAgICBpZiBib3hTdGF0dXMgPT0gVHJ1ZToKICAgICAgICAgICAgQ29sbGVjdENoZXN0KGhlYWRlcnMsIHJlY292ZXJ5Qm94LCBwcm94aWVzKQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgWUVTQ09JTiIpCiAgICAgIFJVTl9ZRVNDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKZGVmIENvbGxlY3RDaGVzdChoZWFkZXJzLCBpbmZvQm94LCBwcm94aWVzPU5vbmUpOgogIGJveFR5cGUgPSBpbmZvQm94WyJib3hUeXBlIl0KICBDaGVzdFRvdGFsQ291bnQgPSBpbmZvQm94WyJzcGVjaWFsQm94VG90YWxDb3VudCJdCiAgbWVzc2FnZSA9IGNvbGxlY3RBbW91bnQgPSBjb2xsZWN0U3RhdHVzID0gIiIKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL2dhbWUvY29sbGVjdFNwZWNpYWxCb3hDb2luIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXsiYm94VHlwZSI6Ym94VHlwZSwiY29pbkNvdW50IjpDaGVzdFRvdGFsQ291bnR9LCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9nYW1lL2NvbGxlY3RTcGVjaWFsQm94Q29pbiIsIGhlYWRlcnM9aGVhZGVycywganNvbj17ImJveFR5cGUiOmJveFR5cGUsImNvaW5Db3VudCI6Q2hlc3RUb3RhbENvdW50fSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBjb2xsZWN0QW1vdW50ID0gZGF0YVsiZGF0YSJdWyJjb2xsZWN0QW1vdW50Il0KICAgICAgICBjb2xsZWN0U3RhdHVzID0gZGF0YVsiZGF0YSJdWyJjb2xsZWN0U3RhdHVzIl0KICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgaWYgY29sbGVjdFN0YXR1cyA9PSBUcnVlOgogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY33EkMOjIG3hu58gS2hvIELDoXUge3bDoG5nfSt7Y29sbGVjdEFtb3VudDosffCfqpkge8SR4buPfcK7IiwgZW5kPSIgIikKICAgICAgICAgICNleGl0KCkKICAgICAgICBlbHNlOgogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31N4bufIGtobyBiw6F1IFRI4bqkVCBC4bqgSSB7xJHhu499wrsiLCBlbmQ9IiAiKQogICAgICAgIGJhbGFuY2UsIHVzZXJMZXZlbCwgdXNlcklkID0gQWNjb3VudEluZm8oaGVhZGVycyxwcm94aWVzKQogICAgICAgIHByaW50KGYie3bDoG5nffCfqpl7YmFsYW5jZTosfVxuIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFlFU0NPSU4iKQogICAgICBSVU5fWUVTQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCmRlZiBBY2NvdW50QnVpbGQoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvYnVpbGQvZ2V0QWNjb3VudEJ1aWxkSW5mbyIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9idWlsZC9nZXRBY2NvdW50QnVpbGRJbmZvIiwgaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBDaGVzdENvdW50ID0gZGF0YVsiZGF0YSJdWyJzcGVjaWFsQm94TGVmdFJlY292ZXJ5Q291bnQiXQogICAgICAgIFJlY292ZXJ5Q291bnQgPSBkYXRhWyJkYXRhIl1bImNvaW5Qb29sTGVmdFJlY292ZXJ5Q291bnQiXQogICAgICAgIENsaWNrQ29uZmlnID0gW2RhdGFbImRhdGEiXVsic2luZ2xlQ29pblZhbHVlIl0sZGF0YVsiZGF0YSJdWyJzaW5nbGVDb2luTGV2ZWwiXSxkYXRhWyJkYXRhIl1bInNpbmdsZUNvaW5VcGdyYWRlQ29zdCJdXQogICAgICAgIFJlY292ZXJ5Q29uZmlnID0gW2RhdGFbImRhdGEiXVsiY29pblBvb2xSZWNvdmVyeVNwZWVkIl0sZGF0YVsiZGF0YSJdWyJjb2luUG9vbFJlY292ZXJ5TGV2ZWwiXSxkYXRhWyJkYXRhIl1bImNvaW5Qb29sUmVjb3ZlcnlVcGdyYWRlQ29zdCJdXQogICAgICAgIEVuZXJneUNvbmZpZyA9IFtkYXRhWyJkYXRhIl1bImNvaW5Qb29sVG90YWxDb3VudCJdLGRhdGFbImRhdGEiXVsiY29pblBvb2xUb3RhbExldmVsIl0sZGF0YVsiZGF0YSJdWyJjb2luUG9vbFRvdGFsVXBncmFkZUNvc3QiXV0KICAgICAgICBCb3RDb25maWcgPSBbZGF0YVsiZGF0YSJdWyJzd2lwZUJvdFNwZWVkVmFsdWUiXSxkYXRhWyJkYXRhIl1bInN3aXBlQm90TGV2ZWwiXSxkYXRhWyJkYXRhIl1bInN3aXBlQm90VXBncmFkZUNvc3QiXV0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFlFU0NPSU4iKQogICAgICBSVU5fWUVTQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIENoZXN0Q291bnQsIFJlY292ZXJ5Q291bnQsIENsaWNrQ29uZmlnLCBSZWNvdmVyeUNvbmZpZywgRW5lcmd5Q29uZmlnLCBCb3RDb25maWcKZGVmIHJlY292ZXJDaGVzdChoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvZ2FtZS9yZWNvdmVyU3BlY2lhbEJveCIsIGhlYWRlcnM9aGVhZGVycywganNvbj17fSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvZ2FtZS9yZWNvdmVyU3BlY2lhbEJveCIsIGhlYWRlcnM9aGVhZGVycywganNvbj17fSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBkYXRhID0gZGF0YVsiZGF0YSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBZRVNDT0lOIikKICAgICAgUlVOX1lFU0NPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBkYXRhCmRlZiByZWNvdmVyQ29pblBvb2woaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL2dhbWUvcmVjb3ZlckNvaW5Qb29sIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPXt9LCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9nYW1lL3JlY292ZXJDb2luUG9vbCIsIGhlYWRlcnM9aGVhZGVycywganNvbj17fSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBkYXRhID0gZGF0YVsiZGF0YSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBZRVNDT0lOIikKICAgICAgUlVOX1lFU0NPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBkYXRhCmRlZiBsZXZlbFVwKGhlYWRlcnMsIGRhdGFVcGdyYWRlLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvYnVpbGQvbGV2ZWxVcCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhVXBncmFkZSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvYnVpbGQvbGV2ZWxVcCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhVXBncmFkZSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBkYXRhID0gZGF0YVsiZGF0YSJdCiAgICAgICAgI3ByaW50KGRhdGEpCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBZRVNDT0lOIikKICAgICAgUlVOX1lFU0NPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBkYXRhCmRlZiBDbGFpbU9mZmxpbmUoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL2dhbWUvY2xhaW1PZmZsaW5lWWVzUGFjQm9udXMiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL2dhbWUvY2xhaW1PZmZsaW5lWWVzUGFjQm9udXMiLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICNwcmludChkYXRhKQogICAgICBtZXNzYWdlID0gZGF0YVsibWVzc2FnZSJdCiAgICAgIGlmIG1lc3NhZ2UgPT0gIlN1Y2Nlc3MiOgogICAgICAgIGNvbGxlY3RBbW91bnQgPSBkYXRhWyJkYXRhIl1bImNvbGxlY3RBbW91bnQiXQogICAgICAgIHN0YXR1cyA9IGRhdGFbImRhdGEiXVsiY29sbGVjdFN0YXR1cyJdCiAgICAgIGVsc2U6CiAgICAgICAgY29sbGVjdEFtb3VudCA9IE5vbmUKICAgICAgICBzdGF0dXMgPSBGYWxzZQogICAgICBicmVhawogICAgZXhjZXB0OgogICAgICBlcnJvcl9jb3VudCA9IGhhbmRsZUVycm9ycyhlcnJvcl9jb3VudCwgbWF4X3JldHJpZXMpCiAgICBpZiBlcnJvcl9jb3VudCA+PSBtYXhfcmV0cmllczoKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyBn4bq3cCBs4buXaSBxdcOhIDEwIGzhuqduLCBraOG7n2kgY2jhuqF5IGzhuqFpIHRvb2wgWUVTQ09JTiIpCiAgICAgIFJVTl9ZRVNDT0lOKCkKICAgICAgYnJlYWsKICAgIENPVU5URE9XTigxMCkKICByZXR1cm4gY29sbGVjdEFtb3VudCwgc3RhdHVzCmRlZiBzaWduSW4oaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvc2lnbkluL2xpc3QiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGktYmFja2VuZC55ZXNjb2luLmdvbGQvc2lnbkluL2xpc3QiLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICNwcmludChkYXRhKQogICAgICBtZXNzYWdlID0gZGF0YVsibWVzc2FnZSJdCiAgICAgIGlmIG1lc3NhZ2UgPT0gIlN1Y2Nlc3MiOgogICAgICAgIHNpZ25Jbkxpc3QgPSBkYXRhWyJkYXRhIl0KICAgICAgZWxzZToKICAgICAgICBzaWduSW5MaXN0ID0gIiIKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIFlFU0NPSU4iKQogICAgICBSVU5fWUVTQ09JTigpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHNpZ25Jbkxpc3QKZGVmIHNpZ25JbkNsYWltKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHByaW50KGRhdGEpCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWJhY2tlbmQueWVzY29pbi5nb2xkL3NpZ25Jbi9jbGFpbSIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1iYWNrZW5kLnllc2NvaW4uZ29sZC9zaWduSW4vY2xhaW0iLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgbWVzc2FnZSA9IGRhdGFbIm1lc3NhZ2UiXQogICAgICBwcmludChkYXRhKQogICAgICBpZiBtZXNzYWdlID09ICJTdWNjZXNzIjoKICAgICAgICBzdGF0dXMgPSBkYXRhWyJzdGF0dXMiXQogICAgICAgIHJld2FyZCA9IGRhdGFbInJld2FyZCJdCiAgICAgIGVsc2U6CiAgICAgICAgc3RhdHVzID0gRmFsc2UKICAgICAgICByZXdhcmQgPSAwCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBZRVNDT0lOIikKICAgICAgUlVOX1lFU0NPSU4oKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBzdGF0dXMsIHJld2FyZAoKZGVmIFJVTl9ZRVNDT0lOKCk6CiAgc3R0ID0gMAogIHdpdGggb3BlbignY29uZmlnL3llc2NvaW4uanNvbicsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToKICAgIGNvbmZpZ19kYXRhID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKQogIHVzZXJzID0gY29uZmlnX2RhdGEKICBpZiBsZW4odXNlcnMpID4gMTA6CiAgICBwcmludCgiQuG6oW4gY2jhu4kgxJHGsOG7o2MgcGjDqXAgdGjDqm0gdOG7kWkgxJFhIDEwIHTDoGkga2hv4bqjbiDEkeG7gyBjaOG6oXkgdG9vbCIpCiAgICBleGl0KCkKICBmb3IgdXNlciBpbiB1c2VyczoKICAgIGFjY291bnQgPSB1c2VyWyJTVFRfQUNDT1VOVCJdCiAgICBhdXRob3JpemF0aW9uID0gdXNlclsiQVVUSE9SSVpBVElPTiJdCiAgICBpZiBhdXRob3JpemF0aW9uID09ICIiIG9yIGF1dGhvcml6YXRpb24gPT0gInRoYXlfdGjhur9fYuG6sW5nX2F1dGhvcml6YXRpb24iOgogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499VMOgaSBraG/huqNuIHt2w6BuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfSB7xJHhu499REFUQSDEkWFuZyBi4buLIHRy4buRbmciKQogICAgICBjb250aW51ZQogICAgd2l0aCBvcGVuKCdjb25maWcvc2V0dGluZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgICBjb25maWdfYWNjID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKVthY2NvdW50XQogICAgcHJveHlfbGlzdCA9IGNvbmZpZ19hY2NbInByb3h5Il0KICAgIHR5cGVfcHJveHkgPSBjb25maWdfYWNjWyJ0eXBlX3Byb3h5Il0KICAgIHVzZXJfYWdlbnQgPSBjb25maWdfYWNjWyJ1c2VyLWFnZW50Il0KICAgIGlmIHByb3h5X2xpc3QgIT0gIiI6CiAgICAgIHByb3h5X2xpc3QgPSBwcm94eV9saXN0LnNwbGl0KCI6IikKICAgICAgcHJveHkgPSBmInt0eXBlX3Byb3h5fTovL3twcm94eV9saXN0WzJdfTp7cHJveHlfbGlzdFszXX1Ae3Byb3h5X2xpc3RbMF19Ontwcm94eV9saXN0WzFdfSIKICAgICAgcHJveGllcyA9IHsKICAgICAgJ2h0dHAnOiBwcm94eSwKICAgICAgJ2h0dHBzJzogcHJveHksfQogICAgZWxzZToKICAgICAgaWYgYWNjb3VudC5zcGxpdCgnXycpWzFdICE9ICIxIjoKICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31DaHV54buDbiB0w6BpIGtob+G6o24gZG8ga2jDtG5nIGPDsyBwcm94eSIpCiAgICAgICAgY29udGludWUKICAgICAgcHJveGllcyA9ICIiCiAgICBpcCwgZmFrZWlwID0gZ2V0SVAocHJveGllcykKICAgIGlmIGlwID09IGZha2VpcCA9PSBOb25lOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31cbsSQ4buUSSBUw4BJIEtIT+G6ok4gRE8gS0jDlE5HIEzhuqRZIMSQxq/hu6JDIElQLCBIw4NZIEtJ4buCTSBUUkEgTOG6oEkgUFJPWFlcbiIpCiAgICAgIGNvbnRpbnVlCiAgICBoZWFkZXJzID0gewogICAgICAnSG9zdCc6J2FwaS55ZXNjb2luLmdvbGQnLAogICAgICAnc2VjLWNoLXVhJzonIkNocm9taXVtIjt2PSIxMjQiLCAiQW5kcm9pZCBXZWJWaWV3Ijt2PSIxMjQiLCAiTm90LUEuQnJhbmQiO3Y9Ijk5IicsCiAgICAgICdzZWMtY2gtdWEtbW9iaWxlJzonPzEnLAogICAgICAndG9rZW4nOmF1dGhvcml6YXRpb24sCiAgICAgICd1c2VyLWFnZW50Jzp1c2VyX2FnZW50LAogICAgICAnc2VjLWNoLXVhLXBsYXRmb3JtJzonIkFuZHJvaWQiJywKICAgICAgJ2FjY2VwdCc6JyovKicsCiAgICAgICdvcmlnaW4nOidodHRwczovL3d3dy55ZXNjb2luLmdvbGQnLAogICAgICAneC1yZXF1ZXN0ZWQtd2l0aCc6J21hcmsudmlhLmdwJywKICAgICAgJ3NlYy1mZXRjaC1zaXRlJzonY3Jvc3Mtc2l0ZScsCiAgICAgICdzZWMtZmV0Y2gtbW9kZSc6J2NvcnMnLAogICAgICAnc2VjLWZldGNoLWRlc3QnOidlbXB0eScsCiAgICAgICdyZWZlcmVyJzonaHR0cHM6Ly93d3cueWVzY29pbi5nb2xkLycsCiAgICAgICdhY2NlcHQtZW5jb2RpbmcnOidnemlwLCBkZWZsYXRlLCBiciwgenN0ZCcsCiAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOid2aS1WTix2aTtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNycsCiAgICAgICdwcmlvcml0eSc6J3U9MSwgaSd9CiAgICBiYWxhbmNlLCB1c2VyTGV2ZWwsIHVzZXJJZCA9IEFjY291bnRJbmZvKGhlYWRlcnMscHJveGllcykKICAgIGNsaWNrX3ZhbHVlLCBtYXhfZW5lcmd5LCBlbmVyZ3ksIHJlY292ZXJ5X2VuZXJneSA9IEdhbWVJbmZvKGhlYWRlcnMsIHByb3hpZXMpCiAgICBzcXVhZE1lbWJlcnMsIHNxdWFkQ29pbiwgc3F1YWRMZXZlbCwgc3F1YWROYW1lLCBzcXVhZFRnTGluayA9IG15U3F1YWQoaGVhZGVycywgcHJveGllcykKICAgIENoZXN0Q291bnQsIFJlY292ZXJ5Q291bnQsIENsaWNrQ29uZmlnLCBSZWNvdmVyeUNvbmZpZywgRW5lcmd5Q29uZmlnLCBCb3RDb25maWcgPSBBY2NvdW50QnVpbGQoaGVhZGVycywgcHJveGllcykKICAgIHByaW50KGYiIiJ7xJHhuq1tfXvEkWVufTw8PDw8PDw8PDw8PDw8PDw8e2xhbX1be3bDoG5nQkd9e8SR4buPfVRIw5RORyBUSU4gVMOASSBLSE/huqJOIFlFU0NPSU57xJFlbkJHfXtsYW19XXvEkWVufT4+Pj4+Pj4+Pj4+Pj4+Pj4+XG57xJFlbn3jgJjwn5Gk44CZe3Ry4bqvbmd9VXNlcklEIHvEkeG7j306IHts4bulY317dXNlcklkfSB7dHLhuq9uZ30oe2jhu5NuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfXt0cuG6r25nfSlcbnvEkWVufeOAmPCfqpnjgJl7dHLhuq9uZ31T4buRIETGsCB7xJHhu499OiB7dsOgbmd9e2JhbGFuY2U6LH1cbnvEkWVufeOAmPCflKLjgJl7dHLhuq9uZ31MZXZlbCB7xJHhu499OiB7bGFtfXt1c2VyTGV2ZWx9IFxue8SRZW5944CY8J+TiuOAmXt0cuG6r25nfVRow7RuZyBz4buRIEdhbWV7xJHhu499OiB7dsOgbmd9K3tjbGlja192YWx1ZX17xJFlbn0ve3bDoG5nfWNsaWNrIHvEkeG7j31be2xhbX17ZW5lcmd5Oix9e8SRZW59L3tsYW19e21heF9lbmVyZ3k6LH17xJHhu499XSB7aOG7k25nfXtCb3RDb25maWdbMV198J+kllxue8SRZW5944CY8J+bluOAmXt0cuG6r25nfVRow7RuZyB0aW4gU3F1YWR7xJHhu499OiB7eGFuaH17c3F1YWROYW1lfSB7xJFlbn18IHt2w6BuZ317c3F1YWRDb2luOix98J+qmSB7xJFlbn18IHts4bulY317c3F1YWRNZW1iZXJzffCfkaVcbnvEkWVufeOAmPCfjI/jgJl7dHLhuq9uZ31JUCB7xJHhu499OiB7bsOidX17aXB9IHts4bulY33Cu8K7wrsge3Ry4bqvbmd9RmFrZSBJUCB7xJHhu499OiB7bGFtfXtmYWtlaXB9CiAgIiIiKQogICAgc3RhcnRfdGltZSA9IGRhdGV0aW1lLm5vdygpCiAgICBwcmludChmInvEkeG7j31cMDMzWzE7MzM7NDBtQuG6rlQgxJDhuqZVIENI4bqgWSBUT09MIHt0aMaw4budbmd9e8SR4bqtbX17xJHhu499wrsge8SRZW59W3t2w6BuZ317c3RhcnRfdGltZS5zdHJmdGltZSgnJUg6JU06JVMnKX17xJFlbn1dXG4iKQogICAgZ2V0TGlzdFRhc2soaGVhZGVycyxwcm94aWVzKQogICAgIiIiCiAgICBzaWduSW5MaXN0ID0gc2lnbkluKGhlYWRlcnMsIHByb3hpZXMpCiAgICBpZiBzaWduSW5MaXN0ICE9ICIiOgogICAgICBmb3Igc2lnbiBpbiBzaWduSW5MaXN0OgogICAgICAgIGlmIHNpZ25bIm9wZW5JbiJdID4gMDoKICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgc2lnblsic3RhdHVzIl0gPT0gMSBhbmQgc2lnblsiZXhwaXJlZCJdID09IDA6CiAgICAgICAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICBoZWFkZXJzWyJ0bSJdID0gc3RyKHRpbWVzdGFtcCkKICAgICAgICAgIGhlYWRlcnNbInNpZ24iXSA9ICI5ZjkwMTIyY2JkOTQ1MjJkNDBmN2U0MDcyNjUxMTBmNyIKICAgICAgICAgIHN0YXR1cywgcmV3YXJkID0gc2lnbkluQ2xhaW0oaGVhZGVycywgeyJpZCI6c2lnblsnaWQnXSwiY3JlYXRlQXQiOnRpbWVzdGFtcCwic2lnbkluVHlwZSI6MSwiZGVzdGluYXRpb24iOiIifSwgcHJveGllcykKICAgICAgICAgIGhlYWRlcnMucG9wKCJ0bSIpCiAgICAgICAgICBoZWFkZXJzLnBvcCgic2lnbiIpCiAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolIikKICAgICAgICAgIGlmIHN0YXR1cyA9PSBUcnVlOgogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9xJDDoyDEkWnhu4NtIGRhbmggaMO0bSBuYXkge3bDoG5nfSt7cmV3YXJkfSIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfcSQw6MgxJFp4buDbSBkYW5oIHRo4bqldCBi4bqhaSIpCiAgICAgICAgICAgIGJyZWFrCiAgICAiIiIKICAgICNwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31Ow4JORyBD4bqkUCBCT09TVCIpCiAgICBkZWYgVVBHUkFERShiYWxhbmNlLCBDbGlja0NvbmZpZyxSZWNvdmVyeUNvbmZpZyxFbmVyZ3lDb25maWcsIEJvdENvbmZpZyk6CiAgICAgIHdoaWxlIGJhbGFuY2UgPiBCb3RDb25maWdbMl0gb3IgYmFsYW5jZSA+IENsaWNrQ29uZmlnWzJdIG9yIGJhbGFuY2UgPiBSZWNvdmVyeUNvbmZpZ1syXSBvciBiYWxhbmNlID4gRW5lcmd5Q29uZmlnWzJdOgogICAgICAgIGRhdGFVcGdyYWRlID0gbGV2ZWwgPSBwcmljZUxldmVsVXAgPSBuYW1lTGV2ZWxVcCA9IE5vbmUKICAgICAgICBpZiBiYWxhbmNlID4gQm90Q29uZmlnWzJdIGFuZCBCb3RDb25maWdbMV0gPCA1IGFuZCBkYXRhVXBncmFkZSA9PSBOb25lOgogICAgICAgICAgbGV2ZWwgPSBCb3RDb25maWdbMV0KICAgICAgICAgIHByaWNlTGV2ZWxVcCA9IEJvdENvbmZpZ1syXQogICAgICAgICAgbmFtZUxldmVsVXAgPSAiWWVzUGFjIgogICAgICAgICAgZGF0YVVwZ3JhZGUgPSA0CiAgICAgICAgaWYgYmFsYW5jZSA+IFJlY292ZXJ5Q29uZmlnWzJdIGFuZCBSZWNvdmVyeUNvbmZpZ1sxXSA8IDEyIGFuZCBkYXRhVXBncmFkZSA9PSBOb25lOgogICAgICAgICAgbGV2ZWwgPSBSZWNvdmVyeUNvbmZpZ1sxXQogICAgICAgICAgcHJpY2VMZXZlbFVwID0gUmVjb3ZlcnlDb25maWdbMl0KICAgICAgICAgIG5hbWVMZXZlbFVwID0gIlJlY292ZXJ5IENvaW4iCiAgICAgICAgICBkYXRhVXBncmFkZSA9IDIKICAgICAgICBpZiBiYWxhbmNlID4gRW5lcmd5Q29uZmlnWzJdIGFuZCBFbmVyZ3lDb25maWdbMV0gPCAxMCBhbmQgZGF0YVVwZ3JhZGUgPT0gTm9uZToKICAgICAgICAgIGxldmVsID0gRW5lcmd5Q29uZmlnWzFdCiAgICAgICAgICBwcmljZUxldmVsVXAgPSBFbmVyZ3lDb25maWdbMl0KICAgICAgICAgIG5hbWVMZXZlbFVwID0gIk1heCBFbmVyZ3kiCiAgICAgICAgICBkYXRhVXBncmFkZSA9IDMKICAgICAgICBpZiBiYWxhbmNlID4gQ2xpY2tDb25maWdbMl0gYW5kIENsaWNrQ29uZmlnWzFdIDw9IDYgYW5kIGRhdGFVcGdyYWRlID09IE5vbmU6CiAgICAgICAgICBsZXZlbCA9IENsaWNrQ29uZmlnWzFdCiAgICAgICAgICBwcmljZUxldmVsVXAgPSBDbGlja0NvbmZpZ1syXQogICAgICAgICAgbmFtZUxldmVsVXAgPSAiQ2xpY2sgVmFsdWUiCiAgICAgICAgICBkYXRhVXBncmFkZSA9IDEKICAgICAgICBpZiBkYXRhVXBncmFkZSA9PSBOb25lOgogICAgICAgICAgYnJlYWsKICAgICAgICBkYXRhID0gbGV2ZWxVcChoZWFkZXJzLCBkYXRhVXBncmFkZSwgcHJveGllcykKICAgICAgICBiYWxhbmNlLCB1c2VyTGV2ZWwsIHVzZXJJZCA9IEFjY291bnRJbmZvKGhlYWRlcnMscHJveGllcykKICAgICAgICBDaGVzdENvdW50LCBSZWNvdmVyeUNvdW50LCBDbGlja0NvbmZpZywgUmVjb3ZlcnlDb25maWcsIEVuZXJneUNvbmZpZywgQm90Q29uZmlnID0gQWNjb3VudEJ1aWxkKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIGlmIGRhdGEgPT0gVHJ1ZToKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ31Ow6JuZyBj4bqlcCB7bOG7pWN9e25hbWVMZXZlbFVwfSB7dHLhuq9uZ30oe2xhbX17bGV2ZWwrMX17dHLhuq9uZ30pIHvEkeG7j30te3ByaWNlTGV2ZWxVcDosfSB7xJFlbn3CuyB7dsOgbmd9e2JhbGFuY2U6LH0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge8SR4buPfU7Dom5nIGPhuqVwIHts4bulY317bmFtZUxldmVsVXB9IHvEkeG7j30gVEjhuqRUIELhuqBJIHvEkWVufcK7IHt2w6BuZ317YmFsYW5jZTosfSIpCiAgICAgIHJldHVybiBiYWxhbmNlLCBDbGlja0NvbmZpZyxSZWNvdmVyeUNvbmZpZyxFbmVyZ3lDb25maWcsIEJvdENvbmZpZwogICAgYmFsYW5jZSwgQ2xpY2tDb25maWcsUmVjb3ZlcnlDb25maWcsRW5lcmd5Q29uZmlnLCBCb3RDb25maWcgPSBVUEdSQURFKGJhbGFuY2UsIENsaWNrQ29uZmlnLFJlY292ZXJ5Q29uZmlnLEVuZXJneUNvbmZpZywgQm90Q29uZmlnKQogICAgI3ByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHvEkeG7j31LSMOUTkcgxJDhu6YgVEnhu4BOIE7Dgk5HIEPhuqRQIikKICAgIGlmIENoZXN0Q291bnQgPiAwOgogICAgICBmb3IgaSBpbiByYW5nZSgwLENoZXN0Q291bnQpOgogICAgICAgIGRhdGEgPSByZWNvdmVyQ2hlc3QoaGVhZGVycywgcHJveGllcykKICAgICAgICBpZiBkYXRhID09IFRydWU6CiAgICAgICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfcSQw6Mga8OtY2ggaG/huqF0IGtobyBiw6F1XG4iKQogICAgICAgICAgQ2hlc3RJbmZvKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgICAgZWxzZToKICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499S8OtY2ggaG/huqF0IGtobyBiw6F1IHRo4bqldCBi4bqhaVxuIikKICAgIGNvbGxlY3RBbW91bnQsIHN0YXR1cyA9IENsYWltT2ZmbGluZShoZWFkZXJzLHByb3hpZXMpCiAgICBpZiBzdGF0dXMgPT0gVHJ1ZToKICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfcSQw6Mge2xhbX1DbGFpbSBPZmZsaW5lIHt2w6BuZ30re2NvbGxlY3RBbW91bnQ6LH1cbiIpCiAgICB3aGlsZSBUcnVlOgogICAgICBDaGVzdEluZm8oaGVhZGVycywgcHJveGllcykKICAgICAgY2xpY2tfdmFsdWUsIG1heF9lbmVyZ3ksIGVuZXJneSwgcmVjb3ZlcnlfZW5lcmd5ID0gR2FtZUluZm8oaGVhZGVycywgcHJveGllcykKICAgICAgaWYgZW5lcmd5L2NsaWNrX3ZhbHVlID4gNTA6CiAgICAgICAgaWYgZW5lcmd5L2NsaWNrX3ZhbHVlID4gMzAwOgogICAgICAgICAgY291bnRDb2xsZWN0ID0gcmFuZG9tLnJhbmRpbnQoMzAwLGludChlbmVyZ3kvY2xpY2tfdmFsdWUpKQogICAgICAgICAgaWYgY291bnRDb2xsZWN0ID4gNTAwOgogICAgICAgICAgICBjb3VudENvbGxlY3QgPSByYW5kb20ucmFuZGludCgzMDAsNTAwKQogICAgICAgIGVsc2U6CiAgICAgICAgICBjb3VudENvbGxlY3QgPSBpbnQoZW5lcmd5L2NsaWNrX3ZhbHVlKQogICAgICAgIGNvdW50Q29sbGVjdCA9IGludChlbmVyZ3kvY2xpY2tfdmFsdWUpCiAgICAgICAgY29sbGVjdEFtb3VudCwgY29sbGVjdFN0YXR1cyA9IENvbGxlY3QoaGVhZGVycywgY291bnRDb2xsZWN0LCBwcm94aWVzKQogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBpZiBjb2xsZWN0U3RhdHVzID09IFRydWU6CiAgICAgICAgICBwcmludChmInvEkWVufeKVlOKVkHvEkeG7j31be3bDoG5nfXtub3dfdGltZX17xJHhu499XSB7dHLhuq9uZ33EkMOjIENsaWNrIHt2w6BuZ317Y291bnRDb2xsZWN0fSB7dHLhuq9uZ31s4bqnbiB7dsOgbmd9K3tjb2xsZWN0QW1vdW50Oix98J+qmSB7xJHhu499wrsiLCBlbmQ9IiAiKQogICAgICAgICAgYmFsYW5jZSwgdXNlckxldmVsLCB1c2VySWQgPSBBY2NvdW50SW5mbyhoZWFkZXJzLHByb3hpZXMpCiAgICAgICAgICBwcmludChmIvCfqpl7dsOgbmd9e2JhbGFuY2U6LH1cbnvEkWVufeKVmuKruHto4buTbmd9TGluayB0b29sICYgaMaw4bubbmcgZOG6q24gdOG6oWkgVGVsZWdyYW17xJHhu499OiB7bOG7pWN9QEFpcmRyb3BUb29sQ2hhbm5lbFxuIikKICAgICAgICBlbHNlOgogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j30gQ2xpY2sgbmjhuq1uIGNvaW4gdGjhuqV0IGLhuqFpXG4iKQogICAgICBDaGVzdENvdW50LCBSZWNvdmVyeUNvdW50LCBDbGlja0NvbmZpZywgUmVjb3ZlcnlDb25maWcsIEVuZXJneUNvbmZpZywgQm90Q29uZmlnID0gQWNjb3VudEJ1aWxkKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgIGNsaWNrX3ZhbHVlLCBtYXhfZW5lcmd5LCBlbmVyZ3ksIHJlY292ZXJ5X2VuZXJneSA9IEdhbWVJbmZvKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgIGlmIFJlY292ZXJ5Q291bnQgPiAwIGFuZCBlbmVyZ3kvY2xpY2tfdmFsdWUgPCA1MDoKICAgICAgICBkYXRhID0gcmVjb3ZlckNvaW5Qb29sKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgICAgaWYgZGF0YSA9PSBUcnVlOgogICAgICAgICAgY2xpY2tfdmFsdWUsIG1heF9lbmVyZ3ksIGVuZXJneSwgcmVjb3ZlcnlfZW5lcmd5ID0gR2FtZUluZm8oaGVhZGVycywgcHJveGllcykKICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9xJDDoyBraMO0aSBwaOG7pWMgbOG6oWkgQ29pbiBQb29sIHvEkeG7j33CuyB7dsOgbmd9e2VuZXJneX17xJFlbn0ve3bDoG5nfXttYXhfZW5lcmd5fVxuIikKICAgICAgICBlbHNlOgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31LaMO0aSBwaOG7pWMgQ29pbiBQb29sIFRI4bqkVCBC4bqgSVxuIikKICAgICAgZWxpZiBlbmVyZ3kvY2xpY2tfdmFsdWUgPCA1MCBhbmQgUmVjb3ZlcnlDb3VudCA9PSAwOgogICAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHt0cuG6r25nfUjhur5UIEzGr+G7olQgQ0xJQ0ssIEjhur5UIEJPT1RFUlMge8SR4buPfcK7IHt2w6BuZ33EkOG7lEkgVMOASSBLSE/huqJOIHts4bulY317Q2hlc3RDb3VudH0ge1JlY292ZXJ5Q291bnR9XG4iKQogICAgICAgIGJyZWFrClJVTl9ZRVNDT0lOKCk="