api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICIyLjAuMCIKbmFtZV90b29sID0gImN5YmVyX2ZpbmFuY2UiCkJBTk5FUihuYW1lX3Rvb2wsIHZlcnNpb24pCnByaW50KGYiIiIKe8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHtsYW19Q8OBQyBDSOG7qEMgTsSCTkcgQ+G7pkEgVE9PTAp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBjbGFpbQp7xJHhu499W3t2w6BuZ30re8SR4buPfV0ge3Ry4bqvbmd9QXV0byBuaGnhu4dtIHbhu6UKe8SR4buPfVt7dsOgbmd9K3vEkeG7j31dIHt0cuG6r25nfUF1dG8gbsOibmcgY+G6pXAgaGFtbWVyCiIiIikKZGVmIExPR0lOKGhlYWRlcnMsIGRhdGEsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIGhlYWRlcnNbImNvbnRlbnQtbGVuZ3RoIl0gPSBzdHIobGVuKHN0cihkYXRhKS5yZXBsYWNlKCIgIiwiIikpKQogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS5jeWJlcmZpbi54eXovYXBpL3YxL2dhbWUvaW5pdGRhdGEiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9nYW1lL2luaXRkYXRhIixoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIHRva2VuID0gcmVzcG9uc2UuanNvbigpWyJtZXNzYWdlIl1bImFjY2Vzc1Rva2VuIl0KICAgICAgaGVhZGVycy5wb3AoImNvbnRlbnQtbGVuZ3RoIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIGN5YmVyX2ZpbmFuY2UiKQogICAgICBSVU1fQ1lCRVJfRklOQU5DRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIHRva2VuCmRlZiBNSU5JTkcoaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9nYW1lL21pbmluZy9nYW1lZGF0YSIsIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KCJodHRwczovL2FwaS5jeWJlcmZpbi54eXovYXBpL3YxL2dhbWUvbWluaW5nL2dhbWVkYXRhIixoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJtZXNzYWdlIl0KICAgICAgc3RhcnRUaW1lID0gZ2V0ZGF0YVsibWluaW5nRGF0YSJdWyJsYXN0Q2xhaW1UaW1lIl0KICAgICAgY3JhY2tUaW1lID0gZ2V0ZGF0YVsibWluaW5nRGF0YSJdWyJjcmFja1RpbWUiXQogICAgICBiYWxhbmNlID0gZ2V0ZGF0YVsidXNlckRhdGEiXVsiYmFsYW5jZSJdCiAgICAgIHRpdGxlU3F1YWQgPSBnZXRkYXRhWyJzcXVhZERhdGEiXVsidXNlcm5hbWUiXQogICAgICBiYWxhbmNlU3F1YWQgPSBnZXRkYXRhWyJzcXVhZERhdGEiXVsic3RhdGlzdGljIl1bInVzZXJzQmFsYW5jZSJdCiAgICAgIG1lbWJlcnMgPSBnZXRkYXRhWyJzcXVhZERhdGEiXVsic3RhdGlzdGljIl1bInVzZXJDb3VudCJdCiAgICAgIHJhbmtTcXVhZCA9IGdldGRhdGFbInNxdWFkRGF0YSJdWyJzdGF0aXN0aWMiXVsicmFua0J5QmFsYW5jZSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBjeWJlcl9maW5hbmNlIikKICAgICAgUlVNX0NZQkVSX0ZJTkFOQ0UoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBzdGFydFRpbWUsIGNyYWNrVGltZSwgYmFsYW5jZSx0aXRsZVNxdWFkICxiYWxhbmNlU3F1YWQsIG1lbWJlcnMsIHJhbmtTcXVhZApkZWYgTUlOSU5HX0NMQUlNKGhlYWRlcnMsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmN5YmVyZmluLnh5ei9hcGkvdjEvbWluaW5nL2NsYWltIiwgaGVhZGVycz1oZWFkZXJzLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmN5YmVyZmluLnh5ei9hcGkvdjEvbWluaW5nL2NsYWltIixoZWFkZXJzPWhlYWRlcnMsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBnZXRkYXRhID0gcmVzcG9uc2UuanNvbigpWyJtZXNzYWdlIl0KICAgICAgc3RhcnRUaW1lID0gZ2V0ZGF0YVsibWluaW5nRGF0YSJdWyJsYXN0Q2xhaW1UaW1lIl0KICAgICAgY3JhY2tUaW1lID0gZ2V0ZGF0YVsibWluaW5nRGF0YSJdWyJjcmFja1RpbWUiXQogICAgICBiYWxhbmNlID0gZ2V0ZGF0YVsidXNlckRhdGEiXVsiYmFsYW5jZSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBjeWJlcl9maW5hbmNlIikKICAgICAgUlVNX0NZQkVSX0ZJTkFOQ0UoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBzdGFydFRpbWUsIGNyYWNrVGltZSwgYmFsYW5jZQpkZWYgR0VUX1RBU0soaGVhZGVycywgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9nYW1ldGFzay9hbGwiLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9nYW1ldGFzay9hbGwiLGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGxpc3RUYXNrID0gcmVzcG9uc2UuanNvbigpWyJtZXNzYWdlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIGN5YmVyX2ZpbmFuY2UiKQogICAgICBSVU1fQ1lCRVJfRklOQU5DRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGxpc3RUYXNrCmRlZiBDT01QTEVURV9UQVNLKGhlYWRlcnMsIGlkX1Rhc2ssIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wYXRjaCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9nYW1ldGFzay9jb21wbGV0ZS8iK2lkX1Rhc2ssIGhlYWRlcnM9aGVhZGVycywgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucGF0Y2goImh0dHBzOi8vYXBpLmN5YmVyZmluLnh5ei9hcGkvdjEvZ2FtZXRhc2svY29tcGxldGUvIitpZF9UYXNrLGhlYWRlcnM9aGVhZGVycywgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGdldGRhdGEgPSByZXNwb25zZS5qc29uKClbIm1lc3NhZ2UiXQogICAgICBpc0NvbXBsZXRlZCA9IGdldGRhdGFbImlzQ29tcGxldGVkIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIGN5YmVyX2ZpbmFuY2UiKQogICAgICBSVU1fQ1lCRVJfRklOQU5DRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGlzQ29tcGxldGVkCmRlZiBCT09TVF9JTkZPKGhlYWRlcnMsIHByb3hpZXM9Tm9uZSk6CiAgZXJyb3JfY291bnQgPSAwCiAgbWF4X3JldHJpZXMgPSAxMAogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoImh0dHBzOi8vYXBpLmN5YmVyZmluLnh5ei9hcGkvdjEvbWluaW5nL2Jvb3N0L2luZm8iLCBoZWFkZXJzPWhlYWRlcnMsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9taW5pbmcvYm9vc3QvaW5mbyIsaGVhZGVycz1oZWFkZXJzLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsibWVzc2FnZSJdCiAgICAgIGhhbW1lckxldmVsID0gZ2V0ZGF0YVsiaGFtbWVyTGV2ZWwiXQogICAgICBoYW1tZXJQcmljZSA9IGdldGRhdGFbImhhbW1lclByaWNlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdDoKICAgICAgZXJyb3JfY291bnQgPSBoYW5kbGVFcnJvcnMoZXJyb3JfY291bnQsIG1heF9yZXRyaWVzKQogICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBs4bqhaSB0b29sIGN5YmVyX2ZpbmFuY2UiKQogICAgICBSVU1fQ1lCRVJfRklOQU5DRSgpCiAgICAgIGJyZWFrCiAgICBDT1VOVERPV04oMTApCiAgcmV0dXJuIGhhbW1lckxldmVsLCBoYW1tZXJQcmljZQpkZWYgQk9PU1RfQVBQTFkoaGVhZGVycywgZGF0YSwgcHJveGllcz1Ob25lKToKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgZGF0YSA9IHsiYm9vc3RUeXBlIjoiSEFNTUVSIn0KICBoZWFkZXJzWyJjb250ZW50LWxlbmd0aCJdID0gc3RyKGxlbihzdHIoZGF0YSkucmVwbGFjZSgiICIsIiIpKSkKICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9taW5pbmcvYm9vc3QvYXBwbHkiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGkuY3liZXJmaW4ueHl6L2FwaS92MS9taW5pbmcvYm9vc3QvYXBwbHkiLGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZ2V0ZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsibWVzc2FnZSJdCiAgICAgIGhlYWRlcnMucG9wKCJjb250ZW50LWxlbmd0aCIpCiAgICAgIGJhbGFuY2UgPSBnZXRkYXRhWyJ1c2VyRGF0YSJdWyJiYWxhbmNlIl0KICAgICAgaGFtbWVyTGV2ZWwgPSBnZXRkYXRhWyJib29zdERhdGEiXVsiaGFtbWVyTGV2ZWwiXQogICAgICBoYW1tZXJQcmljZSA9IGdldGRhdGFbImJvb3N0RGF0YSJdWyJoYW1tZXJQcmljZSJdCiAgICAgIG1pbmluZ1JhdGUgPSBnZXRkYXRhWyJib29zdERhdGEiXVsibWluaW5nUmF0ZSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQ6CiAgICAgIGVycm9yX2NvdW50ID0gaGFuZGxlRXJyb3JzKGVycm9yX2NvdW50LCBtYXhfcmV0cmllcykKICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7dHLhuq9uZ33EkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgbOG6oWkgdG9vbCBjeWJlcl9maW5hbmNlIikKICAgICAgUlVNX0NZQkVSX0ZJTkFOQ0UoKQogICAgICBicmVhawogICAgQ09VTlRET1dOKDEwKQogIHJldHVybiBiYWxhbmNlLCBoYW1tZXJMZXZlbCwgaGFtbWVyUHJpY2UsIG1pbmluZ1JhdGUKCmRlZiBSVU1fQ1lCRVJfRklOQU5DRSgpOgogIHdpdGggb3BlbignY29uZmlnL2N5YmVyX2ZpbmFuY2UuanNvbicsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZmlsZToKICAgIGNvbmZpZ19kYXRhID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKQogIHVzZXJzID0gY29uZmlnX2RhdGEKICBpZiBsZW4odXNlcnMpID4gMTA6CiAgICBwcmludCgiQuG6oW4gY2jhu4kgxJHGsOG7o2MgcGjDqXAgdGjDqm0gdOG7kWkgxJFhIDEwIHTDoGkga2hv4bqjbiDEkeG7gyBjaOG6oXkgdG9vbCIpCiAgICBleGl0KCkKICBmb3IgdXNlciBpbiB1c2VyczoKICAgIGFjY291bnQgPSB1c2VyWyJTVFRfQUNDT1VOVCJdCiAgICBkYXRhID0gdXNlclsiREFUQSJdCiAgICBpZiBkYXRhID09ICIiIG9yIGRhdGEgPT0gInRoYXlfdGjhur9fYuG6sW5nX2RhdGEiOgogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499VMOgaSBraG/huqNuIHt2w6BuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfSB7xJHhu499REFUQSDEkWFuZyBi4buLIHRy4buRbmciKQogICAgICBjb250aW51ZQogICAgd2l0aCBvcGVuKCdjb25maWcvc2V0dGluZy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmaWxlOgogICAgICBjb25maWdfYWNjID0ganNvbi5sb2FkcyhyZW1vdmVfY29tbWVudHMoZmlsZS5yZWFkKCkpKVthY2NvdW50XQogICAgcHJveHlfbGlzdCA9IGNvbmZpZ19hY2NbInByb3h5Il0KICAgIHR5cGVfcHJveHkgPSBjb25maWdfYWNjWyJ0eXBlX3Byb3h5Il0KICAgIHVzZXJfYWdlbnQgPSBjb25maWdfYWNjWyJ1c2VyLWFnZW50Il0KICAgIGlmIHByb3h5X2xpc3QgIT0gIiI6CiAgICAgIHByb3h5X2xpc3QgPSBwcm94eV9saXN0LnNwbGl0KCI6IikKICAgICAgcHJveHkgPSBmInt0eXBlX3Byb3h5fTovL3twcm94eV9saXN0WzJdfTp7cHJveHlfbGlzdFszXX1Ae3Byb3h5X2xpc3RbMF19Ontwcm94eV9saXN0WzFdfSIKICAgICAgcHJveGllcyA9IHsKICAgICAgJ2h0dHAnOiBwcm94eSwKICAgICAgJ2h0dHBzJzogcHJveHksfQogICAgZWxzZToKICAgICAgaWYgYWNjb3VudC5zcGxpdCgnXycpWzFdICE9ICIxIjoKICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ31DaHV54buDbiB0w6BpIGtob+G6o24gZG8ga2jDtG5nIGPDsyBwcm94eSIpCiAgICAgICAgY29udGludWUKICAgICAgcHJveGllcyA9ICIiCiAgICBpcCwgZmFrZWlwID0gZ2V0SVAocHJveGllcykKICAgIGlmIGlwID09IGZha2VpcCA9PSBOb25lOgogICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499XG7EkOG7lEkgVMOASSBLSE/huqJOIERPIEtIw5RORyBM4bqkWSDEkMav4buiQyBJUCwgSMODWSBLSeG7gk0gVFJBIEzhuqBJIFBST1hZXG4iKQogICAgICBjb250aW51ZQogICAgaGVhZGVycyA9IHsKICAgICAgIkhvc3QiOiAiYXBpLmN5YmVyZmluLnh5eiIsCiAgICAgICJzZWMtY2gtdWEiOiAnIk5vdC9BKUJyYW5kIjt2PSI4IiwgIkNocm9taXVtIjt2PSIxMjYiLCAiQW5kcm9pZCBXZWJWaWV3Ijt2PSIxMjYiJywKICAgICAgImFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgInNlYy1jaC11YS1tb2JpbGUiOiAiPzEiLAogICAgICAidXNlci1hZ2VudCI6IHVzZXJfYWdlbnQsCiAgICAgICJzZWMtY2gtdWEtcGxhdGZvcm0iOiAnIkFuZHJvaWQiJywKICAgICAgIm9yaWdpbiI6ICJodHRwczovL2cuY3liZXJmaW4ueHl6IiwKICAgICAgIngtcmVxdWVzdGVkLXdpdGgiOiAibWFyay52aWEuZ3EiLAogICAgICAic2VjLWZldGNoLXNpdGUiOiAic2FtZS1zaXRlIiwKICAgICAgInNlYy1mZXRjaC1tb2RlIjogImNvcnMiLAogICAgICAic2VjLWZldGNoLWRlc3QiOiAiZW1wdHkiLAogICAgICAicmVmZXJlciI6ICJodHRwczovL2cuY3liZXJmaW4ueHl6LyIsCiAgICAgICJhY2NlcHQtZW5jb2RpbmciOiAiZ3ppcCwgZGVmbGF0ZSwgYnIsIHpzdGQiLAogICAgICAiYWNjZXB0LWxhbmd1YWdlIjogInZpLVZOLHZpO3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43IiwKICAgICAgInByaW9yaXR5IjogInU9MSwgaSJ9CiAgICB0b2tlbiA9IExPR0lOKGhlYWRlcnMsIGRhdGEsIHByb3hpZXMpCiAgICB0b3RhbF9hY2MgPSBsZW4odXNlcnMpCiAgICBzdHRfYWNjID0gYWNjb3VudC5zcGxpdCgiXyIpWzFdCiAgICBoZWFkZXJzWyJBdXRob3JpemF0aW9uIl0gPSAiQmVhcmVyICIrdG9rZW4KICAgIHN0YXJ0VGltZSwgY3JhY2tUaW1lLCBiYWxhbmNlLHRpdGxlU3F1YWQgLGJhbGFuY2VTcXVhZCwgbWVtYmVycywgcmFua1NxdWFkID0gTUlOSU5HKGhlYWRlcnMsIHByb3hpZXMpCiAgICBwcmludChmIiIie8SR4bqtbX17xJFlbn08PDw8PDw8PDw8PDw8PHtsYW19W3t2w6BuZ0JHfXvEkeG7j31USMOUTkcgVElOIFTDgEkgS0hP4bqiTiBDWUJFUiBGSU5BTkNFe8SRZW5CR317bGFtfV17xJFlbn0+Pj4+Pj4+Pj4+Pj4+Plxue8SRZW5944CY8J+RpOOAmXt0cuG6r25nfVTDoGkga2hv4bqjbnvEkeG7j306IHt0cuG6r25nfSh7aOG7k25nfXthY2NvdW50LnNwbGl0KCdfJylbMV19e3Ry4bqvbmd9KVxue8SRZW5944CY8J+qmeOAmXt0cuG6r25nfVPhu5EgRMawIHvEkeG7j306IHt2w6BuZ317aW50KGZsb2F0KGJhbGFuY2UpKTosffCfqplcbnvEkWVufeOAmPCfk4rjgJl7dHLhuq9uZ31UaMO0bmcgdGluIFNxdWFke8SR4buPfToge3hhbmh9e3RpdGxlU3F1YWR9e8SRZW59fHts4bulY317aW50KGJhbGFuY2VTcXVhZCk6LH3wn6qZe8SRZW59fHt2w6BuZ317bWVtYmVyczosffCfkaV7xJFlbn18e3Ry4bqvbmd9e2ludChyYW5rU3F1YWQpOix98J+PhVxue8SRZW5944CY8J+Mj+OAmXt0cuG6r25nfUlQIHvEkeG7j306IHtuw6J1fXtpcH0ge2zhu6VjfcK7wrvCuyB7dHLhuq9uZ31GYWtlIElQIHvEkeG7j306IHtsYW19e2Zha2VpcH1cbiIiIikKICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgcHJpbnQoZiJ7xJHhu499XDAzM1sxOzMzOzQwbULhuq5UIMSQ4bqmVSBDSOG6oFkgVE9PTCB7dGjGsOG7nW5nfXvEkeG6rW19e8SR4buPfcK7IHvEkWVufVt7dsOgbmd9e3N0YXJ0X3RpbWUuc3RyZnRpbWUoJyVIOiVNOiVTJyl9e8SRZW59XVxuIikKICAgIGlmIGludCh0aW1lLnRpbWUoKSkgPiBjcmFja1RpbWU6CiAgICAgIHN0YXJ0VGltZSwgY3JhY2tUaW1lLCBuZXdiYWxhbmNlID0gTUlOSU5HX0NMQUlNKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgaWYgbmV3YmFsYW5jZSA+IGJhbGFuY2U6CiAgICAgICAgY291bnRDb2xsZWN0ID0gaW50KG5ld2JhbGFuY2UpIC0gaW50KGZsb2F0KGJhbGFuY2UpKQogICAgICAgIGJhbGFuY2UgPSBuZXdiYWxhbmNlCiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfcSQw6Mge2xhbX1DTEFJTSB7dHLhuq9uZ310aMOgbmggY8O0bmcge3bDoG5nfSt7Y291bnRDb2xsZWN0fSB7xJFlbn3CuyB7dsOgbmd9e2ludChmbG9hdChiYWxhbmNlKSk6LH0iKQogICAgICBlbHNlOgogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499xJDDoyB7bGFtfUNMQUlNIHvEkeG7j310aOG6pXQgYuG6oWkge8SRZW59wrsge3bDoG5nfXtpbnQoZmxvYXQoYmFsYW5jZSkpOix9IikKICAgIGVsc2U6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfUNoxrBhIMSR4bq/biB0aOG7nWkgZ2lhbiB7bGFtfUNMQUlNIHvEkWVufcK7IHt2w6BuZ317aW50KGZsb2F0KGJhbGFuY2UpKTosfSIpCiAgICBsaXN0VGFzayA9IEdFVF9UQVNLKGhlYWRlcnMsIHByb3hpZXMpCiAgICBmb3IgdGFzayBpbiBsaXN0VGFzazoKICAgICAgaWRfVGFzayA9IHRhc2tbInV1aWQiXQogICAgICB0aXRsZV9UYXNrID0gdGFza1sidGl0bGUiXQogICAgICByZXdhcmRfVGFzayA9IHRhc2tbInBvaW50c1Jld2FyZCJdCiAgICAgIGlmIHRhc2tbImlzQ29tcGxldGVkIl0gPT0gRmFsc2UgYW5kIHRhc2tbImlzQWN0aXZlIl0gPT0gVHJ1ZSBhbmQgdGFza1sidHlwZSJdID09ICJGT0xMT1dfTElOSyI6CiAgICAgICAgaXNDb21wbGV0ZWQgPSBDT01QTEVURV9UQVNLKGhlYWRlcnMsIGlkX1Rhc2ssIHByb3hpZXMpCiAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgIGlmIGlzQ29tcGxldGVkID09IFRydWU6CiAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9SG/DoG4gdGjDoG5oIHtsYW19e3RpdGxlX1Rhc2t9IHt2w6BuZ30re3Jld2FyZF9UYXNrOix9IikKICAgICAgICBlbHNlOgogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHvEkeG7j31Ib8OgbiB0aMOgbmgge2xhbX17dGl0bGVfVGFza30ge8SR4buPfXRo4bqldCBi4bqhaSIpCiAgICBoYW1tZXJMZXZlbCwgaGFtbWVyUHJpY2UgPSBCT09TVF9JTkZPKGhlYWRlcnMsIHByb3hpZXMpCiAgICB3aGlsZSBpbnQoZmxvYXQoYmFsYW5jZSkpID4gaGFtbWVyUHJpY2U6CiAgICAgIGJhbGFuY2UsIG5ld2hhbW1lckxldmVsLCBoYW1tZXJQcmljZSwgbWluaW5nUmF0ZSA9IEJPT1NUX0FQUExZKGhlYWRlcnMsIHByb3hpZXMpCiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgaWYgbmV3aGFtbWVyTGV2ZWwgPiBoYW1tZXJMZXZlbDoKICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge3Ry4bqvbmd9TsOibmcgY+G6pXAge2zhu6VjfUhBTU1FUiB7dHLhuq9uZ30oe2xhbX17bmV3aGFtbWVyTGV2ZWx9e3Ry4bqvbmd9KSB7xJHhu499LXtoYW1tZXJQcmljZTosfSB7xJFlbn3in6nin6kge3bDoG5nfSt7aW50KGZsb2F0KG1pbmluZ1JhdGUpKjM2MDApOix9e8SRZW59L3t2w6BuZ31oIHvEkWVufcK7IHt2w6BuZ317aW50KGZsb2F0KGJhbGFuY2UpKTosfSIpCiAgICAgICAgaGFtbWVyTGV2ZWwgPSBuZXdoYW1tZXJMZXZlbAogICAgICBlbHNlOgogICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499TsOibmcgY+G6pXAge2zhu6VjfUhBTU1FUiB7xJHhu499dGjhuqV0IGLhuqFpIHvEkWVufcK7IHt2w6BuZ317aW50KGZsb2F0KGJhbGFuY2UpKTosfSIpCiAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ33EkOG7lEkgVMOASSBLSE/huqJOXG4iKQpSVU1fQ1lCRVJfRklOQU5DRSgp"