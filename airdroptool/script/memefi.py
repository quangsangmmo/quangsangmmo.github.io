api_key = "aW1wb3J0IHJlcXVlc3RzLCB0aW1lCmltcG9ydCBqc29uLCByYW5kb20sIHN0cmluZywgb3MKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUsIHRpbWV6b25lCmZyb20gdGVybWNvbG9yIGltcG9ydCBjb2xvcmVkCmZyb20gZnVuY3Rpb24gaW1wb3J0ICoKdmVyc2lvbiA9ICI2LjAuMCIKbmFtZV90b29sID0gIm1lbWVmaSIKQkFOTkVSKG5hbWVfdG9vbCwgdmVyc2lvbikKCmRlZiB0ZWxlZ3JhbVVzZXJNZShoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBkYXRhID0geyJvcGVyYXRpb25OYW1lIjoiUXVlcnlUZWxlZ3JhbVVzZXJNZSIsInZhcmlhYmxlcyI6e30sInF1ZXJ5IjoicXVlcnkgUXVlcnlUZWxlZ3JhbVVzZXJNZSB7XG4gIHRlbGVncmFtVXNlck1lIHtcbiAgICBmaXJzdE5hbWVcbiAgICBsYXN0TmFtZVxuICAgIHRlbGVncmFtSWRcbiAgICB1c2VybmFtZVxuICAgIHJlZmVycmFsQ29kZVxuICAgIGlzRGFpbHlSZXdhcmRDbGFpbWVkXG4gICAgcmVmZXJyYWwge1xuICAgICAgdXNlcm5hbWVcbiAgICAgIGxhc3ROYW1lXG4gICAgICBmaXJzdE5hbWVcbiAgICAgIGJvc3NMZXZlbFxuICAgICAgY29pbnNBbW91bnRcbiAgICAgIF9fdHlwZW5hbWVcbiAgICB9XG4gICAgaXNSZWZlcnJhbEluaXRpYWxKb2luQm9udXNBdmFpbGFibGVcbiAgICBsZWFndWVcbiAgICBsZWFndWVJc092ZXJUb3AxMGtcbiAgICBsZWFndWVQb3NpdGlvblxuICAgIF9pZFxuICAgIG9wZW5zIHtcbiAgICAgIGlzQXZhaWxhYmxlXG4gICAgICBvcGVuVHlwZVxuICAgICAgX190eXBlbmFtZVxuICAgIH1cbiAgICBmZWF0dXJlc1xuICAgIF9fdHlwZW5hbWVcbiAgfVxufSJ9CiAgd2hpbGUgVHJ1ZToKICAgIHRyeToKICAgICAgaWYgcHJveGllczoKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWd3LXRnLm1lbWVmaS5jbHViL2dyYXBocWwiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgcHJveGllcz1wcm94aWVzLCB0aW1lb3V0PTMwKQogICAgICBlbHNlOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktZ3ctdGcubWVtZWZpLmNsdWIvZ3JhcGhxbCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCB0aW1lb3V0PTMwKQogICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKVsiZGF0YSJdWyJ0ZWxlZ3JhbVVzZXJNZSJdCiAgICAgIHVzZXJuYW1lID0gZGF0YVsidXNlcm5hbWUiXQogICAgICAjcHJpbnQodXNlcm5hbWUpCiAgICAgIGJyZWFrCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KHJlc3BvbnNlLnRleHQpCiAgICAgIHByaW50KGYiSMOgbSB0ZWxlZ3JhbVVzZXJNZSwgxJFhbmcgeOG6o3kgcmEgbOG7l2kuIFRo4butIGzhuqFpIGzhuqduIHtlcnJvcl9jb3VudH0ve21heF9yZXRyaWVzfSIpCiAgICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICAgIHByaW50KCLEkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgaMOgbSBSVU5fTUVNRUZJKGFjY19tYXgpIikKICAgICAgICBSVU5fTUVNRUZJKGFjY19tYXgpCiAgICAgICAgYnJlYWsKICAgICAgQ09VTlRET1dOKDEwKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgIHByaW50KGYiSMOgbSB0ZWxlZ3JhbVVzZXJNZSwgRXJyb3IgZGVjb2RpbmcgSlNPTiByZXNwb25zZSIpCiAgICAgIGJyZWFrCiAgICBleGNlcHQgS2V5RXJyb3IgYXMgZToKICAgICAgcHJpbnQoZiJIw6BtIHRlbGVncmFtVXNlck1lLCBLZXkgZXJyb3I6IHtlfSIpCiAgICAgIGJyZWFrCiAgcmV0dXJuIHVzZXJuYW1lCmRlZiBHQU1FX0NPTkZJRyhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBkYXRhID0geyJvcGVyYXRpb25OYW1lIjoiUVVFUllfR0FNRV9DT05GSUciLCJ2YXJpYWJsZXMiOnt9LCJxdWVyeSI6InF1ZXJ5IFFVRVJZX0dBTUVfQ09ORklHIHtcbiAgdGVsZWdyYW1HYW1lR2V0Q29uZmlnIHtcbiAgICAuLi5GcmFnbWVudEJvc3NGaWdodENvbmZpZ1xuICAgIF9fdHlwZW5hbWVcbiAgfVxufVxuXG5mcmFnbWVudCBGcmFnbWVudEJvc3NGaWdodENvbmZpZyBvbiBUZWxlZ3JhbUdhbWVDb25maWdPdXRwdXQge1xuICBfaWRcbiAgY29pbnNBbW91bnRcbiAgY3VycmVudEVuZXJneVxuICBtYXhFbmVyZ3lcbiAgd2VhcG9uTGV2ZWxcbiAgZW5lcmd5TGltaXRMZXZlbFxuICBlbmVyZ3lSZWNoYXJnZUxldmVsXG4gIHRhcEJvdExldmVsXG4gIGN1cnJlbnRCb3NzIHtcbiAgICBfaWRcbiAgICBsZXZlbFxuICAgIGN1cnJlbnRIZWFsdGhcbiAgICBtYXhIZWFsdGhcbiAgICBfX3R5cGVuYW1lXG4gIH1cbiAgZnJlZUJvb3N0cyB7XG4gICAgX2lkXG4gICAgY3VycmVudFR1cmJvQW1vdW50XG4gICAgbWF4VHVyYm9BbW91bnRcbiAgICB0dXJib0xhc3RBY3RpdmF0ZWRBdFxuICAgIHR1cmJvQW1vdW50TGFzdFJlY2hhcmdlRGF0ZVxuICAgIGN1cnJlbnRSZWZpbGxFbmVyZ3lBbW91bnRcbiAgICBtYXhSZWZpbGxFbmVyZ3lBbW91bnRcbiAgICByZWZpbGxFbmVyZ3lMYXN0QWN0aXZhdGVkQXRcbiAgICByZWZpbGxFbmVyZ3lBbW91bnRMYXN0UmVjaGFyZ2VEYXRlXG4gICAgX190eXBlbmFtZVxuICB9XG4gIGJvbnVzTGVhZGVyRGFtYWdlRW5kQXRcbiAgYm9udXNMZWFkZXJEYW1hZ2VTdGFydEF0XG4gIGJvbnVzTGVhZGVyRGFtYWdlTXVsdGlwbGllclxuICBub25jZVxuICBfX3R5cGVuYW1lXG59In0KICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktZ3ctdGcubWVtZWZpLmNsdWIvZ3JhcGhxbCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1ndy10Zy5tZW1lZmkuY2x1Yi9ncmFwaHFsIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl1bInRlbGVncmFtR2FtZUdldENvbmZpZyJdCiAgICAgIGJhbGFuY2UgPSBkYXRhWyJjb2luc0Ftb3VudCJdCiAgICAgIEVuZXJneSA9IGRhdGFbImN1cnJlbnRFbmVyZ3kiXQogICAgICBtYXhFbmVyZ3kgPSBkYXRhWyJtYXhFbmVyZ3kiXQogICAgICBkYW1lID0gZGF0YVsid2VhcG9uTGV2ZWwiXSArIDEKICAgICAgbGV2ZWxCb3NzID0gZGF0YVsiY3VycmVudEJvc3MiXVsibGV2ZWwiXQogICAgICBIZWFsdGhCb3NzID0gZGF0YVsiY3VycmVudEJvc3MiXVsiY3VycmVudEhlYWx0aCJdCiAgICAgIG1heEhlYWx0aEJvc3MgPSBkYXRhWyJjdXJyZW50Qm9zcyJdWyJtYXhIZWFsdGgiXQogICAgICBUdXJib0Ftb3VudCA9IGRhdGFbImZyZWVCb29zdHMiXVsiY3VycmVudFR1cmJvQW1vdW50Il0KICAgICAgUmVjb3ZlcnlBbW91bnQgPSBkYXRhWyJmcmVlQm9vc3RzIl1bImN1cnJlbnRSZWZpbGxFbmVyZ3lBbW91bnQiXQogICAgICBub25jZSA9IGRhdGFbIm5vbmNlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgIGVycm9yX2NvdW50ICs9IDEKICAgICAgcHJpbnQocmVzcG9uc2UudGV4dCkKICAgICAgcHJpbnQoZiJIw6BtIEdBTUVfQ09ORklHLCDEkWFuZyB44bqjeSByYSBs4buXaS4gVGjhu60gbOG6oWkgbOG6p24ge2Vycm9yX2NvdW50fS97bWF4X3JldHJpZXN9IikKICAgICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgICAgcHJpbnQoIsSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBow6BtIFJVTl9NRU1FRkkoYWNjX21heCkiKQogICAgICAgIFJVTl9NRU1FRkkoYWNjX21heCkKICAgICAgICBicmVhawogICAgICBDT1VOVERPV04oMTApCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgcHJpbnQoZiJIw6BtIEdBTUVfQ09ORklHLCBFcnJvciBkZWNvZGluZyBKU09OIHJlc3BvbnNlIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdCBLZXlFcnJvciBhcyBlOgogICAgICBwcmludChmIkjDoG0gR0FNRV9DT05GSUcsIEtleSBlcnJvcjoge2V9IikKICAgICAgYnJlYWsKICByZXR1cm4gYmFsYW5jZSwgRW5lcmd5LCBtYXhFbmVyZ3ksIGRhbWUsIGxldmVsQm9zcywgSGVhbHRoQm9zcywgbWF4SGVhbHRoQm9zcywgVHVyYm9BbW91bnQsIFJlY292ZXJ5QW1vdW50LCBub25jZQpoZWFkZXJzID0gewogICJIb3N0IjoiYXBpLWd3LXRnLm1lbWVmaS5jbHViIiwKICAiY29udGVudC1sZW5ndGgiOiI1NTgiLAogICJBY2NlcHQiOiAiKi8qIiwKICAiQWNjZXB0LUVuY29kaW5nIjogImd6aXAsIGRlZmxhdGUsIGJyLCB6c3RkIiwKICAic2VjLWNoLXVhLW1vYmlsZSI6Ij8xIiwKICAiQWNjZXB0LUxhbmd1YWdlIjogImVuLVVTLGVuO3E9MC45IiwKICAiQXV0aG9yaXphdGlvbiI6ICJCZWFyZXIgZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SjFjMlZ5SWpwN0lsOXBaQ0k2SWpZMk5UazROV0psWkRZd1pEa3hZemxqWTJVM09HVTJZU0lzSW5WelpYSnVZVzFsSWpvaWJXbHVhRzVuYjJNNE1qa3lJbjBzSW5ObGMzTnBiMjVKWkNJNklqWTJOVGs0TldVMllqZG1NakUwWlRKa05EQTBNemc1WWlJc0luTjFZaUk2SWpZMk5UazROV0psWkRZd1pEa3hZemxqWTJVM09HVTJZU0lzSW1saGRDSTZNVGN4TnpFME16QXhOQ3dpWlhod0lqb3hOekUzTnpRM09ERTBmUS43WHRyTnNqWDJiREpvaHFjaGZ4M2MxbUtoU2thSXdwbVZkbzUtZUxwaXZnIiwKICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICJSZWZlcmVyIjogImh0dHBzOi8vdGctYXBwLm1lbWVmaS5jbHViLyIsCiAgIm9yaWdpbiI6ICJodHRwczovL3RnLWFwcC5tZW1lZmkuY2x1Yi8iLAogICJTZWMtRmV0Y2gtRGVzdCI6ICJlbXB0eSIsCiAgIlNlYy1GZXRjaC1Nb2RlIjogImNvcnMiLAogICJTZWMtRmV0Y2gtU2l0ZSI6ICJzYW1lLXNpdGUiLAogICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChMaW51eDsgQW5kcm9pZCAxMzsgMjIwMTExN1RHIEJ1aWxkL1RLUTEuMjIxMTE0LjAwMSkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEyNS4wLjY0MjIuNTQgTW9iaWxlIFNhZmFyaS81MzcuMzYifQpwcm94aWVzID0gTm9uZQpwcmludChHQU1FX0NPTkZJRyhoZWFkZXJzLHByb3hpZXMpKQp0aW1lLnNsZWVwKDk5OTkpCmRlZiBEQU1FX0JPVChoZWFkZXJzLCBub25jZSwgY291bnRfdGFwLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBkYXRhID0geyJvcGVyYXRpb25OYW1lIjoiTXV0YXRpb25HYW1lUHJvY2Vzc1RhcHNCYXRjaCIsInZhcmlhYmxlcyI6eyJwYXlsb2FkIjp7Im5vbmNlIjpub25jZSwidGFwc0NvdW50Ijpjb3VudF90YXB9fSwicXVlcnkiOiJtdXRhdGlvbiBNdXRhdGlvbkdhbWVQcm9jZXNzVGFwc0JhdGNoKCRwYXlsb2FkOiBUZWxlZ3JhbUdhbWVUYXBzQmF0Y2hJbnB1dCEpIHtcbiAgdGVsZWdyYW1HYW1lUHJvY2Vzc1RhcHNCYXRjaChwYXlsb2FkOiAkcGF5bG9hZCkge1xuICAgIC4uLkZyYWdtZW50Qm9zc0ZpZ2h0Q29uZmlnXG4gICAgX190eXBlbmFtZVxuICB9XG59XG5cbmZyYWdtZW50IEZyYWdtZW50Qm9zc0ZpZ2h0Q29uZmlnIG9uIFRlbGVncmFtR2FtZUNvbmZpZ091dHB1dCB7XG4gIF9pZFxuICBjb2luc0Ftb3VudFxuICBjdXJyZW50RW5lcmd5XG4gIG1heEVuZXJneVxuICB3ZWFwb25MZXZlbFxuICBlbmVyZ3lMaW1pdExldmVsXG4gIGVuZXJneVJlY2hhcmdlTGV2ZWxcbiAgdGFwQm90TGV2ZWxcbiAgY3VycmVudEJvc3Mge1xuICAgIF9pZFxuICAgIGxldmVsXG4gICAgY3VycmVudEhlYWx0aFxuICAgIG1heEhlYWx0aFxuICAgIF9fdHlwZW5hbWVcbiAgfVxuICBmcmVlQm9vc3RzIHtcbiAgICBfaWRcbiAgICBjdXJyZW50VHVyYm9BbW91bnRcbiAgICBtYXhUdXJib0Ftb3VudFxuICAgIHR1cmJvTGFzdEFjdGl2YXRlZEF0XG4gICAgdHVyYm9BbW91bnRMYXN0UmVjaGFyZ2VEYXRlXG4gICAgY3VycmVudFJlZmlsbEVuZXJneUFtb3VudFxuICAgIG1heFJlZmlsbEVuZXJneUFtb3VudFxuICAgIHJlZmlsbEVuZXJneUxhc3RBY3RpdmF0ZWRBdFxuICAgIHJlZmlsbEVuZXJneUFtb3VudExhc3RSZWNoYXJnZURhdGVcbiAgICBfX3R5cGVuYW1lXG4gIH1cbiAgYm9udXNMZWFkZXJEYW1hZ2VFbmRBdFxuICBib251c0xlYWRlckRhbWFnZVN0YXJ0QXRcbiAgYm9udXNMZWFkZXJEYW1hZ2VNdWx0aXBsaWVyXG4gIG5vbmNlXG4gIF9fdHlwZW5hbWVcbn0ifQogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1ndy10Zy5tZW1lZmkuY2x1Yi9ncmFwaHFsIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWd3LXRnLm1lbWVmaS5jbHViL2dyYXBocWwiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXVsidGVsZWdyYW1HYW1lUHJvY2Vzc1RhcHNCYXRjaCJdCiAgICAgIGJhbGFuY2UgPSBkYXRhWyJjb2luc0Ftb3VudCJdCiAgICAgIEVuZXJneSA9IGRhdGFbImN1cnJlbnRFbmVyZ3kiXQogICAgICBtYXhFbmVyZ3kgPSBkYXRhWyJtYXhFbmVyZ3kiXQogICAgICBIZWFsdGhCb3NzID0gZGF0YVsiY3VycmVudEJvc3MiXVsiY3VycmVudEhlYWx0aCJdCiAgICAgIG1heEhlYWx0aEJvc3MgPSBkYXRhWyJjdXJyZW50Qm9zcyJdWyJtYXhIZWFsdGgiXQogICAgICBub25jZSA9IGRhdGFbIm5vbmNlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgIGVycm9yX2NvdW50ICs9IDEKICAgICAgcHJpbnQoZiJIw6BtIERBTUVfQk9ULCDEkWFuZyB44bqjeSByYSBs4buXaS4gVGjhu60gbOG6oWkgbOG6p24ge2Vycm9yX2NvdW50fS97bWF4X3JldHJpZXN9IikKICAgICAgaWYgZXJyb3JfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgICAgcHJpbnQoIsSQw6MgZ+G6t3AgbOG7l2kgcXXDoSAxMCBs4bqnbiwga2jhu59pIGNo4bqheSBow6BtIFJVTl9NRU1FRkkoYWNjX21heCkiKQogICAgICAgIFJVTl9NRU1FRkkoYWNjX21heCkKICAgICAgICBicmVhawogICAgICBDT1VOVERPV04oMTApCiAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgcHJpbnQoZiJIw6BtIERBTUVfQk9ULCBFcnJvciBkZWNvZGluZyBKU09OIHJlc3BvbnNlIikKICAgICAgYnJlYWsKICAgIGV4Y2VwdCBLZXlFcnJvciBhcyBlOgogICAgICBwcmludChmIkjDoG0gREFNRV9CT1QsIEtleSBlcnJvcjoge2V9IikKICAgICAgYnJlYWsKICByZXR1cm4gYmFsYW5jZSwgRW5lcmd5LCBtYXhFbmVyZ3ksIEhlYWx0aEJvc3MsIG1heEhlYWx0aEJvc3MsIG5vbmNlCmRlZiBCT09URVJTX0FDVElWRShoZWFkZXJzLCBib290ZXIsIHByb3hpZXM9Tm9uZSk6CiAgdGltZS5zbGVlcCgyMCkKICBlcnJvcl9jb3VudCA9IDAKICBtYXhfcmV0cmllcyA9IDEwCiAgZGF0YSA9IHsib3BlcmF0aW9uTmFtZSI6InRlbGVncmFtR2FtZUFjdGl2YXRlQm9vc3RlciIsInZhcmlhYmxlcyI6eyJib29zdGVyVHlwZSI6Ym9vdGVyfSwicXVlcnkiOiJtdXRhdGlvbiB0ZWxlZ3JhbUdhbWVBY3RpdmF0ZUJvb3N0ZXIoJGJvb3N0ZXJUeXBlOiBCb29zdGVyVHlwZSEpIHtcbiAgdGVsZWdyYW1HYW1lQWN0aXZhdGVCb29zdGVyKGJvb3N0ZXJUeXBlOiAkYm9vc3RlclR5cGUpIHtcbiAgICAuLi5GcmFnbWVudEJvc3NGaWdodENvbmZpZ1xuICAgIF9fdHlwZW5hbWVcbiAgfVxufVxuXG5mcmFnbWVudCBGcmFnbWVudEJvc3NGaWdodENvbmZpZyBvbiBUZWxlZ3JhbUdhbWVDb25maWdPdXRwdXQge1xuICBfaWRcbiAgY29pbnNBbW91bnRcbiAgY3VycmVudEVuZXJneVxuICBtYXhFbmVyZ3lcbiAgd2VhcG9uTGV2ZWxcbiAgZW5lcmd5TGltaXRMZXZlbFxuICBlbmVyZ3lSZWNoYXJnZUxldmVsXG4gIHRhcEJvdExldmVsXG4gIGN1cnJlbnRCb3NzIHtcbiAgICBfaWRcbiAgICBsZXZlbFxuICAgIGN1cnJlbnRIZWFsdGhcbiAgICBtYXhIZWFsdGhcbiAgICBfX3R5cGVuYW1lXG4gIH1cbiAgZnJlZUJvb3N0cyB7XG4gICAgX2lkXG4gICAgY3VycmVudFR1cmJvQW1vdW50XG4gICAgbWF4VHVyYm9BbW91bnRcbiAgICB0dXJib0xhc3RBY3RpdmF0ZWRBdFxuICAgIHR1cmJvQW1vdW50TGFzdFJlY2hhcmdlRGF0ZVxuICAgIGN1cnJlbnRSZWZpbGxFbmVyZ3lBbW91bnRcbiAgICBtYXhSZWZpbGxFbmVyZ3lBbW91bnRcbiAgICByZWZpbGxFbmVyZ3lMYXN0QWN0aXZhdGVkQXRcbiAgICByZWZpbGxFbmVyZ3lBbW91bnRMYXN0UmVjaGFyZ2VEYXRlXG4gICAgX190eXBlbmFtZVxuICB9XG4gIGJvbnVzTGVhZGVyRGFtYWdlRW5kQXRcbiAgYm9udXNMZWFkZXJEYW1hZ2VTdGFydEF0XG4gIGJvbnVzTGVhZGVyRGFtYWdlTXVsdGlwbGllclxuICBub25jZVxuICBfX3R5cGVuYW1lXG59In0KICB3aGlsZSBUcnVlOgogICAgdHJ5OgogICAgICBpZiBwcm94aWVzOgogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgiaHR0cHM6Ly9hcGktZ3ctdGcubWVtZWZpLmNsdWIvZ3JhcGhxbCIsIGhlYWRlcnM9aGVhZGVycywganNvbj1kYXRhLCBwcm94aWVzPXByb3hpZXMsIHRpbWVvdXQ9MzApCiAgICAgIGVsc2U6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1ndy10Zy5tZW1lZmkuY2x1Yi9ncmFwaHFsIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHRpbWVvdXQ9MzApCiAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICBkYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl1bInRlbGVncmFtR2FtZUFjdGl2YXRlQm9vc3RlciJdCiAgICAgIGJhbGFuY2UgPSBkYXRhWyJjb2luc0Ftb3VudCJdCiAgICAgIEVuZXJneSA9IGRhdGFbImN1cnJlbnRFbmVyZ3kiXQogICAgICBtYXhFbmVyZ3kgPSBkYXRhWyJtYXhFbmVyZ3kiXQogICAgICBIZWFsdGhCb3NzID0gZGF0YVsiY3VycmVudEJvc3MiXVsiY3VycmVudEhlYWx0aCJdCiAgICAgIG1heEhlYWx0aEJvc3MgPSBkYXRhWyJjdXJyZW50Qm9zcyJdWyJtYXhIZWFsdGgiXQogICAgICBUdXJib0Ftb3VudCA9IGRhdGFbImZyZWVCb29zdHMiXVsiY3VycmVudFR1cmJvQW1vdW50Il0KICAgICAgbm9uY2UgPSBkYXRhWyJub25jZSJdCiAgICAgIGJyZWFrCiAgICBleGNlcHQgcmVxdWVzdHMuZXhjZXB0aW9ucy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICBlcnJvcl9jb3VudCArPSAxCiAgICAgIHByaW50KGYiSMOgbSBCT09URVJTX0FDVElWRSwgxJFhbmcgeOG6o3kgcmEgbOG7l2kuIFRo4butIGzhuqFpIGzhuqduIHtlcnJvcl9jb3VudH0ve21heF9yZXRyaWVzfSIpCiAgICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICAgIHByaW50KCLEkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgaMOgbSBSVU5fTUVNRUZJKGFjY19tYXgpIikKICAgICAgICBSVU5fTUVNRUZJKGFjY19tYXgpCiAgICAgICAgYnJlYWsKICAgICAgQ09VTlRET1dOKDEwKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgIHByaW50KGYiSMOgbSBCT09URVJTX0FDVElWRSwgRXJyb3IgZGVjb2RpbmcgSlNPTiByZXNwb25zZSIpCiAgICAgIGJyZWFrCiAgICBleGNlcHQgS2V5RXJyb3IgYXMgZToKICAgICAgcHJpbnQoZiJIw6BtIEJPT1RFUlNfQUNUSVZFLCBLZXkgZXJyb3I6IHtlfSIpCiAgICAgIGJyZWFrCiAgcmV0dXJuIGJhbGFuY2UsIEVuZXJneSwgbWF4RW5lcmd5LCBIZWFsdGhCb3NzLCBtYXhIZWFsdGhCb3NzLCBUdXJib0Ftb3VudCwgbm9uY2UKZGVmIE5FWFRfQk9TUyhoZWFkZXJzLCBwcm94aWVzPU5vbmUpOgogIGVycm9yX2NvdW50ID0gMAogIG1heF9yZXRyaWVzID0gMTAKICBkYXRhID0geyJvcGVyYXRpb25OYW1lIjoidGVsZWdyYW1HYW1lU2V0TmV4dEJvc3MiLCJ2YXJpYWJsZXMiOnt9LCJxdWVyeSI6Im11dGF0aW9uIHRlbGVncmFtR2FtZVNldE5leHRCb3NzIHtcbiAgdGVsZWdyYW1HYW1lU2V0TmV4dEJvc3Mge1xuICAgIC4uLkZyYWdtZW50Qm9zc0ZpZ2h0Q29uZmlnXG4gICAgX190eXBlbmFtZVxuICB9XG59XG5cbmZyYWdtZW50IEZyYWdtZW50Qm9zc0ZpZ2h0Q29uZmlnIG9uIFRlbGVncmFtR2FtZUNvbmZpZ091dHB1dCB7XG4gIF9pZFxuICBjb2luc0Ftb3VudFxuICBjdXJyZW50RW5lcmd5XG4gIG1heEVuZXJneVxuICB3ZWFwb25MZXZlbFxuICBlbmVyZ3lMaW1pdExldmVsXG4gIGVuZXJneVJlY2hhcmdlTGV2ZWxcbiAgdGFwQm90TGV2ZWxcbiAgY3VycmVudEJvc3Mge1xuICAgIF9pZFxuICAgIGxldmVsXG4gICAgY3VycmVudEhlYWx0aFxuICAgIG1heEhlYWx0aFxuICAgIF9fdHlwZW5hbWVcbiAgfVxuICBmcmVlQm9vc3RzIHtcbiAgICBfaWRcbiAgICBjdXJyZW50VHVyYm9BbW91bnRcbiAgICBtYXhUdXJib0Ftb3VudFxuICAgIHR1cmJvTGFzdEFjdGl2YXRlZEF0XG4gICAgdHVyYm9BbW91bnRMYXN0UmVjaGFyZ2VEYXRlXG4gICAgY3VycmVudFJlZmlsbEVuZXJneUFtb3VudFxuICAgIG1heFJlZmlsbEVuZXJneUFtb3VudFxuICAgIHJlZmlsbEVuZXJneUxhc3RBY3RpdmF0ZWRBdFxuICAgIHJlZmlsbEVuZXJneUFtb3VudExhc3RSZWNoYXJnZURhdGVcbiAgICBfX3R5cGVuYW1lXG4gIH1cbiAgYm9udXNMZWFkZXJEYW1hZ2VFbmRBdFxuICBib251c0xlYWRlckRhbWFnZVN0YXJ0QXRcbiAgYm9udXNMZWFkZXJEYW1hZ2VNdWx0aXBsaWVyXG4gIG5vbmNlXG4gIF9fdHlwZW5hbWVcbn0ifQogIHdoaWxlIFRydWU6CiAgICB0cnk6CiAgICAgIGlmIHByb3hpZXM6CiAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KCJodHRwczovL2FwaS1ndy10Zy5tZW1lZmkuY2x1Yi9ncmFwaHFsIiwgaGVhZGVycz1oZWFkZXJzLCBqc29uPWRhdGEsIHByb3hpZXM9cHJveGllcywgdGltZW91dD0zMCkKICAgICAgZWxzZToKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vYXBpLWd3LXRnLm1lbWVmaS5jbHViL2dyYXBocWwiLCBoZWFkZXJzPWhlYWRlcnMsIGpzb249ZGF0YSwgdGltZW91dD0zMCkKICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgIGRhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXVsidGVsZWdyYW1HYW1lU2V0TmV4dEJvc3MiXQogICAgICBiYWxhbmNlID0gZGF0YVsiY29pbnNBbW91bnQiXQogICAgICBFbmVyZ3kgPSBkYXRhWyJjdXJyZW50RW5lcmd5Il0KICAgICAgbWF4RW5lcmd5ID0gZGF0YVsibWF4RW5lcmd5Il0KICAgICAgbGV2ZWxCb3NzID0gZGF0YVsiY3VycmVudEJvc3MiXVsibGV2ZWwiXQogICAgICBIZWFsdGhCb3NzID0gZGF0YVsiY3VycmVudEJvc3MiXVsiY3VycmVudEhlYWx0aCJdCiAgICAgIG1heEhlYWx0aEJvc3MgPSBkYXRhWyJjdXJyZW50Qm9zcyJdWyJtYXhIZWFsdGgiXQogICAgICBub25jZSA9IGRhdGFbIm5vbmNlIl0KICAgICAgYnJlYWsKICAgIGV4Y2VwdCByZXF1ZXN0cy5leGNlcHRpb25zLlJlcXVlc3RFeGNlcHRpb246CiAgICAgIGVycm9yX2NvdW50ICs9IDEKICAgICAgcHJpbnQoZiJIw6BtIE5FWFRfQk9TUywgxJFhbmcgeOG6o3kgcmEgbOG7l2kuIFRo4butIGzhuqFpIGzhuqduIHtlcnJvcl9jb3VudH0ve21heF9yZXRyaWVzfSIpCiAgICAgIGlmIGVycm9yX2NvdW50ID49IG1heF9yZXRyaWVzOgogICAgICAgIHByaW50KCLEkMOjIGfhurdwIGzhu5dpIHF1w6EgMTAgbOG6p24sIGto4bufaSBjaOG6oXkgaMOgbSBSVU5fTUVNRUZJKGFjY19tYXgpIikKICAgICAgICBSVU5fTUVNRUZJKGFjY19tYXgpCiAgICAgICAgYnJlYWsKICAgICAgQ09VTlRET1dOKDEwKQogICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgIHByaW50KGYiSMOgbSBORVhUX0JPU1MsIEVycm9yIGRlY29kaW5nIEpTT04gcmVzcG9uc2UiKQogICAgICBicmVhawogICAgZXhjZXB0IEtleUVycm9yIGFzIGU6CiAgICAgIHByaW50KGYiSMOgbSBORVhUX0JPU1MsIEtleSBlcnJvcjoge2V9IikKICAgICAgYnJlYWsKICByZXR1cm4gYmFsYW5jZSwgRW5lcmd5LCBtYXhFbmVyZ3ksIGxldmVsQm9zcywgSGVhbHRoQm9zcywgbWF4SGVhbHRoQm9zcywgbm9uY2UKCmFjY19tYXggPSAwCmRlZiBSVU5fTUVNRUZJKGFjY19tYXgpOgogIHdpdGggb3BlbignY29uZmlnLmpzb24nLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGZpbGU6CiAgICBjb25maWdfZGF0YSA9IGpzb24ubG9hZHMocmVtb3ZlX2NvbW1lbnRzKGZpbGUucmVhZCgpKSkKICB1c2VycyA9IGNvbmZpZ19kYXRhWyd1c2VycyddCiAgaWYgYWNjX21heCA9PSBsZW4odXNlcnMpOgogICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHts4bulY30gVE/DgE4gQuG7mCBUw4BJIEtIT+G6ok4gxJDDgyBNQVgiKQogICAgZXhpdCgpCiAgZm9yIHVzZXIgaW4gdXNlcnM6CiAgICBhdXRob3JpemF0aW9uID0gdXNlclsiYXV0aG9yaXphdGlvbl9tZW1lZmkiXQogICAgaWYgYXV0aG9yaXphdGlvbiA9PSAiIjoKICAgICAgY29udGludWUKICAgIGlmIGF1dGhvcml6YXRpb24gPT0gIiI6CiAgICAgIHByaW50KGYie8SR4buPfU3DoyBhdXRob3JpemF0aW9uIGPhu6dhIGFjYyB7dsOgbmd9e2Nob25fYWNjfSB7xJHhu499xJFhbmcgdHLhu5FuZywgaMOjeSBs4bqleSBtw6MgYXV0aG9yaXphdGlvbiBuaOG6rXAgdsOgbyBiw6puIGTGsOG7m2kiKQogICAgICBhdXRob3JpemF0aW9uID0gaW5wdXQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9TkjhuqxQIE3DgyBhdXRob3JpemF0aW9ue8SRZW59OiB7bGFtfSIpCiAgICBwcm94eV9saXN0ID0gY29uZmlnX2FjY1sicHJveHkiXQogICAgdHlwZV9wcm94eSA9IGNvbmZpZ19hY2NbInR5cGVfcHJveHkiXQogICAgdXNlcl9hZ2VudCA9IGNvbmZpZ19hY2NbInVzZXItYWdlbnQiXQogICAgaWYgcHJveHlfbGlzdCAhPSAiIjoKICAgICAgcHJveHlfbGlzdCA9IHByb3h5X2xpc3Quc3BsaXQoIjoiKQogICAgICBwcm94eSA9IGYie3R5cGVfcHJveHl9Oi8ve3Byb3h5X2xpc3RbMl19Ontwcm94eV9saXN0WzNdfUB7cHJveHlfbGlzdFswXX06e3Byb3h5X2xpc3RbMV19IgogICAgICBwcm94aWVzID0gewogICAgICAnaHR0cCc6IHByb3h5LAogICAgICAnaHR0cHMnOiBwcm94eSx9CiAgICBlbHNlOgogICAgICBpZiBhY2NvdW50LnNwbGl0KCdfJylbMV0gIT0gIjEiOgogICAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHt0cuG6r25nfUNodXnhu4NuIHTDoGkga2hv4bqjbiBkbyBraMO0bmcgY8OzIHByb3h5IikKICAgICAgICBjb250aW51ZQogICAgICBwcm94aWVzID0gIiIKICAgIGlwLCBmYWtlaXAgPSBnZXRJUChwcm94aWVzKQogICAgaWYgaXAgPT0gZmFrZWlwID09IE5vbmU6CiAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfVxuxJDhu5RJIFTDgEkgS0hP4bqiTiBETyBLSMOUTkcgTOG6pFkgxJDGr+G7okMgSVAsIEjDg1kgS0nhu4JNIFRSQSBM4bqgSSBQUk9YWVxuIikKICAgICAgY29udGludWUKICAgIGhlYWRlcnMgPSB7CiAgICAgICJBY2NlcHQiOiAiKi8qIiwKICAgICAgIkFjY2VwdC1FbmNvZGluZyI6ICJnemlwLCBkZWZsYXRlLCBiciwgenN0ZCIsCiAgICAgICJBY2NlcHQtTGFuZ3VhZ2UiOiAiZW4tVVMsZW47cT0wLjkiLAogICAgICAiQXV0aG9yaXphdGlvbiI6IGF1dGhvcml6YXRpb24sCiAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICJSZWZlcmVyIjogImh0dHBzOi8vdGctYXBwLm1lbWVmaS5jbHViLyIsCiAgICAgICJTZWMtRmV0Y2gtRGVzdCI6ICJlbXB0eSIsCiAgICAgICJTZWMtRmV0Y2gtTW9kZSI6ICJjb3JzIiwKICAgICAgIlNlYy1GZXRjaC1TaXRlIjogInNhbWUtc2l0ZSIsCiAgICAgICJVc2VyLUFnZW50IjogdXNlcl9hZ2VudH0KICAgIHVzZXJuYW1lID0gdGVsZWdyYW1Vc2VyTWUoaGVhZGVycyxwcm94aWVzKQogICAgYmFsYW5jZSwgRW5lcmd5LCBtYXhFbmVyZ3ksIGRhbWUsIGxldmVsQm9zcywgSGVhbHRoQm9zcywgbWF4SGVhbHRoQm9zcywgVHVyYm9BbW91bnQsIFJlY292ZXJ5QW1vdW50LCBub25jZSA9IEdBTUVfQ09ORklHKGhlYWRlcnMsIHByb3hpZXMpCiAgICBwcmludChmIiIie8SR4bqtbX17xJFlbn08PDw8PDw8PDw8PDw8PDw8PDw8e2xhbX1be3bDoG5nQkd9e8SR4buPfVRIw5RORyBUw4BJIEtIT+G6ok4gTUVNRUZJe8SRZW5CR317bGFtfV17xJFlbn0+Pj4+Pj4+Pj4+Pj4+Pj4+Pj5cbnvEkWVufeOAmPCfkaTjgJl7dHLhuq9uZ31Vc2VyTmFtZSB7xJHhu499OiB7bOG7pWN9e3VzZXJuYW1lfSB7dHLhuq9uZ30oe2jhu5NuZ317YWNjb3VudC5zcGxpdCgnXycpWzFdfXt0cuG6r25nfSlcbnvEkWVufeOAmPCfqpnjgJl7dHLhuq9uZ31T4buRIETGsCB7xJHhu499OiB7dsOgbmd9e2JhbGFuY2V9XG57xJFlbn3jgJjwn5OK44CZe3Ry4bqvbmd9VGjDtG5nIHPhu5EgR2FtZXvEkeG7j306IHt2w6BuZ30re2RhbWV9e8SRZW59L3t2w6BuZ31jbGljayB7xJHhu499W3tsYW19e0VuZXJneX17xJFlbn0ve2xhbX17bWF4RW5lcmd5fXvEkeG7j31dIHtUdXJib0Ftb3VudH0ge1JlY292ZXJ5QW1vdW50fVxue8SRZW5944CY8J+RueOAmXt0cuG6r25nfVRow7RuZyB0aW4gQm9zc3vEkeG7j306IHt4YW5ofWxldmVsIHtsZXZlbEJvc3N9IHvEkWVufXwge2jhu5NuZ317SGVhbHRoQm9zc33wn5KWe8SRZW59L3to4buTbmd9e21heEhlYWx0aEJvc3N98J+Sllxue8SRZW5944CY8J+Mj+OAmXt0cuG6r25nfUlQIHvEkeG7j306IHtuw6J1fXtpcH0ge2zhu6VjfcK7wrvCuyB7dHLhuq9uZ31GYWtlIElQIHvEkeG7j306IHtsYW19e2Zha2VpcH1cbiIiIikKICAgIHN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgcHJpbnQoZiJ7xJHhu499XDAzM1sxOzMzOzQwbULhuq5UIMSQ4bqmVSBDSOG6oFkgVE9PTCB7dGjGsOG7nW5nfXvEkeG6rW19e8SR4buPfcK7IHvEkWVufVt7dsOgbmd9e3N0YXJ0X3RpbWUuc3RyZnRpbWUoJyVIOiVNOiVTJyl9e8SRZW59XVxuIikKICAgIGlmIGxldmVsQm9zcyA9PSAxMSBhbmQgSGVhbHRoQm9zcyA9PSAwOgogICAgICBub3dfdGltZSA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7bOG7pWN9VMOgaSBraG/huqNuIMSRw6MgTUFYIGxldmVsIHt4YW5ofXtsZXZlbEJvc3N9IHvEkeG7j31be2jhu5NuZ317SGVhbHRoQm9zc317xJFlbn0ve2jhu5NuZ317bWF4SGVhbHRoQm9zc317xJHhu499XSDCuyB7dsOgbmd98J+qmXtiYWxhbmNlfSIpCiAgICAgIGFjY19tYXggKz0gMQogICAgICBjb250aW51ZQogICAgaWYgVHVyYm9BbW91bnQgPiAwOgogICAgICBmb3IgaSBpbiByYW5nZSgwLFR1cmJvQW1vdW50KToKICAgICAgICBiYWxhbmNlLCBFbmVyZ3ksIG1heEVuZXJneSwgSGVhbHRoQm9zcywgbWF4SGVhbHRoQm9zcywgbmV3VHVyYm9BbW91bnQsIG5vbmNlID0gQk9PVEVSU19BQ1RJVkUoaGVhZGVycywgIlR1cmJvIiwgcHJveGllcykKICAgICAgICBpZiBuZXdUdXJib0Ftb3VudCA8IFR1cmJvQW1vdW50OgogICAgICAgICAgbm93X3RpbWUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJUg6JU06JVMiKQogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+oe3bDoG5nfXtub3dfdGltZX17xJHhu4994p+pIHt0cuG6r25nfUvDjUNIIEhP4bqgVCB7dsOgbmd9VFVSQk8ge3Ry4bqvbmd9IFRIw4BOSCBDw5RORyIpCiAgICAgICAgICBuZXdiYWxhbmNlLCBFbmVyZ3ksIG1heEVuZXJneSwgbmV3SGVhbHRoQm9zcywgbWF4SGVhbHRoQm9zcywgbm9uY2UgPSBEQU1FX0JPVChoZWFkZXJzLCBub25jZSwgMTAwMDAwMCwgcHJveGllcykKICAgICAgICAgIGlmIG5ld0hlYWx0aEJvc3MgPT0gMDoKICAgICAgICAgICAgY29sbGVjdEFtb3VudCA9IG5ld2JhbGFuY2UgLSBiYWxhbmNlCiAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgcHJpbnQoZiJ7xJFlbn3ilZTilZB7xJHhu499W3t2w6BuZ317bm93X3RpbWV9e8SR4buPfV0ge3Ry4bqvbmd9xJDDoyBLSUxMIEJvc3Mge3bDoG5nfSt7Y29sbGVjdEFtb3VudH3wn6qZIHvEkeG7j33CuyIsIGVuZD0iICIpCiAgICAgICAgICAgIHByaW50KGYi8J+qmXt2w6BuZ317bmV3YmFsYW5jZX1cbnvEkWVufeKVmuKruHto4buTbmd9TGluayB0b29sICYgaMaw4bubbmcgZOG6q24gdOG6oWkgVGVsZWdyYW17xJHhu499OiB7bOG7pWN9QEFudWJpc01NT1xuIikKICAgICAgICAgICAgaWYgbGV2ZWxCb3NzID09IDExOgogICAgICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6h7dsOgbmd9e25vd190aW1lfXvEkeG7j33in6kge2zhu6VjfVTDoGkga2hv4bqjbiDEkcOjIE1BWCBsZXZlbCB7eGFuaH17bGV2ZWxCb3NzfSB7xJHhu499W3to4buTbmd9e0hlYWx0aEJvc3N9e8SRZW59L3to4buTbmd9e21heEhlYWx0aEJvc3N9e8SR4buPfV0gwrsge3bDoG5nffCfqpl7YmFsYW5jZX0iKQogICAgICAgICAgICAgIGFjY19tYXggKz0gMQogICAgICAgICAgICAgIFJVTl9NRU1FRkkoYWNjX21heCkKICAgICAgICAgICAgdXNlcm5hbWUgPSB0ZWxlZ3JhbVVzZXJNZShoZWFkZXJzLHByb3hpZXMpCiAgICAgICAgICAgIGJhbGFuY2UsIEVuZXJneSwgbWF4RW5lcmd5LCBkYW1lLCBsZXZlbEJvc3MsIEhlYWx0aEJvc3MsIG1heEhlYWx0aEJvc3MsIFR1cmJvQW1vdW50LCBSZWNvdmVyeUFtb3VudCwgbm9uY2UgPSBHQU1FX0NPTkZJRyhoZWFkZXJzLCBwcm94aWVzKQogICAgICAgICAgICBiYWxhbmNlLCBFbmVyZ3ksIG1heEVuZXJneSwgbGV2ZWxCb3NzLCBIZWFsdGhCb3NzLCBtYXhIZWFsdGhCb3NzLCBub25jZSA9IE5FWFRfQk9TUyhoZWFkZXJzLHByb3hpZXMpCiAgICAgICAgICAgIGlmIEhlYWx0aEJvc3MgPT0gbWF4SGVhbHRoQm9zczoKICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7dHLhuq9uZ33EkMODIEPhuqxQIE5I4bqsVCBCT1NTIFRJ4bq+UCBUSEVPIHvEkeG7j31be2jhu5NuZ317SGVhbHRoQm9zc317xJFlbn0ve2jhu5NuZ317bWF4SGVhbHRoQm9zc317xJHhu499XVxuIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499Q+G6rFAgTkjhuqxUIEJPU1MgVEjhuqRUIELhuqBJe8SR4buPfVt7aOG7k25nfXtIZWFsdGhCb3NzfXvEkWVufS97aOG7k25nfXttYXhIZWFsdGhCb3NzfXvEkeG7j31dXG4iKQogICAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfUJPU1MgVuG6qk4gQ0jGr0EgQuG7iiBLSUxMIHvEkeG7j31be2jhu5NuZ317SGVhbHRoQm9zc317xJFlbn0ve2jhu5NuZ317bWF4SGVhbHRoQm9zc317xJHhu499XSDCuyB7dsOgbmd98J+qmXtuZXdiYWxhbmNlfVxuIikKICAgICAgICBlbHNlOgogICAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge8SR4buPfUhJ4buGTiDEkEFORyBDw5JOIHt2w6BuZ31Lw41DSCBIT+G6oFQge2zhu6VjfVRVUkJPIHvEkeG7j31USOG6pFQgQuG6oElcbiIpCiAgICB3aGlsZSBUcnVlOgogICAgICBpZiBpbnQoRW5lcmd5L2RhbWUpID4gMTA6CiAgICAgICAgaWYgRW5lcmd5L2RhbWUgPiA1MDoKICAgICAgICAgIGNvdW50X3RhcCA9IHJhbmRvbS5yYW5kaW50KDUwLGludChFbmVyZ3kvZGFtZSkpCiAgICAgICAgZWxzZToKICAgICAgICAgIGNvdW50X3RhcCA9IGludChFbmVyZ3kvZGFtZSkKICAgICAgICBiYWxhbmNlLCBFbmVyZ3ksIG1heEVuZXJneSwgbmV3SGVhbHRoQm9zcywgbWF4SGVhbHRoQm9zcywgbm9uY2UgPSBEQU1FX0JPVChoZWFkZXJzLCBub25jZSwgY291bnRfdGFwLCBwcm94aWVzKQogICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBpZiBuZXdIZWFsdGhCb3NzIDwgSGVhbHRoQm9zczoKICAgICAgICAgIGNvbGxlY3RBbW91bnQgPSBkYW1lKmNvdW50X3RhcAogICAgICAgICAgcHJpbnQoZiJ7xJFlbn3ilZTilZB7xJHhu499W3t2w6BuZ317bm93X3RpbWV9e8SR4buPfV0ge3Ry4bqvbmd9xJDDoyDEkcOhbmggQk9TUyB7bOG7pWN9e2NvdW50X3RhcH0ge3Ry4bqvbmd9bOG6p24ge3bDoG5nfSt7Y29sbGVjdEFtb3VudH3wn6qZIHvEkeG7j33CuyIsIGVuZD0iICIpCiAgICAgICAgICBwcmludChmIvCfqpl7dsOgbmd9e2JhbGFuY2V9XG57xJFlbn3ilZriq7h7aOG7k25nfUxpbmsgdG9vbCAmIGjGsOG7m25nIGThuqtuIHThuqFpIFRlbGVncmFte8SR4buPfToge2zhu6VjfUBBbnViaXNNTU9cbiIpCiAgICAgICAgZWxzZToKICAgICAgICAgIG5vd190aW1lID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqHt2w6BuZ317bm93X3RpbWV9e8SR4buPfeKfqSB7xJHhu499xJDDoW5oIEJvc3MgdGjhuqV0IGLhuqFpIHvEkeG7j31be2jhu5NuZ317SGVhbHRoQm9zc317xJFlbn0ve2jhu5NuZ317bWF4SGVhbHRoQm9zc317xJHhu499XSDCuyB7dsOgbmd98J+qmXtiYWxhbmNlfSIpCiAgICAgIGJhbGFuY2UsIEVuZXJneSwgbWF4RW5lcmd5LCBkYW1lLCBsZXZlbEJvc3MsIEhlYWx0aEJvc3MsIG1heEhlYWx0aEJvc3MsIFR1cmJvQW1vdW50LCBSZWNvdmVyeUFtb3VudCwgbm9uY2UgPSBHQU1FX0NPTkZJRyhoZWFkZXJzLCBwcm94aWVzKQogICAgICBpZiBSZWNvdmVyeUFtb3VudCA+IDAgYW5kIEVuZXJneS9kYW1lIDwgMTA6CiAgICAgICAgYmFsYW5jZSwgRW5lcmd5LCBtYXhFbmVyZ3ksIEhlYWx0aEJvc3MsIG1heEhlYWx0aEJvc3MsIFR1cmJvQW1vdW50LCBub25jZSA9IEJPT1RFUlNfQUNUSVZFKGhlYWRlcnMsICJSZWNoYXJnZSIsIHByb3hpZXMpCiAgICAgICAgaWYgRW5lcmd5ID09IG1heEVuZXJneToKICAgICAgICAgIHByaW50KGYie8SR4buPfeKfqXt2w6BuZ33in6l7bOG7pWN94p+pIHt0cuG6r25nfcSQw4MgS8ONQ0ggSE/huqBUIHts4bulY31SRUNIQVJHRSB7bOG7pWN9VEjDgE5IIEPDlE5HIHvEkeG7j31be3bDoG5nfXtFbmVyZ3l9e8SRZW59L3t2w6BuZ317bWF4RW5lcmd5fXvEkeG7j31dXG4iKQogICAgICAgIGVsc2U6CiAgICAgICAgICBwcmludChmInvEkeG7j33in6l7dsOgbmd94p+pe2zhu6VjfeKfqSB7xJHhu499S8ONQ0ggSE/huqBUIHt2w6BuZ31SRUNIQVJHRSB7xJHhu499VEjhuqRUIELhuqBJXG4iKQogICAgICBlbGlmIEVuZXJneS9kYW1lIDwgMTA6CiAgICAgICAgcHJpbnQoZiJ7xJHhu4994p+pe3bDoG5nfeKfqXts4bulY33in6kge3Ry4bqvbmd9SOG6vlQgTMav4buiVCBDTElDSywgSOG6vlQgQk9PVEVSUyB7xJHhu499wrsge3bDoG5nfcSQ4buUSSBUw4BJIEtIT+G6ok5cbiIpCiAgICAgICAgYnJlYWsKUlVOX01FTUVGSShhY2NfbWF4KQ=="